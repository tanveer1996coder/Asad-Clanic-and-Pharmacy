"use strict";(self.webpackChunksupabase_sales_app=self.webpackChunksupabase_sales_app||[]).push([[173],{3632:(e,t,r)=>{r.d(t,{A:()=>o});var n=r(59662),i=r(70579);const o=(0,n.A)((0,i.jsx)("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5M12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5m0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"}),"Visibility")},12807:(e,t,r)=>{function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"PKR";if(null===e||void 0===e||isNaN(e))return"".concat(t," 0.00");const r=Number(e);return"".concat(t," ").concat(r.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}))}function i(e){return null===e||void 0===e||isNaN(e)?"0":Number(e).toLocaleString("en-US")}function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return null===e||void 0===e||isNaN(e)?"0%":"".concat(Number(e).toFixed(t),"%")}r.d(t,{Ee:()=>o,ZV:()=>i,vv:()=>n})},68173:(e,t,r)=>{r.r(t),r.d(t,{default:()=>me});var n=r(65043),i=r(26240),o=r(30344),s=r(19252),a=r(96446),l=r(85865),d=r(11906),c=r(12110),p=r(26494),u=r(5146),x=r(51787),h=r(32143),m=r(79650),_=r(71806),g=r(84882),A=r(28076),v=r(10039),f=r(73460),j=r(43845),y=r(77739),b=r(17392),w=r(19090),S=r(83560),P=r(59662),C=r(70579);const R=(0,P.A)((0,C.jsx)("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send");var q=r(71403),O=r(98606),z=r(17673),F=r(70141),D=r(79484),k=r(3632),W=r(51387),N=r(47503),I=r(27001),E=r(12807),L=r(89379),T=r(90035),U=r(26600),B=r(35316),M=r(68903),H=r(39336),V=r(27108),J=r(29347),Q=r(99010);function Y(e){let{open:t,onClose:r,purchaseOrder:i,suppliers:o}=e;const s=!!i,[c,p]=(0,n.useState)({supplier_id:"",order_date:(new Date).toISOString().split("T")[0],notes:""}),[x,j]=(0,n.useState)([]),[y,w]=(0,n.useState)([]),[S,P]=(0,n.useState)(!1);(0,n.useEffect)(()=>{t&&(R(),s?q():O())},[t,i]);const R=async()=>{const{data:{session:e}}=await I.N.auth.getSession();if(!e)return;const{data:t}=await I.N.from("products").select("*").eq("organization_id",e.user.id).is("deleted_at",null).order("name");w(t||[])},q=async()=>{if(!i)return;p({supplier_id:i.supplier_id||"",order_date:i.order_date||(new Date).toISOString().split("T")[0],notes:i.notes||""});const{data:e}=await I.N.from("purchase_order_items").select("*, products(name)").eq("purchase_order_id",i.id);e&&j(e.map(e=>{var t;return{product_id:e.product_id,product_name:null===(t=e.products)||void 0===t?void 0:t.name,quantity_ordered:e.quantity_ordered,boxes_ordered:e.boxes_ordered||"",items_per_box:e.items_per_box||1}}))},O=()=>{p({supplier_id:"",order_date:(new Date).toISOString().split("T")[0],notes:""}),j([])},z=e=>{p((0,L.A)((0,L.A)({},c),{},{[e.target.name]:e.target.value}))},D=(e,t,r)=>{const n=[...x];if(n[e][t]=r,"product_id"===t){const t=y.find(e=>e.id===r);t&&(n[e].product_name=t.name,n[e].items_per_box=t.items_per_box||1,n[e].boxes_ordered&&(n[e].quantity_ordered=n[e].boxes_ordered*(t.items_per_box||1)))}if("boxes_ordered"===t||"items_per_box"===t){const i="boxes_ordered"===t?r:n[e].boxes_ordered,o="items_per_box"===t?r:n[e].items_per_box;i&&o&&(n[e].quantity_ordered=parseInt(i)*parseInt(o))}j(n)};return(0,C.jsxs)(T.A,{open:t,onClose:()=>r(),maxWidth:"md",fullWidth:!0,children:[(0,C.jsx)(U.A,{children:(0,C.jsxs)(a.A,{display:"flex",alignItems:"center",gap:1,children:[(0,C.jsx)(Q.A,{color:"primary"}),s?"Edit Purchase Order":"Create Purchase Order"]})}),(0,C.jsx)(B.A,{children:(0,C.jsxs)(M.Ay,{container:!0,spacing:2,sx:{mt:1},children:[(0,C.jsx)(M.Ay,{item:!0,xs:12,sm:6,children:(0,C.jsx)(u.A,{select:!0,fullWidth:!0,required:!0,label:"Supplier",name:"supplier_id",value:c.supplier_id,onChange:z,children:o.map(e=>(0,C.jsx)(h.A,{value:e.id,children:e.name},e.id))})}),(0,C.jsx)(M.Ay,{item:!0,xs:12,sm:6,children:(0,C.jsx)(u.A,{fullWidth:!0,required:!0,type:"date",label:"Order Date",name:"order_date",value:c.order_date,onChange:z,InputLabelProps:{shrink:!0}})}),(0,C.jsxs)(M.Ay,{item:!0,xs:12,children:[(0,C.jsx)(H.A,{sx:{my:1}}),(0,C.jsxs)(a.A,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[(0,C.jsx)(l.A,{variant:"h6",children:"Items to Order"}),(0,C.jsx)(d.A,{startIcon:(0,C.jsx)(F.A,{}),onClick:()=>{j([...x,{product_id:"",product_name:"",quantity_ordered:1,boxes_ordered:"",items_per_box:1}])},children:"Add Item"})]}),(0,C.jsx)(m.A,{children:(0,C.jsxs)(_.A,{size:"small",children:[(0,C.jsx)(g.A,{children:(0,C.jsxs)(A.A,{children:[(0,C.jsx)(v.A,{children:(0,C.jsx)("strong",{children:"Product"})}),(0,C.jsx)(v.A,{width:"100",children:(0,C.jsx)("strong",{children:"Boxes"})}),(0,C.jsx)(v.A,{width:"100",children:(0,C.jsx)("strong",{children:"Items/Box"})}),(0,C.jsx)(v.A,{width:"120",children:(0,C.jsx)("strong",{children:"Total Items"})}),(0,C.jsx)(v.A,{width:"50"})]})}),(0,C.jsx)(f.A,{children:x.map((e,t)=>(0,C.jsxs)(A.A,{children:[(0,C.jsx)(v.A,{children:(0,C.jsx)(V.A,{size:"small",options:y,getOptionLabel:e=>e.name||"",value:y.find(t=>t.id===e.product_id)||null,onChange:(e,r)=>{D(t,"product_id",(null===r||void 0===r?void 0:r.id)||"")},renderInput:e=>(0,C.jsx)(u.A,(0,L.A)((0,L.A)({},e),{},{placeholder:"Select product"}))})}),(0,C.jsx)(v.A,{children:(0,C.jsx)(u.A,{size:"small",fullWidth:!0,type:"number",placeholder:"Boxes",value:e.boxes_ordered,onChange:e=>D(t,"boxes_ordered",e.target.value),inputProps:{min:1}})}),(0,C.jsx)(v.A,{children:(0,C.jsx)(u.A,{size:"small",fullWidth:!0,type:"number",placeholder:"Per Box",value:e.items_per_box,onChange:e=>D(t,"items_per_box",e.target.value),inputProps:{min:1}})}),(0,C.jsx)(v.A,{children:(0,C.jsx)(u.A,{size:"small",fullWidth:!0,type:"number",value:e.quantity_ordered,onChange:e=>D(t,"quantity_ordered",e.target.value),inputProps:{min:1},helperText:"Total Units"})}),(0,C.jsx)(v.A,{children:(0,C.jsx)(b.A,{size:"small",color:"error",onClick:()=>(e=>{j(x.filter((t,r)=>r!==e))})(t),children:(0,C.jsx)(W.A,{fontSize:"small"})})})]},t))})]})})]}),(0,C.jsx)(M.Ay,{item:!0,xs:12,children:(0,C.jsx)(u.A,{fullWidth:!0,multiline:!0,rows:2,label:"Notes (Optional)",name:"notes",value:c.notes,onChange:z,placeholder:"Any special instructions for the supplier..."})}),(0,C.jsx)(M.Ay,{item:!0,xs:12,children:(0,C.jsx)(a.A,{bgcolor:"info.light",p:2,borderRadius:1,children:(0,C.jsxs)(l.A,{variant:"body2",color:"info.dark",children:[(0,C.jsx)("strong",{children:"Note:"})," Prices will be entered when you receive the stock from the supplier."]})})})]})}),(0,C.jsxs)(J.A,{children:[(0,C.jsx)(d.A,{onClick:()=>r(),children:"Cancel"}),(0,C.jsx)(d.A,{onClick:async()=>{if(c.supplier_id)if(0!==x.length)if(x.some(e=>!e.product_id||e.quantity_ordered<=0))N.oR.error("Please fill in all item details correctly");else{P(!0);try{const{data:{session:e}}=await I.N.auth.getSession();if(!e)throw new Error("Not authenticated");if(s){const{error:e}=await I.N.from("purchase_orders").update({supplier_id:c.supplier_id,order_date:c.order_date,notes:c.notes,updated_at:(new Date).toISOString()}).eq("id",i.id);if(e)throw e;await I.N.from("purchase_order_items").delete().eq("purchase_order_id",i.id);const{error:t}=await I.N.from("purchase_order_items").insert(x.map(e=>({purchase_order_id:i.id,product_id:e.product_id,quantity_ordered:e.quantity_ordered,boxes_ordered:e.boxes_ordered?parseInt(e.boxes_ordered):null,items_per_box:e.items_per_box?parseInt(e.items_per_box):1,unit_price:0})));if(t)throw t;N.oR.success("PO updated successfully!"),r()}else{const{data:t}=await I.N.rpc("generate_po_number"),n=t||"PO-".concat(Date.now()),{data:i,error:s}=await I.N.from("purchase_orders").insert([{po_number:n,supplier_id:c.supplier_id,currency_id:null,order_date:c.order_date,status:"draft",notes:c.notes,created_by:e.user.id,organization_id:e.user.id,total_amount:0,final_amount:0}]).select().single();if(s)throw s;const{error:a}=await I.N.from("purchase_order_items").insert(x.map(e=>({purchase_order_id:i.id,product_id:e.product_id,quantity_ordered:e.quantity_ordered,boxes_ordered:e.boxes_ordered?parseInt(e.boxes_ordered):null,items_per_box:e.items_per_box?parseInt(e.items_per_box):1,unit_price:0})));if(a)throw a;N.oR.success("Purchase Order created successfully!");const l=x.map(e=>{var t;return(0,L.A)((0,L.A)({},e),{},{product_name:null===(t=y.find(t=>t.id===e.product_id))||void 0===t?void 0:t.name})});r(i,l,o.find(e=>e.id===c.supplier_id))}}catch(e){console.error("Error saving PO:",e),N.oR.error("Failed to save purchase order: "+e.message)}finally{P(!1)}}else N.oR.error("Please add at least one item");else N.oR.error("Please select a supplier")},variant:"contained",disabled:S,children:s?"Update Order":"Create Order"})]})]})}var G=r(33438),X=r(47968),K=r(68970);function Z(e){let{open:t,onClose:r,purchaseOrder:i,poItems:o}=e;const[s,c]=(0,n.useState)([]),[p,x]=(0,n.useState)((new Date).toISOString().split("T")[0]),[h,y]=(0,n.useState)(""),[b,w]=(0,n.useState)(!1);(0,n.useEffect)(()=>{t&&o&&S()},[t,o]);const S=async()=>{try{const e=o.map(e=>e.product_id),{data:t,error:r}=await I.N.from("products").select("id, price, cost_price, items_per_box").in("id",e);if(r)throw r;const n={};null===t||void 0===t||t.forEach(e=>{n[e.id]=e}),c(o.map(e=>{var t;const r=n[e.product_id];return{po_item_id:e.id,product_id:e.product_id,product_name:e.product_name||(null===(t=e.products)||void 0===t?void 0:t.name),quantity_ordered:e.quantity_ordered,quantity_already_received:e.quantity_received,quantity_remaining:e.quantity_ordered-e.quantity_received,quantity_to_receive:0,unit_price:e.unit_price||(null===r||void 0===r?void 0:r.cost_price)||0,selling_price:(null===r||void 0===r?void 0:r.price)||0,boxes_received:"",items_per_box:e.items_per_box||(null===r||void 0===r?void 0:r.items_per_box)||1,cost_per_box:"",total_cost:"",selling_price_per_box:"",total_selling_price:0}}))}catch(e){console.error("Error fetching product details:",e),N.oR.error("Failed to load product details")}},P=(e,t,r)=>{const n=[...s];if("boxes_received"===t||"items_per_box"===t){n[e][t]=r;const i=parseFloat(n[e].boxes_received)||0,o=parseFloat(n[e].items_per_box)||1;if(i>0){const t=Math.round(i*o),r=n[e].quantity_remaining;n[e].quantity_to_receive=Math.min(t,r)}}else{const t=n[e].quantity_remaining,i=Math.min(parseInt(r)||0,t);n[e].quantity_to_receive=i}c(n)},R=(e,t,r)=>{const n=[...s];n[e][t]=parseFloat(r)||0;const i=parseFloat(n[e].boxes_received)||0,o=parseFloat(n[e].items_per_box)||1,a=i*o;if("total_cost"===t||"boxes_received"===t||"items_per_box"===t){const o=parseFloat("total_cost"===t?r:n[e].total_cost)||0;i>0&&(n[e].cost_per_box=o/i,a>0&&(n[e].unit_price=o/a))}if("selling_price_per_box"===t||"items_per_box"===t||"boxes_received"===t){const s=parseFloat("selling_price_per_box"===t?r:n[e].selling_price_per_box)||0;o>0&&(n[e].selling_price=s/o),i>0&&(n[e].total_selling_price=s*i)}c(n)},O=s.reduce((e,t)=>e+t.quantity_to_receive,0),z=s.reduce((e,t)=>e+(parseFloat(t.total_cost)||0),0);return(0,C.jsxs)(T.A,{open:t,onClose:r,maxWidth:"xl",fullWidth:!0,children:[(0,C.jsx)(U.A,{children:(0,C.jsxs)(a.A,{display:"flex",alignItems:"center",gap:1,children:[(0,C.jsx)(q.A,{color:"primary"}),"Receive Stock - PO: ",null===i||void 0===i?void 0:i.po_number]})}),(0,C.jsx)(B.A,{children:(0,C.jsxs)(M.Ay,{container:!0,spacing:2,sx:{mt:1},children:[(0,C.jsx)(M.Ay,{item:!0,xs:12,children:(0,C.jsx)(u.A,{fullWidth:!0,type:"date",label:"Received Date",value:p,onChange:e=>x(e.target.value),InputLabelProps:{shrink:!0}})}),(0,C.jsx)(M.Ay,{item:!0,xs:12,children:(0,C.jsx)(m.A,{sx:{overflowX:"auto",maxHeight:"60vh"},children:(0,C.jsxs)(_.A,{size:"small",stickyHeader:!0,children:[(0,C.jsx)(g.A,{children:(0,C.jsxs)(A.A,{children:[(0,C.jsx)(v.A,{children:"Product"}),(0,C.jsx)(v.A,{align:"center",children:"Ordered"}),(0,C.jsx)(v.A,{align:"center",children:"Received"}),(0,C.jsx)(v.A,{align:"center",children:"Remaining"}),(0,C.jsx)(v.A,{align:"center",sx:{bgcolor:"#e3f2fd"},children:"Boxes Received"}),(0,C.jsx)(v.A,{align:"center",sx:{bgcolor:"#e3f2fd"},children:"Items/Box"}),(0,C.jsx)(v.A,{align:"center",sx:{bgcolor:"#e3f2fd"},children:"Total Cost"}),(0,C.jsx)(v.A,{align:"center",sx:{bgcolor:"#e3f2fd"},children:"MRP/Box"}),(0,C.jsx)(v.A,{align:"center",sx:{bgcolor:"#f5f5f5"},children:"Total Items"}),(0,C.jsx)(v.A,{align:"center",sx:{bgcolor:"#f5f5f5"},children:"Cost/Box"}),(0,C.jsx)(v.A,{align:"center",sx:{bgcolor:"#f5f5f5"},children:"Cost/Item"}),(0,C.jsx)(v.A,{align:"center",sx:{bgcolor:"#f5f5f5"},children:"Sale/Item"}),(0,C.jsx)(v.A,{align:"center",sx:{bgcolor:"#f5f5f5"},children:"Total Selling"}),(0,C.jsx)(v.A,{})]})}),(0,C.jsx)(f.A,{children:s.map((e,t)=>(0,C.jsxs)(A.A,{children:[(0,C.jsx)(v.A,{children:e.product_name}),(0,C.jsx)(v.A,{align:"center",children:(0,C.jsx)(j.A,{label:e.quantity_ordered,size:"small"})}),(0,C.jsx)(v.A,{align:"center",children:(0,C.jsx)(j.A,{label:e.quantity_already_received,size:"small",color:e.quantity_already_received>0?"success":"default"})}),(0,C.jsx)(v.A,{align:"center",children:(0,C.jsx)(j.A,{label:e.quantity_remaining,size:"small",color:e.quantity_remaining>0?"warning":"success"})}),(0,C.jsx)(v.A,{align:"center",sx:{bgcolor:"#f5faff"},children:(0,C.jsx)(u.A,{type:"number",size:"small",placeholder:"Boxes",value:e.boxes_received,onChange:e=>P(t,"boxes_received",e.target.value),inputProps:{min:0,style:{width:"60px",textAlign:"center"}},disabled:0===e.quantity_remaining})}),(0,C.jsx)(v.A,{align:"center",sx:{bgcolor:"#f5faff"},children:(0,C.jsx)(u.A,{type:"number",size:"small",placeholder:"/Box",value:e.items_per_box,onChange:e=>P(t,"items_per_box",e.target.value),inputProps:{min:1,style:{width:"50px",textAlign:"center"}},disabled:0===e.quantity_remaining})}),(0,C.jsx)(v.A,{align:"center",sx:{bgcolor:"#f5faff"},children:(0,C.jsx)(u.A,{type:"number",size:"small",placeholder:"Total",value:e.total_cost,onChange:e=>R(t,"total_cost",e.target.value),inputProps:{min:0,step:.01,style:{width:"80px",textAlign:"center"}}})}),(0,C.jsx)(v.A,{align:"center",sx:{bgcolor:"#f5faff"},children:(0,C.jsx)(u.A,{type:"number",size:"small",value:e.selling_price_per_box,onChange:e=>R(t,"selling_price_per_box",e.target.value),placeholder:"MRP",inputProps:{min:0,step:.01,style:{width:"80px",textAlign:"center"}}})}),(0,C.jsx)(v.A,{align:"center",sx:{bgcolor:"#f5f5f5"},children:(0,C.jsx)(l.A,{variant:"body2",fontWeight:600,children:e.quantity_to_receive})}),(0,C.jsx)(v.A,{align:"center",sx:{bgcolor:"#f5f5f5"},children:(0,C.jsx)(l.A,{variant:"body2",children:e.cost_per_box?parseFloat(e.cost_per_box).toFixed(2):"-"})}),(0,C.jsx)(v.A,{align:"center",sx:{bgcolor:"#f5f5f5"},children:(0,C.jsx)(l.A,{variant:"body2",children:e.unit_price?parseFloat(e.unit_price).toFixed(2):"-"})}),(0,C.jsx)(v.A,{align:"center",sx:{bgcolor:"#f5f5f5"},children:(0,C.jsx)(l.A,{variant:"body2",children:e.selling_price?parseFloat(e.selling_price).toFixed(2):"-"})}),(0,C.jsx)(v.A,{align:"center",sx:{bgcolor:"#f5f5f5"},children:(0,C.jsx)(l.A,{variant:"body2",fontWeight:600,color:"success.main",children:e.total_selling_price?parseFloat(e.total_selling_price).toFixed(2):"-"})}),(0,C.jsx)(v.A,{children:e.quantity_remaining>0&&(0,C.jsx)(d.A,{size:"small",onClick:()=>(e=>{const t=[...s];t[e].quantity_to_receive=t[e].quantity_remaining,c(t)})(t),children:"All"})})]},t))})]})})}),(0,C.jsx)(M.Ay,{item:!0,xs:12,children:(0,C.jsx)(a.A,{bgcolor:"primary.main",color:"white",p:2,borderRadius:1,children:(0,C.jsxs)(M.Ay,{container:!0,children:[(0,C.jsx)(M.Ay,{item:!0,xs:6,children:(0,C.jsxs)(l.A,{variant:"h6",children:["Total Items: ",O]})}),(0,C.jsx)(M.Ay,{item:!0,xs:6,children:(0,C.jsxs)(l.A,{variant:"h6",align:"right",children:["Total Cost: Rs ",z.toFixed(2)]})})]})})}),(0,C.jsx)(M.Ay,{item:!0,xs:12,children:(0,C.jsx)(u.A,{fullWidth:!0,multiline:!0,rows:2,label:"Delivery Notes",value:h,onChange:e=>y(e.target.value),placeholder:"Optional notes about this delivery (condition, packaging, etc.)"})})]})}),(0,C.jsxs)(J.A,{children:[(0,C.jsx)(d.A,{onClick:r,children:"Cancel"}),(0,C.jsx)(d.A,{variant:"contained",startIcon:(0,C.jsx)(K.A,{}),onClick:async()=>{const e=s.filter(e=>e.quantity_to_receive>0);if(0===e.length)return void N.oR.error("Please enter quantities to receive");if(e.filter(e=>e.unit_price<=0||e.selling_price<=0).length>0)N.oR.error("Please enter both purchasing and selling prices for all items being received");else{w(!0);try{const{data:{session:t}}=await I.N.auth.getSession();if(!t)throw new Error("Not authenticated");for(const r of e){const{data:e,error:n}=await I.N.from("stock_receipts").insert([{product_id:r.product_id,quantity:r.quantity_to_receive,received_date:p,notes:h,purchase_order_id:i.id,organization_id:t.user.id}]).select().single();if(n)throw n;const{data:o,error:s}=await I.N.from("products").select("stock").eq("id",r.product_id).single();if(s)throw s;const a=((null===o||void 0===o?void 0:o.stock)||0)+parseInt(r.quantity_to_receive),{error:l}=await I.N.from("products").update({stock:a,cost_price:r.unit_price,price:r.selling_price,items_per_box:r.items_per_box,price_per_box:r.selling_price_per_box}).eq("id",r.product_id);if(l)throw l;const{error:d}=await I.N.from("purchase_order_items").update({quantity_received:r.quantity_already_received+r.quantity_to_receive,unit_price:r.unit_price}).eq("id",r.po_item_id);if(d)throw d;await I.N.from("po_receiving_history").insert([{purchase_order_id:i.id,po_item_id:r.po_item_id,quantity_received:r.quantity_to_receive,received_date:p,received_by:t.user.id,stock_receipt_id:e.id,notes:h,boxes_received:r.boxes_received?parseInt(r.boxes_received):null}])}s.every(e=>e.quantity_already_received+e.quantity_to_receive>=e.quantity_ordered)?await I.N.from("purchase_orders").update({status:"received"}).eq("id",i.id):await I.N.from("purchase_orders").update({status:"partially_received"}).eq("id",i.id),N.oR.success("Stock received successfully!"),r()}catch(t){console.error("Error receiving stock:",t),N.oR.error("Failed to receive stock: "+t.message)}finally{w(!1)}}},disabled:b||0===O,children:"Receive Stock"})]})]})}var $=r(37762),ee=r(64857);const te=async(e,t,r)=>{try{var n,i;const o=new $.Ay,s=(null===r||void 0===r?void 0:r.store_name)||"Medical Store",a=(null===e||void 0===e?void 0:e.po_number)||"DRAFT",l=null!==e&&void 0!==e&&e.order_date?new Date(e.order_date).toLocaleDateString():(new Date).toLocaleDateString(),d=(null===e||void 0===e||null===(n=e.suppliers)||void 0===n?void 0:n.name)||"N/A",c=(null===e||void 0===e||null===(i=e.suppliers)||void 0===i?void 0:i.phone)||"",p=Array.isArray(t)?t:[];o.setFontSize(20),o.setFont(void 0,"bold"),o.text(s,105,20,{align:"center"}),o.setFontSize(10),o.setFont(void 0,"normal");let u=28;null!==r&&void 0!==r&&r.address&&(o.text(r.address,105,u,{align:"center"}),u+=5),null!==r&&void 0!==r&&r.phone&&(o.text("Phone: ".concat(r.phone),105,u,{align:"center"}),u+=5),null!==r&&void 0!==r&&r.owner_name&&(o.text("Owner: ".concat(r.owner_name),105,u,{align:"center"}),u+=5),o.setLineWidth(.5),o.line(14,u+3,196,u+3),o.setFontSize(16),o.setFont(void 0,"bold"),o.text("PURCHASE ORDER",105,u+12,{align:"center"});const x=u+22;o.setFontSize(11),o.setFont(void 0,"bold"),o.text("PO Details:",14,x),o.setFont(void 0,"normal"),o.text("PO Number: ".concat(a),14,x+7),o.text("Order Date: ".concat(l),14,x+14),o.setFont(void 0,"bold"),o.text("Supplier:",120,x),o.setFont(void 0,"normal"),o.text(d,120,x+7),c&&o.text("Phone: ".concat(c),120,x+14);const h=["#","Product","Quantity (Boxes)"],m=p.map((e,t)=>{var r;let n="N/A";e.product_name?n=e.product_name:null!==(r=e.products)&&void 0!==r&&r.name&&(n=e.products.name);const i=e.quantity_ordered||0;return[(t+1).toString(),n,i.toString()]});(0,ee.Ay)(o,{head:[h],body:m,startY:x+25,theme:"striped",headStyles:{fillColor:[41,128,185],fontStyle:"bold",fontSize:11},styles:{fontSize:10},columnStyles:{0:{cellWidth:15},1:{cellWidth:125},2:{cellWidth:40,halign:"center"}}});let _=o.lastAutoTable&&o.lastAutoTable.finalY||x+30+10;if(null!==e&&void 0!==e&&e.notes){o.setFontSize(10),o.setFont(void 0,"bold"),o.text("Notes:",14,_),o.setFont(void 0,"normal");const t=o.splitTextToSize(e.notes,180);o.text(t,14,_+6),_+=6+5*t.length}_+=15,_>250&&(o.addPage(),_=20),o.setFontSize(10),o.setFont(void 0,"normal"),o.text("Prepared By:",14,_),o.line(14,_+15,80,_+15),o.setFontSize(9),o.text("Signature & Date",30,_+20),o.setFontSize(10),o.text("Approved By:",120,_),o.line(120,_+15,186,_+15),o.setFontSize(9),o.text("Signature & Date",135,_+20);const g=o.internal.pageSize.height;o.setFontSize(9),o.setFont(void 0,"italic"),o.setTextColor(100,100,100);const A=g-20;return null!==r&&void 0!==r&&r.footer_text?o.text(r.footer_text,105,A,{align:"center"}):o.text("Thank you for your service!",105,A,{align:"center"}),o.setFontSize(8),o.text("Page 1",105,A+10,{align:"center"}),o.output("blob")}catch(o){console.error("PDF Generation Error:",o);const e=new $.Ay;return e.text("Error generating PDF receipt.",10,10),e.text(o.message,10,20),e.output("blob")}};var re=r(88458);function ne(e){var t,r;let{open:i,onClose:o,purchaseOrder:s,onRefresh:c}=e;const[p,u]=(0,n.useState)(null),[x,h]=(0,n.useState)([]),[w,S]=(0,n.useState)([]),[P,O]=(0,n.useState)(!1),[z,F]=(0,n.useState)(!1);(0,n.useEffect)(()=>{i&&s&&D()},[i,s]);const D=async()=>{if(s)try{const{data:e,error:t}=await I.N.from("purchase_orders").select("\n                    *,\n                    suppliers(name, phone, supplier_contacts(*))\n                ").eq("id",s.id).single();if(t)throw t;u(e);const{data:r,error:n}=await I.N.from("purchase_order_items").select("*, products(name)").eq("purchase_order_id",s.id);if(n)throw n;h(r||[]);const{data:i,error:o}=await I.N.from("po_receiving_history").select("*").eq("purchase_order_id",s.id).order("created_at",{ascending:!1});if(o)throw o;S(i||[])}catch(e){console.error("Error fetching PO details:",e),N.oR.error("Failed to load PO details")}};if(!p)return null;return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsxs)(T.A,{open:i,onClose:o,maxWidth:"md",fullWidth:!0,children:[(0,C.jsx)(U.A,{children:(0,C.jsxs)(a.A,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[(0,C.jsxs)(l.A,{variant:"h6",children:["Purchase Order: ",p.po_number]}),(0,C.jsx)(b.A,{onClick:o,children:(0,C.jsx)(G.A,{})})]})}),(0,C.jsx)(B.A,{children:(0,C.jsxs)(M.Ay,{container:!0,spacing:2,children:[(0,C.jsx)(M.Ay,{item:!0,xs:12,children:(0,C.jsxs)(a.A,{display:"flex",gap:1,flexWrap:"wrap",children:[(0,C.jsx)(j.A,{label:(k=p.status,{draft:"Draft",sent:"Sent",partially_received:"Receiving",received:"Completed"}[k]||k),color:(e=>({draft:"default",sent:"primary",partially_received:"secondary",received:"success"}[e]||"default"))(p.status)}),(0,C.jsx)(j.A,{label:"Order: ".concat(new Date(p.order_date).toLocaleDateString()),variant:"outlined"}),p.expected_delivery_date&&(0,C.jsx)(j.A,{label:"Expected: ".concat(new Date(p.expected_delivery_date).toLocaleDateString()),variant:"outlined"})]})}),(0,C.jsxs)(M.Ay,{item:!0,xs:12,children:[(0,C.jsx)(l.A,{variant:"subtitle2",color:"text.secondary",children:"Supplier"}),(0,C.jsx)(l.A,{variant:"h6",children:null===(t=p.suppliers)||void 0===t?void 0:t.name}),(null===(r=p.suppliers)||void 0===r?void 0:r.phone)&&(0,C.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["Phone: ",p.suppliers.phone]})]}),(0,C.jsxs)(M.Ay,{item:!0,xs:12,children:[(0,C.jsx)(H.A,{sx:{my:1}}),(0,C.jsx)(l.A,{variant:"h6",gutterBottom:!0,children:"Items"}),(0,C.jsx)(m.A,{children:(0,C.jsxs)(_.A,{size:"small",children:[(0,C.jsx)(g.A,{children:(0,C.jsxs)(A.A,{children:[(0,C.jsx)(v.A,{children:"Product"}),(0,C.jsx)(v.A,{align:"center",children:"Ordered"}),(0,C.jsx)(v.A,{align:"center",children:"Received"}),"draft"!==p.status&&(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(v.A,{align:"right",children:"Unit Price"}),(0,C.jsx)(v.A,{align:"right",children:"Total"})]})]})}),(0,C.jsx)(f.A,{children:x.map(e=>{var t;return(0,C.jsxs)(A.A,{children:[(0,C.jsx)(v.A,{children:null===(t=e.products)||void 0===t?void 0:t.name}),(0,C.jsx)(v.A,{align:"center",children:(0,C.jsx)(j.A,{label:e.boxes_ordered?"".concat(e.boxes_ordered," Boxes (").concat(e.quantity_ordered,")"):e.quantity_ordered,size:"small"})}),(0,C.jsx)(v.A,{align:"center",children:(0,C.jsx)(j.A,{label:e.quantity_received,size:"small",color:e.quantity_received>=e.quantity_ordered?"success":"default"})}),"draft"!==p.status&&(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(v.A,{align:"right",children:e.unit_price>0?"Rs ".concat((0,E.vv)(e.unit_price,"")):"\u2014"}),(0,C.jsx)(v.A,{align:"right",children:e.unit_price>0?"Rs ".concat((0,E.vv)(e.quantity_ordered*e.unit_price,"")):"\u2014"})]})]},e.id)})})]})})]}),w.length>0&&(0,C.jsxs)(M.Ay,{item:!0,xs:12,children:[(0,C.jsx)(H.A,{sx:{my:1}}),(0,C.jsx)(l.A,{variant:"h6",gutterBottom:!0,children:"Receiving History"}),w.map(e=>(0,C.jsx)(a.A,{sx:{mb:1,p:1,bgcolor:"grey.50",borderRadius:1},children:(0,C.jsxs)(l.A,{variant:"body2",children:[(0,C.jsxs)("strong",{children:[new Date(e.received_date).toLocaleDateString(),":"]})," ","Received ",e.quantity_received," units",e.notes&&" - ".concat(e.notes)]})},e.id))]}),p.notes&&(0,C.jsxs)(M.Ay,{item:!0,xs:12,children:[(0,C.jsx)(l.A,{variant:"subtitle2",color:"text.secondary",children:"Notes"}),(0,C.jsx)(l.A,{variant:"body2",children:p.notes})]})]})}),(0,C.jsxs)(J.A,{sx:{flexWrap:"wrap",gap:1,p:2},children:[(0,C.jsx)(a.A,{flex:1,display:"flex",gap:1,children:(0,C.jsx)(y.A,{title:"Download PDF",children:(0,C.jsx)(b.A,{color:"primary",onClick:async()=>{try{const{data:{session:e}}=await I.N.auth.getSession(),{data:t}=await I.N.from("settings").select("*").eq("organization_id",e.user.id).single(),r=await te(p,x,t),n=URL.createObjectURL(r),i=document.createElement("a");i.href=n,i.download="".concat(p.po_number,".pdf"),i.click(),URL.revokeObjectURL(n),N.oR.success("PDF downloaded!")}catch(e){console.error("Error generating PDF:",e),N.oR.error("Failed to generate PDF")}},children:(0,C.jsx)(X.A,{})})})}),(0,C.jsxs)(a.A,{display:"flex",gap:1,flexWrap:"wrap",children:["draft"===p.status&&(0,C.jsx)(d.A,{startIcon:(0,C.jsx)(R,{}),variant:"contained",onClick:async()=>{F(!0);try{var e,t,r;const{data:{session:i}}=await I.N.auth.getSession(),{data:o}=await I.N.from("settings").select("*").eq("organization_id",i.user.id).single();try{const e=await te(p,x,o),t=URL.createObjectURL(e),r=document.createElement("a");r.href=t,r.download="".concat(p.po_number,".pdf"),r.click(),URL.revokeObjectURL(t),N.oR.info("PDF downloaded! Please attach it to the WhatsApp chat.")}catch(n){console.error("PDF Error:",n),N.oR.warning("Could not generate PDF, but opening WhatsApp...")}const{error:a}=await I.N.from("purchase_orders").update({status:"sent",sent_at:(new Date).toISOString()}).eq("id",s.id);if(a)throw a;const l=null===(e=p.suppliers)||void 0===e||null===(t=e.supplier_contacts)||void 0===t?void 0:t.find(e=>e.is_primary),d=(null===l||void 0===l?void 0:l.phone)||(null===(r=p.suppliers)||void 0===r?void 0:r.phone);if(d){const e="Hello! Please find the Purchase Order ".concat(p.po_number,". We need these items as soon as possible. Thank you!");setTimeout(()=>(0,re.JT)(d,e),1e3)}else N.oR.warning("No phone number found for supplier");N.oR.success("PO marked as sent!"),c(),D()}catch(i){console.error("Error sending PO:",i),N.oR.error("Failed to send PO")}finally{F(!1)}},disabled:z,children:"Send to Supplier"}),("sent"===p.status||"partially_received"===p.status)&&(0,C.jsx)(d.A,{startIcon:(0,C.jsx)(q.A,{}),variant:"contained",color:"primary",onClick:()=>{O(!0)},children:"Receive Stock"}),(0,C.jsx)(d.A,{onClick:o,children:"Close"})]})]})]}),(0,C.jsx)(Z,{open:P,onClose:()=>{O(!1),D(),c()},purchaseOrder:p,poItems:x})]});var k}var ie=r(63336),oe=r(25298),se=r(30513);const ae=(0,P.A)((0,C.jsx)("path",{d:"M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92"}),"Share"),le=(e,t,r)=>{try{var n,i;const o=(null===r||void 0===r?void 0:r.store_name)||"Medical Store",s=(null===r||void 0===r||r.currency_symbol,(null===e||void 0===e?void 0:e.po_number)||"DRAFT"),a=null!==e&&void 0!==e&&e.order_date?new Date(e.order_date).toLocaleDateString():(new Date).toLocaleDateString(),l=(null===e||void 0===e||null===(n=e.suppliers)||void 0===n?void 0:n.name)||"N/A",d=(null===e||void 0===e||null===(i=e.suppliers)||void 0===i?void 0:i.phone)||"",c='\n<!DOCTYPE html>\n<html>\n<head>\n    <meta charset="UTF-8">\n    <title>PO #'.concat(s,'</title>\n    <style>\n        @media print {\n            @page {\n                size: 80mm auto;\n                margin: 5mm;\n            }\n            body {\n                margin: 0;\n                padding: 0;\n            }\n        }\n        \n        body {\n            font-family: \'Courier New\', monospace;\n            width: 80mm;\n            margin: 0 auto;\n            padding: 10px;\n            font-size: 12px;\n        }\n        \n        .header {\n            text-align: center;\n            margin-bottom: 15px;\n            border-bottom: 2px dashed #000;\n            padding-bottom: 10px;\n        }\n       \n        .store-name {\n            font-size: 18px;\n            font-weight: bold;\n            margin-bottom: 5px;\n        }\n        \n        .receipt-title {\n            font-size: 14px;\n            font-weight: bold;\n            margin-bottom: 5px;\n        }\n        \n        .info-row {\n            display: flex;\n            justify-content: space-between;\n            font-size: 11px;\n            margin-bottom: 2px;\n        }\n        \n        .items-table {\n            width: 100%;\n            margin: 10px 0;\n            border-collapse: collapse;\n        }\n        \n        .items-table th {\n            text-align: left;\n            border-bottom: 1px solid #000;\n            padding: 5px 2px;\n            font-size: 10px;\n        }\n        \n        .items-table td {\n            padding: 5px 2px;\n            font-size: 10px;\n            vertical-align: top;\n        }\n        \n        .item-name {\n            max-width: 40mm;\n            word-wrap: break-word;\n        }\n        \n        .text-center {\n            text-align: center;\n        }\n        \n        .text-right {\n            text-align: right;\n        }\n        \n        .footer {\n            text-align: center;\n            margin-top: 15px;\n            padding-top: 10px;\n            border-top: 2px dashed #000;\n            font-size: 10px;\n            color: #555;\n        }\n        \n        .branding {\n            margin-top: 10px;\n            font-size: 9px;\n            color: #888;\n            font-style: italic;\n        }\n\n        .notes {\n            margin-top: 10px;\n            border-top: 1px dashed #000;\n            padding-top: 5px;\n            font-size: 11px;\n        }\n    </style>\n</head>\n<body>\n    <div class="header">\n        <div class="store-name">').concat(o,"</div>\n        ").concat(null!==r&&void 0!==r&&r.address?'<div style="font-size: 10px;">'.concat(r.address,"</div>"):"","\n        ").concat(null!==r&&void 0!==r&&r.phone?'<div style="font-size: 10px;">Phone: '.concat(r.phone,"</div>"):"",'\n        <div class="receipt-title" style="margin-top: 10px;">PURCHASE ORDER</div>\n    </div>\n\n    <div class="info-row">\n        <span>PO #:</span>\n        <span>').concat(s,'</span>\n    </div>\n    <div class="info-row">\n        <span>Date:</span>\n        <span>').concat(a,'</span>\n    </div>\n    <div class="info-row">\n        <span>Supplier:</span>\n        <span>').concat(l,"</span>\n    </div>\n    ").concat(d?'\n    <div class="info-row">\n        <span>Supplier Ph:</span>\n        <span>'.concat(d,"</span>\n    </div>"):"",'\n    \n    <table class="items-table">\n        <thead>\n            <tr>\n                <th>Item</th>\n                <th class="text-right">Qty (Boxes)</th>\n            </tr>\n        </thead>\n        <tbody>\n            ').concat(t.map(e=>{var t;let r="N/A";e.product_name?r=e.product_name:null!==(t=e.products)&&void 0!==t&&t.name&&(r=e.products.name);const n=e.quantity_ordered||0;return'\n                <tr>\n                    <td class="item-name">'.concat(r,'</td>\n                    <td class="text-right">').concat(n,"</td>\n                </tr>\n                ")}).join(""),"\n        </tbody>\n    </table>\n    \n    ").concat(e.notes?'\n    <div class="notes">\n        <strong>Notes:</strong><br/>\n        '.concat(e.notes,"\n    </div>\n    "):"",'\n    \n    <div class="footer">\n        ').concat((null===r||void 0===r?void 0:r.footer_text)||"Thank you for your service!",'\n        <div class="branding">\n            \n        </div>\n    </div>\n    \n    <script>\n        // Auto-close window after printing or canceling\n        window.onafterprint = function() {\n            window.close();\n        };\n        \n        // Trigger print dialog immediately\n        window.onload = function() {\n            window.print();\n        };\n    <\/script>\n</body>\n</html>\n        '),p=window.open("","_blank","width=400,height=600");return p?(p.document.write(c),p.document.close(),!0):(console.error("Could not open print window. Popup blocked?"),!1)}catch(o){return console.error("PO printing failed:",o),!1}};var de=r(65239),ce=r.n(de);function pe(e){let{open:t,onClose:r,purchaseOrder:n,poItems:s,supplier:c,settings:p}=e;const u=(0,i.A)(),x=(0,o.A)(u.breakpoints.down("sm"));if(!n||!s||!c)return null;return(0,C.jsxs)(T.A,{open:t,onClose:r,maxWidth:"sm",fullWidth:!0,children:[(0,C.jsx)(U.A,{children:(0,C.jsxs)(a.A,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[(0,C.jsxs)(a.A,{display:"flex",alignItems:"center",gap:1,children:[(0,C.jsx)(O.A,{color:"success"}),(0,C.jsx)(l.A,{variant:"h6",children:"Purchase Order Created!"})]}),(0,C.jsx)(b.A,{onClick:r,size:"small",children:(0,C.jsx)(G.A,{})})]})}),(0,C.jsx)(B.A,{children:(0,C.jsxs)(ie.A,{id:"po-receipt-content",elevation:3,sx:{p:3,bgcolor:"grey.50",border:"1px solid",borderColor:"grey.300"},children:[(0,C.jsxs)(a.A,{textAlign:"center",mb:2,children:[(0,C.jsx)(l.A,{variant:"h5",fontWeight:700,color:"primary",gutterBottom:!0,children:(null===p||void 0===p?void 0:p.store_name)||"Medical Store"}),(null===p||void 0===p?void 0:p.address)&&(0,C.jsx)(l.A,{variant:"body2",color:"text.secondary",children:p.address}),(null===p||void 0===p?void 0:p.phone)&&(0,C.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["Phone: ",p.phone]}),(null===p||void 0===p?void 0:p.owner_name)&&(0,C.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["Owner: ",p.owner_name]})]}),(0,C.jsx)(H.A,{sx:{my:2,borderColor:"primary.main",borderWidth:1}}),(0,C.jsxs)(a.A,{textAlign:"center",my:2,children:[(0,C.jsx)(l.A,{variant:"h6",fontWeight:700,color:"text.primary",children:"PURCHASE ORDER"}),(0,C.jsx)(l.A,{variant:"h4",fontWeight:700,color:"primary",mt:1,children:n.po_number})]}),(0,C.jsx)(H.A,{sx:{my:2}}),(0,C.jsx)(_.A,{size:"small",children:(0,C.jsxs)(f.A,{children:[(0,C.jsxs)(A.A,{children:[(0,C.jsx)(v.A,{sx:{fontWeight:600,border:"none",py:.5},children:"Date:"}),(0,C.jsx)(v.A,{sx:{border:"none",py:.5},children:new Date(n.order_date).toLocaleDateString()})]}),(0,C.jsxs)(A.A,{children:[(0,C.jsx)(v.A,{sx:{fontWeight:600,border:"none",py:.5},children:"Supplier:"}),(0,C.jsx)(v.A,{sx:{border:"none",py:.5},children:null===c||void 0===c?void 0:c.name})]}),(null===c||void 0===c?void 0:c.phone)&&(0,C.jsxs)(A.A,{children:[(0,C.jsx)(v.A,{sx:{fontWeight:600,border:"none",py:.5},children:"Supplier Phone:"}),(0,C.jsx)(v.A,{sx:{border:"none",py:.5},children:c.phone})]})]})}),(0,C.jsx)(H.A,{sx:{my:2}}),(0,C.jsxs)(a.A,{mb:2,children:[(0,C.jsx)(l.A,{variant:"subtitle2",fontWeight:700,color:"text.secondary",gutterBottom:!0,children:"Items Ordered:"}),(0,C.jsx)(m.A,{sx:{bgcolor:"white",borderRadius:1,border:"1px solid",borderColor:"grey.300"},children:(0,C.jsxs)(_.A,{size:"small",children:[(0,C.jsx)(g.A,{children:(0,C.jsxs)(A.A,{sx:{bgcolor:"grey.100"},children:[(0,C.jsx)(v.A,{sx:{fontWeight:700},children:"Product"}),(0,C.jsx)(v.A,{align:"right",sx:{fontWeight:700},children:"Quantity"})]})}),(0,C.jsx)(f.A,{children:s.map((e,t)=>(0,C.jsxs)(A.A,{hover:!0,children:[(0,C.jsx)(v.A,{children:e.product_name}),(0,C.jsx)(v.A,{align:"right",children:(0,C.jsx)("strong",{children:e.boxes_ordered?"".concat(e.boxes_ordered," Boxes (").concat(e.quantity_ordered," items)"):"".concat(e.quantity_ordered," items")})})]},t))})]})})]}),n.notes&&(0,C.jsxs)(a.A,{mb:2,children:[(0,C.jsx)(l.A,{variant:"subtitle2",fontWeight:700,color:"text.secondary",gutterBottom:!0,children:"Notes:"}),(0,C.jsx)(a.A,{sx:{bgcolor:"info.lighter",p:1.5,borderRadius:1,border:"1px dashed",borderColor:"info.main"},children:(0,C.jsx)(l.A,{variant:"body2",children:n.notes})})]}),(0,C.jsx)(H.A,{sx:{my:2}}),(0,C.jsxs)(a.A,{mt:3,children:[(0,C.jsx)(l.A,{variant:"caption",color:"text.secondary",display:"block",gutterBottom:!0,children:"Digital Signature:"}),(0,C.jsxs)(a.A,{sx:{border:"2px dashed",borderColor:"grey.400",borderRadius:1,p:2,textAlign:"center",bgcolor:"grey.100"},children:[(0,C.jsxs)(l.A,{variant:"body2",color:"text.secondary",fontStyle:"italic",children:["Authorized by: ",(null===p||void 0===p?void 0:p.owner_name)||"Store Owner"]}),(0,C.jsx)(l.A,{variant:"caption",color:"text.secondary",children:(new Date).toLocaleString()})]})]}),(null===p||void 0===p?void 0:p.footer_text)&&(0,C.jsx)(a.A,{mt:2,textAlign:"center",children:(0,C.jsx)(l.A,{variant:"caption",color:"text.secondary",fontStyle:"italic",children:p.footer_text})}),(0,C.jsxs)(a.A,{mt:2,textAlign:"center",pt:2,borderTop:"1px dashed #ccc",children:[(0,C.jsxs)(l.A,{variant:"caption",color:"text.secondary",fontStyle:"italic",children:["Receipt designed and generated by ",(0,C.jsx)("strong",{children:"MedixFlow"})]}),(0,C.jsx)(l.A,{variant:"caption",display:"block",color:"text.secondary",children:"Contact: +923089020131"})]})]})}),(0,C.jsxs)(J.A,{sx:{p:2,flexDirection:"column",gap:1,bgcolor:"grey.50"},children:[(0,C.jsxs)(a.A,{display:"flex",gap:1,width:"100%",flexWrap:"wrap",justifyContent:"center",children:[(0,C.jsx)(d.A,{variant:"contained",startIcon:(0,C.jsx)(oe.A,{}),onClick:async()=>{var e,t;const r=(null===c||void 0===c?void 0:c.phone)||(null===c||void 0===c||null===(e=c.supplier_contacts)||void 0===e||null===(t=e.find(e=>e.is_primary))||void 0===t?void 0:t.phone);if(!r)return void N.oR.error("No phone number found for supplier");const i=N.oR.loading("Generating receipt image...");try{const e=await(async()=>{try{const e=document.getElementById("po-receipt-content");if(!e)return null;const t=await ce()(e,{scale:2,backgroundColor:"#ffffff",logging:!1});return new Promise(e=>{t.toBlob(t=>{e(t)},"image/png")})}catch(e){return console.error("Error generating image:",e),null}})();if(!e)throw new Error("Failed to generate image");const t=new File([e],"PO-".concat(n.po_number,".png"),{type:"image/png"});if(navigator.share&&navigator.canShare&&navigator.canShare({files:[t]}))N.oR.update(i,{render:"Opening share menu...",type:"info",isLoading:!1,autoClose:2e3}),await navigator.share({title:"PO ".concat(n.po_number),text:"Purchase Order: ".concat(n.po_number,"\n\nPlease find the order details in the attached image.\n\nThank you!"),files:[t]}),N.oR.success("Shared successfully!");else{const t=URL.createObjectURL(e),o=document.createElement("a");o.href=t,o.download="PO-".concat(n.po_number,".png"),o.click(),URL.revokeObjectURL(t),N.oR.update(i,{render:"Image downloaded! Opening WhatsApp - please attach it.",type:"success",isLoading:!1,autoClose:5e3});const s="Purchase Order: ".concat(n.po_number,"\n\nPlease find the order details in the downloaded image file.\n\nThank you!");setTimeout(()=>{(0,re.JT)(r,s)},1e3)}}catch(o){if(console.error("Error handling WhatsApp share:",o),"AbortError"===o.name)return void N.oR.dismiss(i);N.oR.update(i,{render:"Failed to share. Opening WhatsApp with text only.",type:"warning",isLoading:!1,autoClose:3e3});const e="Purchase Order: ".concat(n.po_number,"\n\nItems:\n").concat(s.map(e=>"- ".concat(e.product_name," x").concat(e.quantity_ordered)).join("\n"),"\n\nPlease confirm availability.");(0,re.JT)(r,e)}},fullWidth:x,sx:{bgcolor:"#25D366","&:hover":{bgcolor:"#1fb855"}},children:"Send via WhatsApp"}),(0,C.jsx)(d.A,{variant:"outlined",startIcon:(0,C.jsx)(X.A,{}),onClick:async()=>{try{const e=await te(n,s,p),t=URL.createObjectURL(e),r=document.createElement("a");r.href=t,r.download="".concat(n.po_number,".pdf"),r.click(),URL.revokeObjectURL(t),N.oR.success("PDF downloaded!")}catch(e){console.error("Error generating PDF:",e),N.oR.error("Failed to generate PDF: "+e.message)}},fullWidth:x,children:"Download PDF"})]}),(0,C.jsxs)(a.A,{display:"flex",gap:1,width:"100%",flexWrap:"wrap",justifyContent:"center",children:[(0,C.jsx)(d.A,{variant:"outlined",startIcon:(0,C.jsx)(se.A,{}),onClick:()=>{le(n,s,p)||N.oR.error("Failed to open print window. Please allow popups.")},fullWidth:x,children:"Print"}),(0,C.jsx)(d.A,{variant:"outlined",startIcon:(0,C.jsx)(ae,{}),onClick:async()=>{try{const e="Purchase Order: ".concat(n.po_number,"\n\nSupplier: ").concat(null===c||void 0===c?void 0:c.name,"\nDate: ").concat(new Date(n.order_date).toLocaleDateString(),"\n\nItems:\n").concat(s.map(e=>"- ".concat(e.product_name," x").concat(e.quantity_ordered)).join("\n"));navigator.share?await navigator.share({title:"PO ".concat(n.po_number),text:e}):(await navigator.clipboard.writeText(e),N.oR.success("Order details copied to clipboard!"))}catch(e){console.error("Error sharing:",e)}},fullWidth:x,children:"Share"})]}),(0,C.jsx)(d.A,{onClick:r,fullWidth:!0,variant:"text",sx:{mt:1},children:"Close"})]})]})}var ue=r(11737),xe=r(90990),he=r(8649);function me(){const{settings:e}=(0,ue.A)(),{toggleHelp:t}=(0,he.d)(),r=(0,i.A)(),P=(0,o.A)(r.breakpoints.down("sm")),[L,T]=(0,n.useState)([]),[U,B]=(0,n.useState)([]),[M,H]=(0,n.useState)(!0),[V,J]=(0,n.useState)(""),[Q,G]=(0,n.useState)("all"),[X,K]=(0,n.useState)("all"),[Z,$]=(0,n.useState)(0),[ee,te]=(0,n.useState)(25),[re,ie]=(0,n.useState)(0),[oe,se]=(0,n.useState)(!1),[ae,le]=(0,n.useState)(!1),[de,ce]=(0,n.useState)(null),[me,_e]=(0,n.useState)(!1),[ge,Ae]=(0,n.useState)({po:null,items:[],supplier:null}),ve=(0,n.useRef)(null);(0,xe.A)({"Alt+n":()=>we(),"Alt+f":()=>{var e;return null===(e=ve.current)||void 0===e?void 0:e.focus()}},"Purchase Orders Page"),(0,n.useEffect)(()=>{fe(),je()},[]),(0,n.useEffect)(()=>{const e=setTimeout(()=>{fe()},500);return()=>clearTimeout(e)},[V,Q,X,Z,ee]),(0,n.useEffect)(()=>{je()},[]);const fe=async()=>{H(!0);try{const{data:{session:e}}=await I.N.auth.getSession();if(!e)return;let t=I.N.from("purchase_orders").select("\n                    *,\n                    suppliers(name, phone, supplier_contacts(*))\n                ",{count:"exact"}).eq("organization_id",e.user.id).is("deleted_at",null).order("created_at",{ascending:!1});V&&(t=t.ilike("po_number","%".concat(V,"%"))),"all"!==Q&&(t=t.eq("status",Q)),"all"!==X&&(t=t.eq("supplier_id",X));const r=Z*ee,n=r+ee-1,{data:i,count:o,error:s}=await t.range(r,n);if(s)throw s;T(i||[]),ie(o||0)}catch(e){console.error("Error fetching POs:",e),N.oR.error("Failed to load purchase orders")}finally{H(!1)}},je=async()=>{const{data:{session:e}}=await I.N.auth.getSession();if(!e)return;const{data:t,error:r}=await I.N.from("suppliers").select("*, supplier_contacts(*)").eq("organization_id",e.user.id).is("deleted_at",null).order("name");r?console.error("Error fetching suppliers:",r):B(t||[])},ye=e=>({draft:"default",sent:"primary",partially_received:"secondary",received:"success"}[e]||"default"),be=e=>({draft:"Draft",sent:"Sent",partially_received:"Receiving",received:"Completed"}[e]||e),we=()=>{ce(null),se(!0)};return(0,C.jsxs)(s.A,{maxWidth:"xl",children:[(0,C.jsxs)(a.A,{display:"flex",flexDirection:P?"column":"row",justifyContent:"space-between",alignItems:P?"flex-start":"center",gap:2,mb:3,children:[(0,C.jsx)(l.A,{variant:"h4",fontWeight:700,color:"primary",children:"Purchase Orders"}),(0,C.jsxs)(a.A,{display:"flex",gap:1,children:[(0,C.jsx)(d.A,{variant:"outlined",startIcon:(0,C.jsx)(z.A,{}),onClick:t,size:P?"small":"medium",children:"Shortcuts"}),(0,C.jsx)(d.A,{variant:"contained",startIcon:(0,C.jsx)(F.A,{}),onClick:we,fullWidth:P,children:"New Purchase Order (Alt+n)"})]})]}),(0,C.jsx)(c.A,{sx:{mb:3},children:(0,C.jsx)(p.A,{children:(0,C.jsxs)(a.A,{display:"flex",gap:2,flexWrap:"wrap",children:[(0,C.jsx)(u.A,{label:"Search PO (Alt+f)",inputRef:ve,value:V,onChange:e=>J(e.target.value),size:"small",sx:{minWidth:250},InputProps:{startAdornment:(0,C.jsx)(x.A,{position:"start",children:(0,C.jsx)(D.A,{})})}}),(0,C.jsxs)(u.A,{select:!0,label:"Status",value:Q,onChange:e=>G(e.target.value),size:"small",sx:{minWidth:150},children:[(0,C.jsx)(h.A,{value:"all",children:"All Status"}),(0,C.jsx)(h.A,{value:"draft",children:"Draft"}),(0,C.jsx)(h.A,{value:"sent",children:"Sent"}),(0,C.jsx)(h.A,{value:"partially_received",children:"Receiving"}),(0,C.jsx)(h.A,{value:"received",children:"Completed"})]}),(0,C.jsxs)(u.A,{select:!0,label:"Supplier",value:X,onChange:e=>K(e.target.value),size:"small",sx:{minWidth:200},children:[(0,C.jsx)(h.A,{value:"all",children:"All Suppliers"}),U.map(e=>(0,C.jsx)(h.A,{value:e.id,children:e.name},e.id))]})]})})}),(0,C.jsx)(c.A,{children:(0,C.jsx)(m.A,{sx:{overflowX:"auto",maxWidth:"100%"},children:(0,C.jsxs)(_.A,{sx:{minWidth:900},children:[(0,C.jsx)(g.A,{children:(0,C.jsxs)(A.A,{children:[(0,C.jsx)(v.A,{children:(0,C.jsx)("strong",{children:"PO Number"})}),(0,C.jsx)(v.A,{children:(0,C.jsx)("strong",{children:"Supplier"})}),(0,C.jsx)(v.A,{children:(0,C.jsx)("strong",{children:"Order Date"})}),(0,C.jsx)(v.A,{children:(0,C.jsx)("strong",{children:"Status"})}),(0,C.jsx)(v.A,{align:"right",children:(0,C.jsx)("strong",{children:"Total Amount"})}),(0,C.jsx)(v.A,{align:"right",children:(0,C.jsx)("strong",{children:"Actions"})})]})}),(0,C.jsx)(f.A,{children:M?(0,C.jsx)(A.A,{children:(0,C.jsx)(v.A,{colSpan:6,align:"center",children:"Loading..."})}):0===L.length?(0,C.jsx)(A.A,{children:(0,C.jsx)(v.A,{colSpan:6,align:"center",children:"No purchase orders found"})}):L.map(t=>{var r,n;return(0,C.jsxs)(A.A,{hover:!0,children:[(0,C.jsx)(v.A,{children:(0,C.jsx)(l.A,{variant:"body2",fontWeight:600,children:t.po_number})}),(0,C.jsx)(v.A,{children:(null===(r=t.suppliers)||void 0===r?void 0:r.name)||"\u2014"}),(0,C.jsx)(v.A,{children:new Date(t.order_date).toLocaleDateString()}),(0,C.jsx)(v.A,{children:(0,C.jsx)(j.A,{icon:(n=t.status,{draft:(0,C.jsx)(S.A,{fontSize:"small"}),sent:(0,C.jsx)(R,{fontSize:"small"}),partially_received:(0,C.jsx)(q.A,{fontSize:"small"}),received:(0,C.jsx)(O.A,{fontSize:"small"})}[n]),label:be(t.status),color:ye(t.status),size:"small"})}),(0,C.jsx)(v.A,{align:"right",children:(0,C.jsxs)(l.A,{variant:"body2",fontWeight:600,children:[(null===e||void 0===e?void 0:e.currency_symbol)||"Rs",(0,E.vv)(t.final_amount||t.total_amount,"")]})}),(0,C.jsx)(v.A,{align:"right",children:(0,C.jsxs)(a.A,{display:"flex",gap:1,justifyContent:"flex-end",children:[(0,C.jsx)(y.A,{title:"View Details",children:(0,C.jsx)(b.A,{size:"small",color:"primary",onClick:()=>(e=>{ce(e),le(!0)})(t),children:(0,C.jsx)(k.A,{fontSize:"small"})})}),"draft"===t.status&&(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(y.A,{title:"Edit",children:(0,C.jsx)(b.A,{size:"small",color:"secondary",onClick:()=>(e=>{ce(e),se(!0)})(t),children:(0,C.jsx)(S.A,{fontSize:"small"})})}),(0,C.jsx)(y.A,{title:"Delete",children:(0,C.jsx)(b.A,{size:"small",color:"error",onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete PO ".concat(e.po_number,"?")))try{const{error:t}=await I.N.from("purchase_orders").update({deleted_at:(new Date).toISOString()}).eq("id",e.id);if(t)throw t;N.oR.success("Purchase order deleted!"),fe()}catch(t){console.error("Error deleting PO:",t),N.oR.error("Failed to delete purchase order")}})(t),children:(0,C.jsx)(W.A,{fontSize:"small"})})})]})]})})]},t.id)})})]})})}),(0,C.jsx)(w.A,{rowsPerPageOptions:[10,25,50,100],component:"div",count:re,rowsPerPage:ee,page:Z,onPageChange:(e,t)=>{$(t)},onRowsPerPageChange:e=>{te(parseInt(e.target.value,10)),$(0)}}),(0,C.jsx)(Y,{open:oe,onClose:(e,t,r)=>{se(!1),e&&t&&r&&(Ae({po:e,items:t,supplier:r}),_e(!0)),ce(null),fe()},purchaseOrder:de,suppliers:U}),(0,C.jsx)(ne,{open:ae,onClose:()=>le(!1),purchaseOrder:de,onRefresh:fe}),(0,C.jsx)(pe,{open:me,onClose:()=>_e(!1),purchaseOrder:ge.po,poItems:ge.items,supplier:ge.supplier,settings:e})]})}},70141:(e,t,r)=>{r.d(t,{A:()=>o});var n=r(59662),i=r(70579);const o=(0,n.A)((0,i.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add")},83560:(e,t,r)=>{r.d(t,{A:()=>o});var n=r(59662),i=r(70579);const o=(0,n.A)((0,i.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit")},88458:(e,t,r)=>{r.d(t,{JT:()=>i,p0:()=>n});const n=(e,t,r,n)=>{const i=function(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Medical Store";if(!e)return null;const i=e.replace(/\D/g,""),o="Hi, this is ".concat(n,'. We need to order "').concat(t,'". Current stock is ').concat(r,". Please let us know availability and price."),s=encodeURIComponent(o);return"https://wa.me/".concat(i,"?text=").concat(s)}(e,t,r,n);i?window.open(i,"_blank"):alert("Supplier phone number is missing!")},i=(e,t)=>{if(!e)return void alert("Phone number is missing!");const r=e.replace(/\D/g,""),n=encodeURIComponent(t),i="https://wa.me/".concat(r,"?text=").concat(n);window.open(i,"_blank")}},98606:(e,t,r)=>{r.d(t,{A:()=>o});var n=r(59662),i=r(70579);const o=(0,n.A)((0,i.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8z"}),"CheckCircle")}}]);
//# sourceMappingURL=173.381432a9.chunk.js.map