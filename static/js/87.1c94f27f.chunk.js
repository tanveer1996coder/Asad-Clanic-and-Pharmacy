"use strict";(self.webpackChunksupabase_sales_app=self.webpackChunksupabase_sales_app||[]).push([[87],{12807:(e,t,n)=>{function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"PKR";if(null===e||void 0===e||isNaN(e))return"".concat(t," 0.00");const n=Number(e);return"".concat(t," ").concat(n.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}))}function s(e){return null===e||void 0===e||isNaN(e)?"0":Number(e).toLocaleString("en-US")}function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return null===e||void 0===e||isNaN(e)?"0%":"".concat(Number(e).toFixed(t),"%")}n.d(t,{Ee:()=>i,ZV:()=>s,vv:()=>r})},29347:(e,t,n)=>{n.d(t,{A:()=>g});var r=n(98587),s=n(58168),i=n(65043),o=n(58387),l=n(98610),a=n(34535),c=n(98206),d=n(92532),u=n(72372);function p(e){return(0,u.Ay)("MuiDialogActions",e)}(0,d.A)("MuiDialogActions",["root","spacing"]);var x=n(70579);const h=["className","disableSpacing"],m=(0,a.Ay)("div",{name:"MuiDialogActions",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,!n.disableSpacing&&t.spacing]}})(e=>{let{ownerState:t}=e;return(0,s.A)({display:"flex",alignItems:"center",padding:8,justifyContent:"flex-end",flex:"0 0 auto"},!t.disableSpacing&&{"& > :not(style) ~ :not(style)":{marginLeft:8}})}),g=i.forwardRef(function(e,t){const n=(0,c.b)({props:e,name:"MuiDialogActions"}),{className:i,disableSpacing:a=!1}=n,d=(0,r.A)(n,h),u=(0,s.A)({},n,{disableSpacing:a}),g=(e=>{const{classes:t,disableSpacing:n}=e,r={root:["root",!n&&"spacing"]};return(0,l.A)(r,p,t)})(u);return(0,x.jsx)(m,(0,s.A)({className:(0,o.A)(g.root,i),ownerState:u,ref:t},d))})},43243:(e,t,n)=>{n.d(t,{V0:()=>a,Yq:()=>i,fU:()=>o,go:()=>l,t6:()=>c});var r=n(82125),s=n(98920);function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"MMM dd, yyyy";if(!e)return"\u2014";try{const n="string"===typeof e?(0,s.A)(e):e;return(0,r.A)(n,t)}catch(n){return console.error("Error formatting date:",n),String(e)}}function o(e){if(!e)return"\u2014";try{const t="string"===typeof e?(0,s.A)(e):e;return(0,r.A)(t,"h:mm a")}catch(t){return console.error("Error formatting time:",t),String(e)}}function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:7,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15;const r=function(e){if(!e)return null;try{const t="string"===typeof e?new Date(e):e,n=new Date;n.setHours(0,0,0,0),t.setHours(0,0,0,0);const r=t-n;return Math.ceil(r/864e5)}catch(t){return console.error("Error calculating days until expiry:",t),null}}(e);return null===r?{type:"unknown",color:"default",label:"No expiry date"}:r<0?{type:"expired",color:"error",label:"Expired",days:r}:r<=t?{type:"urgent",color:"error",label:"".concat(r," days left"),days:r}:r<=n?{type:"warning",color:"warning",label:"".concat(r," days left"),days:r}:{type:"ok",color:"success",label:"Good",days:r}}function a(e){return 0===e?{type:"out",color:"error",label:"Out of stock"}:e<=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:10)?{type:"low",color:"warning",label:"Low stock"}:{type:"ok",color:"success",label:"In stock"}}function c(e){const t=new Date;return t.setDate(t.getDate()-e),(0,r.A)(t,"yyyy-MM-dd")}},45879:(e,t,n)=>{n.d(t,{A:()=>r});const r=n(5844).A},70141:(e,t,n)=>{n.d(t,{A:()=>i});var r=n(59662),s=n(70579);const i=(0,r.A)((0,s.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add")},84937:(e,t,n)=>{n.r(t),n.d(t,{default:()=>F});var r=n(89379),s=n(65043),i=n(19252),o=n(96446),l=n(85865),a=n(11906),c=n(12110),d=n(26494),u=n(5146),p=n(51787),x=n(79650),h=n(71806),m=n(84882),g=n(28076),A=n(10039),y=n(73460),v=n(43845),f=n(19090),j=n(90035),_=n(26600),b=n(35316),S=n(68903),w=n(32143),k=n(29347),C=n(70141),I=n(17673),N=n(71403),P=n(79484),D=n(47503),W=n(27001),R=n(12807),q=n(43243),M=n(88458),E=n(11737),T=n(90990),z=n(8649),L=n(70579);function F(){const{settings:e}=(0,E.A)(),{toggleHelp:t}=(0,z.d)(),[n,F]=(0,s.useState)([]),[O,H]=(0,s.useState)([]),[U,V]=(0,s.useState)(!0),[B,Z]=(0,s.useState)(""),[G,J]=(0,s.useState)(0),[K,Q]=(0,s.useState)(25),[X,Y]=(0,s.useState)(0),[$,ee]=(0,s.useState)(!1),[te,ne]=(0,s.useState)(null),[re,se]=(0,s.useState)({quantity:"",cost_price:"",expiry_date:"",supplier_id:"",received_date:(new Date).toISOString().split("T")[0],notes:""}),ie=(0,s.useRef)(null);async function oe(){V(!0);try{const{data:{session:e}}=await W.N.auth.getSession();if(!e)return void V(!1);const t=e.user.id;let n=W.N.from("products").select("*, suppliers(name)",{count:"exact"}).eq("organization_id",t).is("deleted_at",null).order("name");B&&(n=n.or("name.ilike.%".concat(B,"%,form.ilike.%").concat(B,"%")));const r=G*K,s=r+K-1,{data:i,count:o,error:l}=await n.range(r,s);if(l)throw l;F(i||[]),Y(o||0)}catch(e){console.error("Error fetching products:",e),D.oR.error("Failed to load products")}finally{V(!1)}}(0,T.A)({"Alt+f":()=>{var e;return null===(e=ie.current)||void 0===e?void 0:e.focus()}},"Stock Page"),(0,s.useEffect)(()=>{!async function(){const{data:{session:e}}=await W.N.auth.getSession();if(!e)return;const t=e.user.id,{data:n}=await W.N.from("suppliers").select("*").eq("organization_id",t).is("deleted_at",null).order("name");H(n||[])}()},[]),(0,s.useEffect)(()=>{const e=setTimeout(()=>{oe()},500);return()=>clearTimeout(e)},[B,G,K]);const le=()=>{ee(!1),ne(null)},ae=e=>{se((0,r.A)((0,r.A)({},re),{},{[e.target.name]:e.target.value}))};return(0,L.jsxs)(i.A,{maxWidth:"xl",children:[(0,L.jsxs)(o.A,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[(0,L.jsx)(l.A,{variant:"h4",fontWeight:700,color:"primary",children:"Stock Management"}),(0,L.jsx)(a.A,{variant:"outlined",startIcon:(0,L.jsx)(I.A,{}),onClick:t,children:"Shortcuts"})]}),(0,L.jsx)(c.A,{children:(0,L.jsxs)(d.A,{children:[(0,L.jsx)(l.A,{variant:"h6",fontWeight:600,mb:2,children:"Current Stock Levels"}),(0,L.jsx)(u.A,{fullWidth:!0,inputRef:ie,size:"small",placeholder:"Search products... (Alt+f)",value:B,onChange:e=>Z(e.target.value),sx:{mb:2},InputProps:{startAdornment:(0,L.jsx)(p.A,{position:"start",children:(0,L.jsx)(P.A,{})})}}),(0,L.jsx)(x.A,{sx:{overflowX:"auto",maxWidth:"100%"},children:(0,L.jsxs)(h.A,{sx:{minWidth:800},children:[(0,L.jsx)(m.A,{children:(0,L.jsxs)(g.A,{children:[(0,L.jsx)(A.A,{children:(0,L.jsx)("strong",{children:"Product"})}),(0,L.jsx)(A.A,{children:(0,L.jsx)("strong",{children:"Category"})}),(0,L.jsx)(A.A,{children:(0,L.jsx)("strong",{children:"Current Stock"})}),(0,L.jsx)(A.A,{children:(0,L.jsx)("strong",{children:"Min Level"})}),(0,L.jsx)(A.A,{children:(0,L.jsx)("strong",{children:"Expiry"})}),(0,L.jsx)(A.A,{children:(0,L.jsx)("strong",{children:"Supplier"})}),(0,L.jsx)(A.A,{align:"right",children:(0,L.jsx)("strong",{children:"Actions"})})]})}),(0,L.jsx)(y.A,{children:U?(0,L.jsx)(g.A,{children:(0,L.jsx)(A.A,{colSpan:7,align:"center",children:"Loading..."})}):0===n.length?(0,L.jsx)(g.A,{children:(0,L.jsx)(A.A,{colSpan:7,align:"center",children:"No products found"})}):n.map(t=>{var n,r;const s=(0,q.V0)(t.stock,t.min_stock_level),i=t.expiry_date?(0,q.go)(t.expiry_date,7,parseInt(e.expiry_alert_days||"15")):null;return(0,L.jsxs)(g.A,{hover:!0,children:[(0,L.jsx)(A.A,{children:(0,L.jsx)(l.A,{variant:"body2",fontWeight:600,children:t.name})}),(0,L.jsx)(A.A,{children:t.form&&(0,L.jsx)(v.A,{label:t.form,size:"small",variant:"outlined"})}),(0,L.jsx)(A.A,{children:(0,L.jsx)(v.A,{label:"".concat((0,R.ZV)(t.stock)," units"),size:"small",color:s.color})}),(0,L.jsx)(A.A,{children:t.min_stock_level}),(0,L.jsx)(A.A,{children:i?(0,L.jsx)(v.A,{label:i.label,size:"small",color:i.color}):"\u2014"}),(0,L.jsx)(A.A,{children:(0,L.jsx)(l.A,{variant:"caption",children:(null===(n=t.suppliers)||void 0===n?void 0:n.name)||"\u2014"})}),(0,L.jsx)(A.A,{align:"right",children:(0,L.jsxs)(o.A,{display:"flex",gap:1,justifyContent:"flex-end",children:[("low"===s.type||"out"===s.type)&&(null===(r=t.suppliers)||void 0===r?void 0:r.phone)&&(0,L.jsx)(a.A,{size:"small",variant:"outlined",color:"success",onClick:()=>(0,M.p0)(t.suppliers.phone,t.name,t.stock,e.store_name),children:"Order"}),(0,L.jsx)(a.A,{size:"small",variant:"outlined",startIcon:(0,L.jsx)(C.A,{}),onClick:()=>(e=>{var t,n;ne(e),se({quantity:"",boxes_received:"",items_per_box:(null===(t=e.items_per_box)||void 0===t?void 0:t.toString())||"1",cost_price:(null===(n=e.cost_price)||void 0===n?void 0:n.toString())||"",expiry_date:"",supplier_id:e.supplier_id||"",received_date:(new Date).toISOString().split("T")[0],notes:""}),ee(!0)})(t),children:"Add Stock"})]})})]},t.id)})})]})}),(0,L.jsx)(f.A,{rowsPerPageOptions:[10,25,50,100],component:"div",count:X,rowsPerPage:K,page:G,onPageChange:(e,t)=>{J(t)},onRowsPerPageChange:e=>{Q(parseInt(e.target.value,10)),J(0)}})]})}),(0,L.jsx)(j.A,{open:$,onClose:le,maxWidth:"sm",fullWidth:!0,children:(0,L.jsxs)("form",{onSubmit:async e=>{e.preventDefault();const t=parseInt(re.quantity);if(!t||t<=0)D.oR.error("Please enter valid quantity");else try{const{error:e}=await W.N.from("stock_receipts").insert([{product_id:te.id,supplier_id:re.supplier_id||null,quantity:t,boxes_received:re.boxes_received?parseInt(re.boxes_received):null,items_per_box:re.items_per_box?parseInt(re.items_per_box):null,cost_price:re.cost_price?parseFloat(re.cost_price):null,expiry_date:re.expiry_date||null,received_date:re.received_date,notes:re.notes||null}]);if(e)throw e;const{error:n}=await W.N.rpc("add_stock",{p_id:te.id,q_added:t,new_expiry:re.expiry_date||null,new_cost:re.cost_price?parseFloat(re.cost_price):null});if(n)throw n;D.oR.success("Stock added successfully!"),le(),oe()}catch(n){console.error("Error adding stock:",n),D.oR.error("Failed to add stock: "+n.message)}},children:[(0,L.jsx)(_.A,{children:(0,L.jsxs)(o.A,{display:"flex",alignItems:"center",gap:1,children:[(0,L.jsx)(N.A,{color:"primary"}),"Add Stock - ",null===te||void 0===te?void 0:te.name]})}),(0,L.jsx)(b.A,{children:(0,L.jsxs)(S.Ay,{container:!0,spacing:2,sx:{mt:1},children:[(0,L.jsx)(S.Ay,{item:!0,xs:12,sm:4,children:(0,L.jsx)(u.A,{fullWidth:!0,type:"number",label:"Items per Box",name:"items_per_box",value:re.items_per_box,onChange:e=>{if(ae(e),re.boxes_received&&e.target.value){const t=parseInt(re.boxes_received)*parseInt(e.target.value);se(e=>(0,r.A)((0,r.A)({},e),{},{quantity:t.toString()}))}},inputProps:{min:1},helperText:"Tablets/items per box"})}),(0,L.jsx)(S.Ay,{item:!0,xs:12,sm:4,children:(0,L.jsx)(u.A,{fullWidth:!0,type:"number",label:"Boxes Received",name:"boxes_received",value:re.boxes_received,onChange:e=>{if(ae(e),e.target.value&&re.items_per_box){const t=parseInt(e.target.value)*parseInt(re.items_per_box);se(e=>(0,r.A)((0,r.A)({},e),{},{quantity:t.toString()}))}},inputProps:{min:0},helperText:"Number of boxes"})}),(0,L.jsx)(S.Ay,{item:!0,xs:12,sm:4,children:(0,L.jsx)(u.A,{fullWidth:!0,required:!0,type:"number",label:"Total Quantity (Items)",name:"quantity",value:re.quantity,onChange:ae,inputProps:{min:1},helperText:"Current: ".concat((null===te||void 0===te?void 0:te.stock)||0)})}),(0,L.jsx)(S.Ay,{item:!0,xs:12,sm:6,children:(0,L.jsx)(u.A,{fullWidth:!0,type:"number",label:"Cost Price (per unit)",name:"cost_price",value:re.cost_price,onChange:ae,InputProps:{startAdornment:(0,L.jsx)(p.A,{position:"start",children:e.currency_symbol})}})}),(0,L.jsx)(S.Ay,{item:!0,xs:12,sm:6,children:(0,L.jsx)(u.A,{fullWidth:!0,type:"date",label:"Expiry Date",name:"expiry_date",value:re.expiry_date,onChange:ae,InputLabelProps:{shrink:!0}})}),(0,L.jsx)(S.Ay,{item:!0,xs:12,children:(0,L.jsxs)(u.A,{fullWidth:!0,select:!0,label:"Supplier",name:"supplier_id",value:re.supplier_id,onChange:ae,children:[(0,L.jsx)(w.A,{value:"",children:"None"}),O.map(e=>(0,L.jsx)(w.A,{value:e.id,children:e.name},e.id))]})}),(0,L.jsx)(S.Ay,{item:!0,xs:12,children:(0,L.jsx)(u.A,{fullWidth:!0,type:"date",label:"Received Date",name:"received_date",value:re.received_date,onChange:ae,InputLabelProps:{shrink:!0}})}),(0,L.jsx)(S.Ay,{item:!0,xs:12,children:(0,L.jsx)(u.A,{fullWidth:!0,multiline:!0,rows:2,label:"Notes",name:"notes",value:re.notes,onChange:ae,placeholder:"Optional notes about this stock receipt"})})]})}),(0,L.jsxs)(k.A,{children:[(0,L.jsx)(a.A,{onClick:le,children:"Cancel"}),(0,L.jsx)(a.A,{type:"submit",variant:"contained",children:"Add Stock"})]})]})})]})}},88458:(e,t,n)=>{n.d(t,{JT:()=>s,p0:()=>r});const r=(e,t,n,r)=>{const s=function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Medical Store";if(!e)return null;const s=e.replace(/\D/g,""),i="Hi, this is ".concat(r,'. We need to order "').concat(t,'". Current stock is ').concat(n,". Please let us know availability and price."),o=encodeURIComponent(i);return"https://wa.me/".concat(s,"?text=").concat(o)}(e,t,n,r);s?window.open(s,"_blank"):alert("Supplier phone number is missing!")},s=(e,t)=>{if(!e)return void alert("Phone number is missing!");const n=e.replace(/\D/g,""),r=encodeURIComponent(t),s="https://wa.me/".concat(n,"?text=").concat(r);window.open(s,"_blank")}}}]);
//# sourceMappingURL=87.1c94f27f.chunk.js.map