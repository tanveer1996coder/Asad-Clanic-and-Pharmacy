"use strict";(self.webpackChunksupabase_sales_app=self.webpackChunksupabase_sales_app||[]).push([[937],{22907:(e,n,s)=>{s.r(n),s.d(n,{default:()=>Z});var r=s(89379),i=s(65043),t=s(26240),a=s(30344),l=s(19252),o=s(96446),c=s(85865),d=s(11906),p=s(12110),h=s(26494),m=s(5146),u=s(51787),x=s(17392),A=s(43845),j=s(79650),f=s(71806),g=s(84882),y=s(28076),_=s(10039),b=s(73460),v=s(19090),w=s(90035),C=s(26600),S=s(35316),k=s(68903),z=s(39336),P=s(35721),W=s(37918),N=s(48734),I=s(8266),R=s(74605),E=s(23217),L=s(29347),q=s(17673),D=s(70141),T=s(79484),B=s(83560),F=s(51387),M=s(25298),O=s(59662),U=s(70579);const H=(0,O.A)((0,U.jsx)("path",{d:"M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"}),"Star"),X=(0,O.A)((0,U.jsx)("path",{d:"m22 9.24-7.19-.62L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.63-7.03zM12 15.4l-3.76 2.27 1-4.28-3.32-2.88 4.38-.38L12 6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28z"}),"StarBorder");var G=s(47503),J=s(27001),K=s(11737),Q=s(60931),V=s(90990),Y=s(8649);function Z(){const{settings:e}=(0,K.A)(),{toggleHelp:n}=(0,Y.d)(),[s,O]=(0,i.useState)([]),[Z,$]=(0,i.useState)(!0),[ee,ne]=(0,i.useState)(""),[se,re]=(0,i.useState)(0),[ie,te]=(0,i.useState)(25),[ae,le]=(0,i.useState)(0),[oe,ce]=(0,i.useState)(!1),[de,pe]=(0,i.useState)(null),[he,me]=(0,i.useState)(!1),[ue,xe]=(0,i.useState)(null),[Ae,je]=(0,i.useState)([]),[fe,ge]=(0,i.useState)({contact_name:"",phone:"",whatsapp_enabled:!0,is_primary:!1}),[ye,_e]=(0,i.useState)({name:"",contact_person:"",phone:"",email:"",address:"",portfolio_link:"",notes:""}),be=(0,i.useRef)(null);(0,V.A)({"Alt+n":()=>we(),"Alt+f":()=>{var e;return null===(e=be.current)||void 0===e?void 0:e.focus()}},"Suppliers Page");const ve=async()=>{$(!0);try{const{data:{session:e}}=await J.N.auth.getSession();if(!e)return G.oR.error("Please log in to view suppliers"),void $(!1);const n=e.user.id;let s=J.N.from("suppliers").select("\n                    *,\n                    supplier_contacts(id, contact_name, phone, whatsapp_enabled, is_primary)\n                ",{count:"exact"}).eq("organization_id",n).is("deleted_at",null).order("name");ee&&(s=s.or("name.ilike.%".concat(ee,"%,email.ilike.%").concat(ee,"%")));const r=se*ie,i=r+ie-1,{data:t,count:a,error:l}=await s.range(r,i);if(l)throw l;O(t||[]),le(a||0)}catch(e){console.error("Error fetching suppliers:",e),G.oR.error("Failed to load suppliers")}finally{$(!1)}};(0,i.useEffect)(()=>{const e=setTimeout(()=>{ve()},500);return()=>clearTimeout(e)},[ee,se,ie]);const we=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e?(pe(e),_e({name:e.name||"",contact_person:e.contact_person||"",phone:e.phone||"",email:e.email||"",address:e.address||"",portfolio_link:e.portfolio_link||"",notes:e.notes||""}),await(async e=>{try{const{data:n,error:s}=await J.N.from("supplier_contacts").select("*").eq("supplier_id",e).order("is_primary",{ascending:!1});if(s)throw s;je(n||[])}catch(n){console.error("Error fetching contacts:",n)}})(e.id)):(pe(null),_e({name:"",contact_person:"",phone:"",email:"",address:"",portfolio_link:"",notes:""}),je([])),ge({contact_name:"",phone:"",whatsapp_enabled:!0,is_primary:!1}),ce(!0)},Ce=()=>{ce(!1),pe(null),je([]),ge({contact_name:"",phone:"",whatsapp_enabled:!0,is_primary:!1})},Se=e=>{_e((0,r.A)((0,r.A)({},ye),{},{[e.target.name]:e.target.value}))},ke=e=>{xe(e),me(!0)},ze=e=>{const n=e.replace(/[^0-9]/g,"");window.open("https://wa.me/".concat(n),"_blank")},Pe=(0,t.A)(),We=(0,a.A)(Pe.breakpoints.down("sm"));return(0,U.jsxs)(l.A,{maxWidth:"lg",children:[(0,U.jsxs)(o.A,{display:"flex",flexDirection:We?"column":"row",justifyContent:"space-between",alignItems:We?"flex-start":"center",gap:2,mb:3,children:[(0,U.jsx)(c.A,{variant:"h4",fontWeight:700,color:"primary",children:"Suppliers"}),(0,U.jsxs)(o.A,{display:"flex",gap:1,children:[(0,U.jsx)(d.A,{variant:"outlined",startIcon:(0,U.jsx)(q.A,{}),onClick:n,size:We?"small":"medium",children:"Shortcuts"}),(0,U.jsx)(d.A,{variant:"contained",startIcon:(0,U.jsx)(D.A,{}),onClick:()=>we(),fullWidth:We,children:"Add Supplier (Alt+n)"})]})]}),(0,U.jsx)(p.A,{sx:{mb:3},children:(0,U.jsx)(h.A,{children:(0,U.jsx)(m.A,{fullWidth:!0,inputRef:be,size:"small",placeholder:"Search suppliers by name or email... (Alt+f)",value:ee,onChange:e=>ne(e.target.value),InputProps:{startAdornment:(0,U.jsx)(u.A,{position:"start",children:(0,U.jsx)(T.A,{})})}})})}),We?(0,U.jsx)(o.A,{children:Z?(0,U.jsx)(c.A,{align:"center",children:"Loading..."}):0===s.length?(0,U.jsx)(c.A,{align:"center",children:"No suppliers found"}):s.map(e=>{var n;const s=null===(n=e.supplier_contacts)||void 0===n?void 0:n.find(e=>e.is_primary);return(0,U.jsx)(p.A,{variant:"outlined",sx:{mb:2},children:(0,U.jsxs)(h.A,{children:[(0,U.jsxs)(o.A,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:1,children:[(0,U.jsx)(c.A,{variant:"h6",fontWeight:600,children:e.name}),(0,U.jsxs)(o.A,{children:[(0,U.jsx)(x.A,{size:"small",color:"primary",onClick:()=>we(e),children:(0,U.jsx)(B.A,{fontSize:"small"})}),(0,U.jsx)(x.A,{size:"small",color:"error",onClick:()=>ke(e.id),children:(0,U.jsx)(F.A,{fontSize:"small"})})]})]}),(0,U.jsxs)(o.A,{mb:2,children:[(0,U.jsx)(c.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:(0,U.jsx)("strong",{children:"Primary Contact:"})}),s?(0,U.jsxs)(o.A,{display:"flex",alignItems:"center",gap:1,flexWrap:"wrap",children:[(0,U.jsx)(c.A,{variant:"body1",fontWeight:500,children:s.contact_name}),(0,U.jsxs)(c.A,{variant:"body2",color:"text.secondary",children:["(",s.phone,")"]}),s.whatsapp_enabled&&(0,U.jsx)(d.A,{variant:"contained",color:"success",size:"small",startIcon:(0,U.jsx)(M.A,{}),onClick:()=>ze(s.phone),sx:{ml:1},children:"Chat"})]}):(0,U.jsx)(c.A,{variant:"body2",children:e.phone||"No contact info"})]}),e.supplier_contacts&&e.supplier_contacts.length>0&&(0,U.jsx)(A.A,{size:"small",label:"".concat(e.supplier_contacts.length," Total Contacts"),color:"primary",variant:"outlined"})]})},e.id)})}):(0,U.jsx)(p.A,{children:(0,U.jsx)(j.A,{sx:{overflowX:"auto"},children:(0,U.jsxs)(f.A,{children:[(0,U.jsx)(g.A,{children:(0,U.jsxs)(y.A,{children:[(0,U.jsx)(_.A,{children:(0,U.jsx)("strong",{children:"Name"})}),(0,U.jsx)(_.A,{children:(0,U.jsx)("strong",{children:"Primary Contact"})}),(0,U.jsx)(_.A,{children:(0,U.jsx)("strong",{children:"Email"})}),(0,U.jsx)(_.A,{children:(0,U.jsx)("strong",{children:"Contacts"})}),(0,U.jsx)(_.A,{align:"right",children:(0,U.jsx)("strong",{children:"Actions"})})]})}),(0,U.jsx)(b.A,{children:Z?(0,U.jsx)(y.A,{children:(0,U.jsx)(_.A,{colSpan:5,align:"center",children:"Loading..."})}):0===s.length?(0,U.jsx)(y.A,{children:(0,U.jsx)(_.A,{colSpan:5,align:"center",children:"No suppliers found"})}):s.map(e=>{var n;const s=null===(n=e.supplier_contacts)||void 0===n?void 0:n.find(e=>e.is_primary);return(0,U.jsxs)(y.A,{hover:!0,children:[(0,U.jsx)(_.A,{children:(0,U.jsx)(c.A,{variant:"body2",fontWeight:600,children:e.name})}),(0,U.jsx)(_.A,{children:s?(0,U.jsxs)(o.A,{display:"flex",alignItems:"center",gap:1,children:[(0,U.jsxs)(c.A,{variant:"body2",children:[s.contact_name," - ",s.phone]}),s.whatsapp_enabled&&(0,U.jsx)(x.A,{size:"small",color:"success",onClick:()=>ze(s.phone),children:(0,U.jsx)(M.A,{fontSize:"small"})})]}):e.phone||"\u2014"}),(0,U.jsx)(_.A,{children:e.email||"\u2014"}),(0,U.jsx)(_.A,{children:e.supplier_contacts&&e.supplier_contacts.length>0?(0,U.jsx)(A.A,{size:"small",label:e.supplier_contacts.length,color:"primary"}):"\u2014"}),(0,U.jsxs)(_.A,{align:"right",children:[(0,U.jsx)(x.A,{size:"small",color:"primary",onClick:()=>we(e),children:(0,U.jsx)(B.A,{})}),(0,U.jsx)(x.A,{size:"small",color:"error",onClick:()=>ke(e.id),children:(0,U.jsx)(F.A,{})})]})]},e.id)})})]})})}),(0,U.jsx)(v.A,{rowsPerPageOptions:[10,25,50,100],component:"div",count:ae,rowsPerPage:ie,page:se,onPageChange:(e,n)=>{re(n)},onRowsPerPageChange:e=>{te(parseInt(e.target.value,10)),re(0)}}),(0,U.jsx)(w.A,{open:oe,onClose:Ce,maxWidth:"md",fullWidth:!0,children:(0,U.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),ye.name)try{const{data:{session:e}}=await J.N.auth.getSession();if(!e)return void G.oR.error("Please log in to save changes");let n;if(de){const{error:e}=await J.N.from("suppliers").update(ye).eq("id",de.id);if(e)throw e;n=de.id}else{const{data:s,error:i}=await J.N.from("suppliers").insert([(0,r.A)((0,r.A)({},ye),{},{organization_id:e.user.id})]).select().single();if(i)throw i;n=s.id}if(de){const e=Ae.filter(e=>!e.is_new).map(e=>e.id),{error:s}=await J.N.from("supplier_contacts").delete().eq("supplier_id",n).not("id","in","(".concat(e.join(",")||"null",")"));s&&console.error("Error deleting contacts:",s);for(const n of Ae.filter(e=>!e.is_new)){const{error:e}=await J.N.from("supplier_contacts").update({contact_name:n.contact_name,phone:n.phone,whatsapp_enabled:n.whatsapp_enabled,is_primary:n.is_primary}).eq("id",n.id);e&&console.error("Error updating contact:",e)}}const s=Ae.filter(e=>e.is_new).map(s=>({supplier_id:n,contact_name:s.contact_name,phone:s.phone,whatsapp_enabled:s.whatsapp_enabled,is_primary:s.is_primary,organization_id:e.user.id}));if(s.length>0){const{error:e}=await J.N.from("supplier_contacts").insert(s);if(e)throw e}G.oR.success(de?"Supplier updated successfully!":"Supplier added successfully!"),Ce(),ve()}catch(n){console.error("Error saving supplier:",n),G.oR.error("Failed to save supplier: "+(n.message||"Unknown error"))}else G.oR.error("Please enter supplier name")},children:[(0,U.jsx)(C.A,{children:de?"Edit Supplier":"Add New Supplier"}),(0,U.jsx)(S.A,{children:(0,U.jsxs)(k.Ay,{container:!0,spacing:2,sx:{mt:1},children:[(0,U.jsx)(k.Ay,{item:!0,xs:12,children:(0,U.jsx)(m.A,{fullWidth:!0,required:!0,label:"Supplier Name",name:"name",value:ye.name,onChange:Se})}),(0,U.jsx)(k.Ay,{item:!0,xs:12,sm:6,children:(0,U.jsx)(m.A,{fullWidth:!0,type:"email",label:"Email",name:"email",value:ye.email,onChange:Se})}),(0,U.jsx)(k.Ay,{item:!0,xs:12,sm:6,children:(0,U.jsx)(m.A,{fullWidth:!0,label:"Portfolio Link",name:"portfolio_link",value:ye.portfolio_link,onChange:Se})}),(0,U.jsx)(k.Ay,{item:!0,xs:12,children:(0,U.jsx)(m.A,{fullWidth:!0,multiline:!0,rows:2,label:"Address",name:"address",value:ye.address,onChange:Se})}),(0,U.jsx)(k.Ay,{item:!0,xs:12,children:(0,U.jsx)(m.A,{fullWidth:!0,multiline:!0,rows:2,label:"Notes",name:"notes",value:ye.notes,onChange:Se})}),(0,U.jsxs)(k.Ay,{item:!0,xs:12,children:[(0,U.jsx)(z.A,{sx:{my:2}}),(0,U.jsx)(c.A,{variant:"h6",gutterBottom:!0,children:"Contacts"}),Ae.length>0&&(0,U.jsx)(P.A,{dense:!0,children:Ae.map(e=>(0,U.jsxs)(W.Ay,{children:[(0,U.jsx)(x.A,{size:"small",onClick:()=>{return n=e.id,void je(Ae.map(e=>(0,r.A)((0,r.A)({},e),{},{is_primary:e.id===n})));var n},color:e.is_primary?"primary":"default",children:e.is_primary?(0,U.jsx)(H,{}):(0,U.jsx)(X,{})}),(0,U.jsx)(N.A,{primary:(0,U.jsxs)(o.A,{display:"flex",alignItems:"center",gap:1,children:[(0,U.jsx)(c.A,{variant:"body2",children:e.contact_name}),e.is_primary&&(0,U.jsx)(A.A,{size:"small",label:"Primary",color:"primary"})]}),secondary:e.phone}),e.whatsapp_enabled&&(0,U.jsx)(M.A,{color:"success",fontSize:"small",sx:{mr:1}}),(0,U.jsx)(I.A,{children:(0,U.jsx)(x.A,{edge:"end",size:"small",onClick:()=>(e=>{je(Ae.filter(n=>n.id!==e.id))})(e),children:(0,U.jsx)(F.A,{fontSize:"small"})})})]},e.id))}),(0,U.jsxs)(o.A,{sx:{mt:2,p:2,bgcolor:"grey.50",borderRadius:1},children:[(0,U.jsx)(c.A,{variant:"subtitle2",gutterBottom:!0,children:"Add Contact"}),(0,U.jsxs)(k.Ay,{container:!0,spacing:2,children:[(0,U.jsx)(k.Ay,{item:!0,xs:12,sm:5,children:(0,U.jsx)(m.A,{fullWidth:!0,size:"small",label:"Name",value:fe.contact_name,onChange:e=>ge((0,r.A)((0,r.A)({},fe),{},{contact_name:e.target.value}))})}),(0,U.jsx)(k.Ay,{item:!0,xs:12,sm:5,children:(0,U.jsx)(m.A,{fullWidth:!0,size:"small",label:"Phone",value:fe.phone,onChange:e=>ge((0,r.A)((0,r.A)({},fe),{},{phone:e.target.value}))})}),(0,U.jsx)(k.Ay,{item:!0,xs:12,sm:2,children:(0,U.jsx)(d.A,{fullWidth:!0,variant:"outlined",onClick:()=>{if(!fe.contact_name||!fe.phone)return void G.oR.error("Please enter contact name and phone");const e=(0,r.A)((0,r.A)({},fe),{},{id:"temp_".concat(Date.now()),is_new:!0});je([...Ae,e]),ge({contact_name:"",phone:"",whatsapp_enabled:!0,is_primary:!1})},startIcon:(0,U.jsx)(D.A,{}),children:"Add"})}),(0,U.jsxs)(k.Ay,{item:!0,xs:12,children:[(0,U.jsx)(R.A,{control:(0,U.jsx)(E.A,{checked:fe.whatsapp_enabled,onChange:e=>ge((0,r.A)((0,r.A)({},fe),{},{whatsapp_enabled:e.target.checked}))}),label:"WhatsApp Enabled"}),(0,U.jsx)(R.A,{control:(0,U.jsx)(E.A,{checked:fe.is_primary,onChange:e=>ge((0,r.A)((0,r.A)({},fe),{},{is_primary:e.target.checked}))}),label:"Set as Primary"})]})]})]})]})]})}),(0,U.jsxs)(L.A,{children:[(0,U.jsx)(d.A,{onClick:Ce,children:"Cancel"}),(0,U.jsxs)(d.A,{type:"submit",variant:"contained",children:[de?"Update":"Add"," Supplier"]})]})]})}),(0,U.jsx)(Q.A,{open:he,onClose:()=>me(!1),onConfirm:async()=>{if(ue)try{const{error:e}=await J.N.from("suppliers").update({deleted_at:(new Date).toISOString()}).eq("id",ue);if(e)throw e;G.oR.success("Supplier deleted successfully!"),ve()}catch(e){console.error("Error deleting supplier:",e),G.oR.error("Failed to delete supplier: "+(e.message||"Please try again"))}finally{me(!1),xe(null)}},title:"Delete Supplier",content:"Are you sure? This will hide the supplier but keep historical records."})]})}},25298:(e,n,s)=>{s.d(n,{A:()=>t});s(65043);var r=s(59662),i=s(70579);const t=(0,r.A)((0,i.jsx)("path",{d:"M16.75 13.96c.25.13.41.2.46.3.06.11.04.61-.21 1.18-.2.56-1.24 1.1-1.7 1.12-.46.02-.47.36-2.96-.73-2.49-1.09-3.99-3.75-4.11-3.92-.12-.17-.96-1.38-.92-2.61.05-1.22.69-1.8.95-2.04.24-.26.51-.29.68-.26h.47c.15 0 .36-.06.55.45l.69 1.87c.06.13.1.28.01.44l-.27.41-.39.42c-.12.12-.26.25-.12.5.12.26.62 1.09 1.32 1.78.91.88 1.71 1.17 1.95 1.3.24.14.39.12.54-.04l.81-.94c.19-.25.35-.19.58-.11l1.67.88M12 2a10 10 0 0 1 10 10 10 10 0 0 1-10 10c-1.97 0-3.8-.57-5.35-1.55L2 22l1.55-4.65A9.969 9.969 0 0 1 2 12 10 10 0 0 1 12 2m0 2a8 8 0 0 0-8 8c0 1.72.54 3.31 1.46 4.61L4.5 19.5l2.89-.96A7.95 7.95 0 0 0 12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8z"}),"WhatsApp")},45879:(e,n,s)=>{s.d(n,{A:()=>r});const r=s(5844).A},60931:(e,n,s)=>{s.d(n,{A:()=>p});s(65043);var r=s(90035),i=s(26600),t=s(35316),a=s(98533),l=s(29347),o=s(11906),c=s(34642),d=s(70579);function p(e){let{open:n,onClose:s,onConfirm:p,title:h="Confirm Delete",content:m="Are you sure you want to delete this item? This action cannot be undone.",confirmText:u="Delete",cancelText:x="Cancel"}=e;return(0,d.jsxs)(r.A,{open:n,onClose:s,"aria-labelledby":"confirm-dialog-title","aria-describedby":"confirm-dialog-description",children:[(0,d.jsxs)(i.A,{id:"confirm-dialog-title",sx:{display:"flex",alignItems:"center",gap:1},children:[(0,d.jsx)(c.A,{color:"error"}),h]}),(0,d.jsx)(t.A,{children:(0,d.jsx)(a.A,{id:"confirm-dialog-description",children:m})}),(0,d.jsxs)(l.A,{children:[(0,d.jsx)(o.A,{onClick:s,color:"primary",children:x}),(0,d.jsx)(o.A,{onClick:p,color:"error",variant:"contained",autoFocus:!0,children:u})]})]})}}}]);
//# sourceMappingURL=937.05fb708a.chunk.js.map