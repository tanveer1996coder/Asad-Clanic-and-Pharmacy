"use strict";(self.webpackChunksupabase_sales_app=self.webpackChunksupabase_sales_app||[]).push([[249],{12807:(n,t,e)=>{function o(n){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"PKR";if(null===n||void 0===n||isNaN(n))return"".concat(t," 0.00");const e=Number(n);return"".concat(t," ").concat(e.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}))}function i(n){return null===n||void 0===n||isNaN(n)?"0":Number(n).toLocaleString("en-US")}function r(n){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return null===n||void 0===n||isNaN(n)?"0%":"".concat(Number(n).toFixed(t),"%")}e.d(t,{Ee:()=>r,ZV:()=>i,vv:()=>o})},43243:(n,t,e)=>{e.d(t,{V0:()=>c,Yq:()=>r,fU:()=>a,go:()=>s,t6:()=>l});var o=e(82125),i=e(98920);function r(n){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"MMM dd, yyyy";if(!n)return"\u2014";try{const e="string"===typeof n?(0,i.A)(n):n;return(0,o.A)(e,t)}catch(e){return console.error("Error formatting date:",e),String(n)}}function a(n){if(!n)return"\u2014";try{const t="string"===typeof n?(0,i.A)(n):n;return(0,o.A)(t,"h:mm a")}catch(t){return console.error("Error formatting time:",t),String(n)}}function s(n){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:7,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15;const o=function(n){if(!n)return null;try{const t="string"===typeof n?new Date(n):n,e=new Date;e.setHours(0,0,0,0),t.setHours(0,0,0,0);const o=t-e;return Math.ceil(o/864e5)}catch(t){return console.error("Error calculating days until expiry:",t),null}}(n);return null===o?{type:"unknown",color:"default",label:"No expiry date"}:o<0?{type:"expired",color:"error",label:"Expired",days:o}:o<=t?{type:"urgent",color:"error",label:"".concat(o," days left"),days:o}:o<=e?{type:"warning",color:"warning",label:"".concat(o," days left"),days:o}:{type:"ok",color:"success",label:"Good",days:o}}function c(n){return 0===n?{type:"out",color:"error",label:"Out of stock"}:n<=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:10)?{type:"low",color:"warning",label:"Low stock"}:{type:"ok",color:"success",label:"In stock"}}function l(n){const t=new Date;return t.setDate(t.getDate()-n),(0,o.A)(t,"yyyy-MM-dd")}},88249:(n,t,e)=>{e.d(t,{A:()=>U});var o=e(65043),i=e(90035),r=e(35316),a=e(96446),s=e(85865),c=e(17392),l=e(77739),d=e(53193),p=e(72221),x=e(32143),h=e(29347),u=e(88911),m=e(11906),g=e(33438),f=e(80587),v=e(67652),y=e(25298),b=e(38504),A=e(75475),j=e(30513),w=e(65239),_=e.n(w),C=e(37762),k=e(47503),W=e(39336),I=e(71806),S=e(84882),R=e(28076),D=e(10039),z=e(73460),F=e(70579);function P(n){var t,e;let{invoice:o,items:i,settings:r}=n;const c=(null===r||void 0===r?void 0:r.currency_symbol)||"Rs.";return(0,F.jsxs)(a.A,{sx:{width:"210mm",minHeight:"297mm",bgcolor:"white",p:4,fontFamily:"Arial, sans-serif",fontSize:"12pt","@media print":{boxShadow:"none",margin:0,padding:"20mm"}},children:[(0,F.jsxs)(a.A,{textAlign:"center",mb:3,children:[(null===r||void 0===r?void 0:r.logo_url)&&(0,F.jsx)(a.A,{mb:2,display:"flex",justifyContent:"center",children:(0,F.jsx)("img",{src:r.logo_url,alt:"Store Logo",style:{maxHeight:"80px",maxWidth:"200px",objectFit:"contain"}})}),(0,F.jsx)(s.A,{variant:"h4",fontWeight:700,color:"primary",gutterBottom:!0,children:(null===r||void 0===r?void 0:r.store_name)||"Medical Store"}),(0,F.jsx)(s.A,{variant:"body2",color:"text.secondary",children:(null===r||void 0===r?void 0:r.address)||"Store Address"}),(0,F.jsxs)(s.A,{variant:"body2",color:"text.secondary",children:["Phone: ",(null===r||void 0===r?void 0:r.phone)||"Contact Number"]})]}),(0,F.jsx)(W.A,{sx:{mb:2,borderWidth:2}}),(0,F.jsxs)(a.A,{mb:3,children:[(0,F.jsx)(s.A,{variant:"h6",fontWeight:600,gutterBottom:!0,children:"INVOICE"}),(0,F.jsxs)(a.A,{display:"flex",justifyContent:"space-between",mb:1,children:[(0,F.jsxs)(s.A,{variant:"body2",children:[(0,F.jsx)("strong",{children:"Invoice #:"})," ",o.id.slice(0,8).toUpperCase()]}),(0,F.jsxs)(s.A,{variant:"body2",children:[(0,F.jsx)("strong",{children:"Date:"})," ",(l=o.created_at,new Date(l).toLocaleDateString("en-PK",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}))]})]}),o.customer_id&&(0,F.jsxs)(s.A,{variant:"body2",children:[(0,F.jsx)("strong",{children:"Customer:"})," ",(null===(t=o.customer)||void 0===t?void 0:t.name)||"Walk-in Customer"]}),(0,F.jsxs)(s.A,{variant:"body2",children:[(0,F.jsx)("strong",{children:"Payment:"})," ",(null===(e=o.payment_method)||void 0===e?void 0:e.toUpperCase())||"CASH"]})]}),(0,F.jsx)(W.A,{sx:{mb:2}}),(0,F.jsxs)(I.A,{size:"small",sx:{mb:3},children:[(0,F.jsx)(S.A,{children:(0,F.jsxs)(R.A,{children:[(0,F.jsx)(D.A,{sx:{fontWeight:700,borderBottom:2},children:"Item"}),(0,F.jsx)(D.A,{align:"center",sx:{fontWeight:700,borderBottom:2},children:"Qty"}),(0,F.jsx)(D.A,{align:"center",sx:{fontWeight:700,borderBottom:2},children:"Unit"}),(0,F.jsx)(D.A,{align:"right",sx:{fontWeight:700,borderBottom:2},children:"Price"}),(0,F.jsx)(D.A,{align:"right",sx:{fontWeight:700,borderBottom:2},children:"Total"})]})}),(0,F.jsx)(z.A,{children:i.map((n,t)=>{var e,o,i;const r=n.price_at_sale||(null===(e=n.products)||void 0===e?void 0:e.price)||0,a=n.quantity*r;return(0,F.jsxs)(R.A,{children:[(0,F.jsx)(D.A,{children:(null===(o=n.products)||void 0===o?void 0:o.name)||(null===(i=n.product)||void 0===i?void 0:i.name)||"Product"}),(0,F.jsx)(D.A,{align:"center",children:n.quantity}),(0,F.jsx)(D.A,{align:"center",children:"box"===n.selling_unit?"Box":"Item"}),(0,F.jsxs)(D.A,{align:"right",children:[c," ",r.toFixed(2)]}),(0,F.jsxs)(D.A,{align:"right",children:[c," ",a.toFixed(2)]})]},t)})})]}),(0,F.jsx)(W.A,{sx:{mb:2}}),(0,F.jsx)(a.A,{display:"flex",justifyContent:"flex-end",mb:4,children:(0,F.jsxs)(a.A,{minWidth:"250px",children:[(0,F.jsxs)(a.A,{display:"flex",justifyContent:"space-between",mb:1,children:[(0,F.jsx)(s.A,{variant:"body1",children:"Subtotal:"}),(0,F.jsxs)(s.A,{variant:"body1",fontWeight:600,children:[c," ",(o.total_amount+(o.discount||0)).toFixed(2)]})]}),o.discount>0&&(0,F.jsxs)(a.A,{display:"flex",justifyContent:"space-between",mb:1,color:"error.main",children:[(0,F.jsx)(s.A,{variant:"body1",children:"Discount:"}),(0,F.jsxs)(s.A,{variant:"body1",fontWeight:600,children:["- ",c," ",o.discount.toFixed(2)]})]}),(0,F.jsx)(W.A,{sx:{my:1}}),(0,F.jsxs)(a.A,{display:"flex",justifyContent:"space-between",bgcolor:"primary.main",color:"white",p:1,borderRadius:1,children:[(0,F.jsx)(s.A,{variant:"h6",fontWeight:700,children:"TOTAL:"}),(0,F.jsxs)(s.A,{variant:"h6",fontWeight:700,children:[c," ",o.total_amount.toFixed(2)]})]})]})}),(0,F.jsx)(W.A,{sx:{mb:2}}),(0,F.jsxs)(a.A,{textAlign:"center",mt:4,children:[(0,F.jsx)(s.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Thank you for your business!"}),(0,F.jsx)(s.A,{variant:"caption",color:"text.secondary",children:(null===r||void 0===r?void 0:r.footer_text)||"Please keep this receipt for your records"})]}),(0,F.jsxs)(a.A,{mt:6,display:"flex",justifyContent:"space-between",children:[(0,F.jsxs)(a.A,{children:[(0,F.jsx)(s.A,{variant:"caption",color:"text.secondary",children:"_____________________"}),(0,F.jsx)(s.A,{variant:"caption",display:"block",color:"text.secondary",children:"Customer Signature"})]}),(0,F.jsxs)(a.A,{textAlign:"right",children:[(0,F.jsx)(s.A,{variant:"caption",color:"text.secondary",children:"_____________________"}),(0,F.jsx)(s.A,{variant:"caption",display:"block",color:"text.secondary",children:"Authorized Signatory"})]})]}),(0,F.jsx)(a.A,{mt:4,textAlign:"center",children:(0,F.jsxs)(s.A,{variant:"caption",color:"text.secondary",children:["Invoice ID: ",o.id]})})]});var l}var E=e(12807),N=e(43243);const T=(n,t,e)=>{try{const o=(null===e||void 0===e?void 0:e.store_name)||"Medical Store",i=(null===e||void 0===e?void 0:e.currency_symbol)||"Rs",r=t.reduce((n,t)=>{var e;const o=parseFloat(t.price_at_sale||(null===(e=t.products)||void 0===e?void 0:e.price)||0);return n+parseInt(t.quantity||0)*o},0),a='\n<!DOCTYPE html>\n<html>\n<head>\n    <meta charset="UTF-8">\n    <title>Receipt #'.concat(n.id.slice(0,8),'</title>\n    <style>\n        @media print {\n            @page {\n                size: 80mm auto;\n                margin: 5mm;\n            }\n            body {\n                margin: 0;\n                padding: 0;\n            }\n        }\n        \n        body {\n            font-family: \'Courier New\', monospace;\n            width: 80mm;\n            margin: 0 auto;\n            padding: 10px;\n            font-size: 12px;\n        }\n        \n        .header {\n            text-align: center;\n            margin-bottom: 15px;\n            border-bottom: 2px dashed #000;\n            padding-bottom: 10px;\n        }\n       \n        \n        .store-name {\n            font-size: 18px;\n            font-weight: bold;\n            margin-bottom: 5px;\n        }\n        \n        .receipt-title {\n            font-size: 14px;\n            margin-bottom: 5px;\n        }\n        \n        .date-time, .invoice-id {\n            font-size: 11px;\n            color: #333;\n        }\n        \n        .items-table {\n            width: 100%;\n            margin: 10px 0;\n            border-collapse: collapse;\n        }\n        \n        .items-table th {\n            text-align: left;\n            border-bottom: 1px solid #000;\n            padding: 5px 2px;\n            font-size: 10px;\n        }\n        \n        .items-table td {\n            padding: 5px 2px;\n            font-size: 10px;\n        }\n        \n        .item-name {\n            max-width: 25mm;\n            word-wrap: break-word;\n        }\n        \n        .text-center {\n            text-align: center;\n        }\n        \n        .text-right {\n            text-align: right;\n        }\n        \n        .totals {\n            margin-top: 10px;\n            border-top: 1px dashed #000;\n            padding-top: 10px;\n        }\n        \n        .total-row {\n            display: flex;\n            justify-content: space-between;\n            margin: 5px 0;\n            font-size: 12px;\n        }\n        \n        .total-row.final {\n            font-weight: bold;\n            font-size: 14px;\n            border-top: 1px solid #000;\n            padding-top: 5px;\n            margin-top: 5px;\n        }\n        \n        .footer {\n            text-align: center;\n            margin-top: 15px;\n            padding-top: 10px;\n            border-top: 2px dashed #000;\n            font-size: 11px;\n        }\n    </style>\n</head>\n<body>\n    <div class="header">\n        <div class="store-name">').concat(o,'</div>\n        <div class="receipt-title">SALES RECEIPT</div>\n        <div class="date-time">').concat((0,N.Yq)(n.created_at)," ").concat((0,N.fU)(n.created_at),'</div>\n        <div class="invoice-id">Invoice #').concat(n.id.slice(0,8),'</div>\n    </div>\n    \n    <table class="items-table">\n        <thead>\n            <tr>\n                <th>Item</th>\n                <th class="text-right">Price</th>\n                <th class="text-center">Qty</th>\n                <th class="text-right">Total</th>\n            </tr>\n        </thead>\n        <tbody>\n            ').concat(t.map(n=>{var t,e;const o=parseFloat(n.price_at_sale||(null===(t=n.products)||void 0===t?void 0:t.price)||0),r=parseInt(n.quantity||0),a=o*r;return'\n                <tr>\n                    <td class="item-name">'.concat((null===(e=n.products)||void 0===e?void 0:e.name)||"Item",'</td>\n                    <td class="text-right">').concat(i," ").concat(o.toFixed(2),'</td>\n                    <td class="text-center">').concat(r,'</td>\n                    <td class="text-right">').concat(i," ").concat(a.toFixed(2),"</td>\n                </tr>\n                ")}).join(""),'\n        </tbody>\n    </table>\n    \n    <div class="totals">\n        <div class="total-row">\n            <span>Subtotal:</span>\n            <span>').concat((0,E.vv)(r,i),"</span>\n        </div>\n        ").concat(n.discount>0?'\n        <div class="total-row">\n            <span>Discount:</span>\n            <span>-'.concat((0,E.vv)(n.discount,i),"</span>\n        </div>\n        "):"",'\n        <div class="total-row final">\n            <span>Grand Total:</span>\n            <span>').concat((0,E.vv)(n.total_amount,i),'</span>\n        </div>\n    </div>\n    \n    <div class="footer">\n        ').concat((null===e||void 0===e?void 0:e.footer_text)||"Thank you for your business!",'\n        <div class="branding" style="margin-top: 10px; font-size: 9px; color: #888; font-style: italic;">\n            Receipt designed and generated by MedixFlow | +923089020131\n        </div>\n    </div>\n    \n    <script>\n        // Auto-close window after printing or canceling\n        window.onafterprint = function() {\n            window.close();\n        };\n        \n        // Trigger print dialog immediately\n        window.onload = function() {\n            window.print();\n        };\n    <\/script>\n</body>\n</html>\n        '),s=window.open("","_blank","width=300,height=600");return s?(s.document.write(a),s.document.close(),!0):(console.error("Could not open print window. Popup blocked?"),!1)}catch(o){return console.error("Receipt printing failed:",o),!1}},L=[50,75,100,125,150,200];function U(n){let{open:t,onClose:e,invoice:w,items:W,settings:I}=n;const[S,R]=(0,o.useState)(100),D=(0,o.useRef)(null),[z,E]=(0,o.useState)(!1),N=async()=>{if(!D.current)return null;try{E(!0);return await _()(D.current,{scale:2,useCORS:!0,logging:!1,backgroundColor:"#ffffff"})}catch(n){return console.error("Error generating image:",n),k.oR.error("Failed to generate receipt image"),null}finally{E(!1)}};return(0,F.jsxs)(i.A,{open:t,onClose:e,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{minHeight:"80vh",maxHeight:"90vh"}},BackdropProps:{sx:{backdropFilter:"blur(5px)",backgroundColor:"rgba(0, 0, 0, 0.7)"}},children:[(0,F.jsxs)(r.A,{sx:{p:3,bgcolor:"#f5f5f5"},children:[(0,F.jsxs)(a.A,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[(0,F.jsx)(s.A,{variant:"h6",fontWeight:600,children:"Invoice Receipt"}),(0,F.jsx)(c.A,{onClick:e,children:(0,F.jsx)(g.A,{})})]}),(0,F.jsx)(a.A,{sx:{overflow:"auto",maxHeight:"calc(80vh - 200px)",bgcolor:"#fff",p:2,borderRadius:1,boxShadow:2},children:(0,F.jsx)(a.A,{ref:D,sx:{transform:"scale(".concat(S/100,")"),transformOrigin:"top center",transition:"transform 0.2s ease"},children:(0,F.jsx)(P,{invoice:w,items:W,settings:I})})}),(0,F.jsxs)(a.A,{display:"flex",justifyContent:"center",alignItems:"center",gap:2,mt:2,children:[(0,F.jsx)(l.A,{title:"Zoom Out",children:(0,F.jsx)("span",{children:(0,F.jsx)(c.A,{onClick:()=>{const n=L.indexOf(S);n>0&&R(L[n-1])},disabled:S===L[0],size:"small",children:(0,F.jsx)(f.A,{})})})}),(0,F.jsx)(d.A,{size:"small",sx:{minWidth:100},children:(0,F.jsx)(p.A,{value:S,onChange:n=>R(n.target.value),children:L.map(n=>(0,F.jsxs)(x.A,{value:n,children:[n,"%"]},n))})}),(0,F.jsx)(l.A,{title:"Zoom In",children:(0,F.jsx)("span",{children:(0,F.jsx)(c.A,{onClick:()=>{const n=L.indexOf(S);n<L.length-1&&R(L[n+1])},disabled:S===L[L.length-1],size:"small",children:(0,F.jsx)(v.A,{})})})})]})]}),(0,F.jsxs)(h.A,{sx:{p:2,bgcolor:"#f5f5f5",flexDirection:"column",gap:2},children:[(0,F.jsxs)(u.A,{direction:"row",spacing:1,flexWrap:"wrap",justifyContent:"center",width:"100%",children:[(0,F.jsx)(m.A,{variant:"contained",startIcon:(0,F.jsx)(y.A,{}),onClick:async()=>{const n=await N();if(!n)return;const t=n.toDataURL("image/png"),e="Invoice #".concat(w.id.slice(0,8),"%0ATotal: ").concat((null===I||void 0===I?void 0:I.currency_symbol)||"Rs."," ").concat(w.total_amount,"%0ADate: ").concat(new Date(w.created_at).toLocaleDateString(),"%0A%0AThank you for your business!");if(navigator.share&&navigator.canShare)try{const n=await(await fetch(t)).blob(),o=new File([n],"receipt.png",{type:"image/png"});return await navigator.share({title:"Invoice Receipt",text:e.replace(/%0A/g,"\n"),files:[o]}),void k.oR.success("Receipt shared successfully!")}catch(o){"AbortError"!==o.name&&console.log("Native share not available, falling back to WhatsApp Web")}window.open("https://wa.me/?text=".concat(e),"_blank");try{const n=await(await fetch(t)).blob();await navigator.clipboard.write([new ClipboardItem({[n.type]:n})]),k.oR.info("WhatsApp opened. Receipt image copied to clipboard! Just press Ctrl+V to paste.")}catch(i){console.error("Clipboard write failed:",i);const n=document.createElement("a");n.href=t,n.download="receipt_".concat(w.id.slice(0,8),".png"),n.click(),k.oR.info("WhatsApp opened. Please attach the downloaded receipt image manually.")}},disabled:z,size:"large",sx:{bgcolor:"#25D366","&:hover":{bgcolor:"#128C7E"},minWidth:{xs:"140px",sm:"auto"},fontSize:{xs:"1rem",sm:"0.875rem"},py:{xs:1.5,sm:1}},children:"WhatsApp"}),(0,F.jsx)(m.A,{variant:"outlined",startIcon:(0,F.jsx)(b.A,{}),onClick:async()=>{const n=await N();if(!n)return;const t=n.toDataURL("image/png"),e=new C.Ay({orientation:"portrait",unit:"mm",format:"a4"}),o=190*n.height/n.width;e.addImage(t,"PNG",10,10,190,o),e.save("receipt_".concat(w.id.slice(0,8),".pdf")),k.oR.success("PDF downloaded successfully!")},disabled:z,size:"large",sx:{minWidth:{xs:"100px",sm:"auto"},py:{xs:1.5,sm:1}},children:"PDF"}),(0,F.jsx)(m.A,{variant:"outlined",startIcon:(0,F.jsx)(A.A,{}),onClick:async()=>{const n=await N();if(!n)return;const t=document.createElement("a");t.href=n.toDataURL("image/png"),t.download="receipt_".concat(w.id.slice(0,8),".png"),t.click(),k.oR.success("Image downloaded successfully!")},disabled:z,size:"large",sx:{minWidth:{xs:"100px",sm:"auto"},py:{xs:1.5,sm:1}},children:"Image"}),(0,F.jsx)(m.A,{variant:"outlined",startIcon:(0,F.jsx)(j.A,{}),onClick:()=>{T(w,W,I)||k.oR.error("Failed to open print window. Please allow popups.")},size:"large",sx:{minWidth:{xs:"100px",sm:"auto"},py:{xs:1.5,sm:1}},children:"Print"})]}),(0,F.jsx)(m.A,{onClick:e,variant:"outlined",fullWidth:!0,size:"large",children:"Close"})]})]})}}}]);
//# sourceMappingURL=249.a3fe3375.chunk.js.map