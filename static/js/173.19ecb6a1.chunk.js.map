{"version":3,"file":"static/js/173.19ecb6a1.chunk.js","mappings":"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","sources":["../node_modules/@mui/icons-material/esm/Visibility.js","utils/formatters.js","../node_modules/@mui/icons-material/esm/Send.js","components/purchaseOrders/CreateEditPODialog.js","components/stock/ReceiveStockDialog.js","utils/poPdfGenerator.js","components/purchaseOrders/PODetailDialog.js","../node_modules/@mui/icons-material/esm/Share.js","utils/printPO.js","components/purchaseOrders/POReceiptModal.js","components/purchaseOrders/PurchaseOrdersPage.js","../node_modules/@mui/icons-material/esm/Add.js","../node_modules/@mui/icons-material/esm/Edit.js","utils/whatsappHelper.js","../node_modules/@mui/icons-material/esm/CheckCircle.js"],"sourcesContent":["\"use client\";\n\nimport createSvgIcon from './utils/createSvgIcon';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nexport default createSvgIcon( /*#__PURE__*/_jsx(\"path\", {\n  d: \"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5M12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5m0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3\"\n}), 'Visibility');","/**\n * Format currency value\n * @param {number} value - Value to format\n * @param {string} symbol - Currency symbol (default: 'PKR')\n * @returns {string} Formatted currency string\n */\nexport function formatCurrency(value, symbol = 'PKR') {\n    if (value === null || value === undefined || isNaN(value)) {\n        return `${symbol} 0.00`;\n    }\n\n    const num = Number(value);\n    return `${symbol} ${num.toLocaleString('en-US', {\n        minimumFractionDigits: 2,\n        maximumFractionDigits: 2,\n    })}`;\n}\n\n/**\n * Format number with thousand separators\n * @param {number} value - Value to format\n * @returns {string} Formatted number string\n */\nexport function formatNumber(value) {\n    if (value === null || value === undefined || isNaN(value)) {\n        return '0';\n    }\n\n    return Number(value).toLocaleString('en-US');\n}\n\n/**\n * Format percentage\n * @param {number} value - Value to format (0-100)\n * @param {number} decimals - Number of decimal places (default: 1)\n * @returns {string} Formatted percentage string\n */\nexport function formatPercentage(value, decimals = 1) {\n    if (value === null || value === undefined || isNaN(value)) {\n        return '0%';\n    }\n\n    return `${Number(value).toFixed(decimals)}%`;\n}\n\n/**\n * Truncate text to specified length\n * @param {string} text - Text to truncate\n * @param {number} maxLength - Maximum length\n * @returns {string} Truncated text\n */\nexport function truncateText(text, maxLength = 50) {\n    if (!text) return '';\n    if (text.length <= maxLength) return text;\n    return text.substring(0, maxLength) + '...';\n}\n\n/**\n * Capitalize first letter of each word\n * @param {string} text - Text to capitalize\n * @returns {string} Capitalized text\n */\nexport function capitalizeWords(text) {\n    if (!text) return '';\n    return text\n        .toLowerCase()\n        .split(' ')\n        .map(word => word.charAt(0).toUpperCase() + word.slice(1))\n        .join(' ');\n}\n\n/**\n * Format phone number\n * @param {string} phone - Phone number\n * @returns {string} Formatted phone number\n */\nexport function formatPhone(phone) {\n    if (!phone) return '';\n    // Remove all non-digit characters\n    const cleaned = phone.replace(/\\D/g, '');\n\n    // Format as: 0300-1234567\n    if (cleaned.length === 11 && cleaned.startsWith('0')) {\n        return `${cleaned.slice(0, 4)}-${cleaned.slice(4)}`;\n    }\n\n    return phone;\n}\n\n/**\n * Get initials from name\n * @param {string} name - Full name\n * @returns {string} Initials (max 2 letters)\n */\nexport function getInitials(name) {\n    if (!name) return '?';\n\n    const parts = name.trim().split(' ');\n    if (parts.length === 1) {\n        return parts[0].charAt(0).toUpperCase();\n    }\n\n    return (parts[0].charAt(0) + parts[parts.length - 1].charAt(0)).toUpperCase();\n}\n\n/**\n * Calculate profit margin percentage\n * @param {number} revenue - Total revenue\n * @param {number} cost - Total cost\n * @returns {number} Profit margin percentage\n */\nexport function calculateProfitMargin(revenue, cost) {\n    if (!revenue || revenue === 0) return 0;\n    const profit = revenue - (cost || 0);\n    return (profit / revenue) * 100;\n}\n\n/**\n * Generate random color for charts\n * @param {number} index - Index for consistent colors\n * @returns {string} Hex color code\n */\nexport function getChartColor(index) {\n    const colors = [\n        '#6366f1', // Indigo\n        '#ec4899', // Pink\n        '#10b981', // Green\n        '#f59e0b', // Amber\n        '#3b82f6', // Blue\n        '#8b5cf6', // Purple\n        '#ef4444', // Red\n        '#14b8a6', // Teal\n        '#f97316', // Orange\n        '#06b6d4', // Cyan\n    ];\n\n    return colors[index % colors.length];\n}\n","\"use client\";\n\nimport createSvgIcon from './utils/createSvgIcon';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nexport default createSvgIcon( /*#__PURE__*/_jsx(\"path\", {\n  d: \"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z\"\n}), 'Send');","import React, { useState, useEffect } from 'react';\r\nimport {\r\n    Dialog,\r\n    DialogTitle,\r\n    DialogContent,\r\n    DialogActions,\r\n    Button,\r\n    TextField,\r\n    Grid,\r\n    MenuItem,\r\n    Box,\r\n    Typography,\r\n    IconButton,\r\n    Table,\r\n    TableBody,\r\n    TableCell,\r\n    TableContainer,\r\n    TableHead,\r\n    TableRow,\r\n    Autocomplete,\r\n    Divider,\r\n    Card,\r\n    CardContent,\r\n    useTheme,\r\n    useMediaQuery,\r\n} from '@mui/material';\r\nimport { Add, Delete, ShoppingCart } from '@mui/icons-material';\r\nimport { toast } from 'react-toastify';\r\nimport { supabase } from '../../supabaseClient';\r\n\r\nexport default function CreateEditPODialog({ open, onClose, purchaseOrder, suppliers }) {\r\n    const isEdit = !!purchaseOrder;\r\n    const theme = useTheme();\r\n    const isMobile = useMediaQuery(theme.breakpoints.down('sm'));\r\n\r\n    const [formData, setFormData] = useState({\r\n        supplier_id: '',\r\n        order_date: new Date().toISOString().split('T')[0],\r\n        notes: '',\r\n    });\r\n\r\n    const [items, setItems] = useState([]);\r\n    const [products, setProducts] = useState([]);\r\n    const [loading, setLoading] = useState(false);\r\n    const [searchResults, setSearchResults] = useState([]);\r\n    const [searching, setSearching] = useState(false);\r\n\r\n    useEffect(() => {\r\n        if (open) {\r\n            fetchProducts();\r\n            if (isEdit) {\r\n                loadPOData();\r\n            } else {\r\n                resetForm();\r\n            }\r\n        }\r\n    }, [open, purchaseOrder]);\r\n\r\n    const fetchProducts = async () => {\r\n        const { data: { session } } = await supabase.auth.getSession();\r\n        if (!session) return;\r\n\r\n        const { data } = await supabase\r\n            .from('products')\r\n            .select('*')\r\n            .eq('organization_id', session.user.id)\r\n            .is('deleted_at', null)\r\n            .order('name');\r\n\r\n        setProducts(data || []);\r\n        // Initialize search results with existing products\r\n        setSearchResults(data || []);\r\n    };\r\n\r\n    const searchMedicineReference = async (query) => {\r\n        if (!query || query.length < 2) {\r\n            setSearchResults(products);\r\n            return;\r\n        }\r\n\r\n        setSearching(true);\r\n        try {\r\n            // 1. Filter existing products locally\r\n            const localMatches = products.filter(p => \r\n                p.name.toLowerCase().includes(query.toLowerCase())\r\n            );\r\n\r\n            // 2. Search medicine reference\r\n            const { data: refData } = await supabase\r\n                .from('medicine_reference')\r\n                .select('*')\r\n                .or(`brand_name.ilike.%${query}%,generic_name.ilike.%${query}%`)\r\n                .limit(20);\r\n\r\n            // 3. Combine results\r\n            // Filter out reference items that already exist in products (by name match approx)\r\n            const newRefItems = refData?.filter(ref => \r\n                !products.some(p => p.name.toLowerCase() === ref.brand_name.toLowerCase())\r\n            ).map(ref => ({\r\n                ...ref,\r\n                id: `REF-${ref.id}`, // Temporary ID for UI\r\n                isReference: true,\r\n                name: ref.brand_name,\r\n                // Map reference fields to product fields\r\n                items_per_box: ref.standard_packaging ? extractItemsPerBox(ref.standard_packaging) : 1\r\n            })) || [];\r\n\r\n            setSearchResults([...localMatches, ...newRefItems]);\r\n        } catch (error) {\r\n            console.error('Error searching:', error);\r\n            setSearchResults(products); // Fallback to local\r\n        } finally {\r\n            setSearching(false);\r\n        }\r\n    };\r\n\r\n    // Helper from ProductsPage\r\n    const extractItemsPerBox = (packagingString) => {\r\n        if (!packagingString) return 1;\r\n        const match = packagingString.match(/(\\d+)\\s*(tablets?|items?|capsules?)/i);\r\n        return match ? parseInt(match[1]) : 1;\r\n    };\r\n\r\n    const loadPOData = async () => {\r\n        if (!purchaseOrder) return;\r\n\r\n        setFormData({\r\n            supplier_id: purchaseOrder.supplier_id || '',\r\n            order_date: purchaseOrder.order_date || new Date().toISOString().split('T')[0],\r\n            notes: purchaseOrder.notes || '',\r\n        });\r\n\r\n        // Fetch PO items\r\n        const { data } = await supabase\r\n            .from('purchase_order_items')\r\n            .select('*, products(name)')\r\n            .eq('purchase_order_id', purchaseOrder.id);\r\n\r\n        if (data) {\r\n            setItems(data.map(item => ({\r\n                product_id: item.product_id,\r\n                product_name: item.products?.name,\r\n                quantity_ordered: item.quantity_ordered,\r\n                boxes_ordered: item.boxes_ordered || '',\r\n                items_per_box: item.items_per_box || 1,\r\n            })));\r\n        }\r\n    };\r\n\r\n    const resetForm = () => {\r\n        setFormData({\r\n            supplier_id: '',\r\n            order_date: new Date().toISOString().split('T')[0],\r\n            notes: '',\r\n        });\r\n        setItems([]);\r\n    };\r\n\r\n    const handleChange = (e) => {\r\n        setFormData({\r\n            ...formData,\r\n            [e.target.name]: e.target.value,\r\n        });\r\n    };\r\n\r\n    const handleAddItem = () => {\r\n        setItems([...items, {\r\n            product_id: '',\r\n            product_name: '',\r\n            quantity_ordered: 1,\r\n            boxes_ordered: '',\r\n            items_per_box: 1,\r\n        }]);\r\n    };\r\n\r\n    const handleRemoveItem = (index) => {\r\n        setItems(items.filter((_, i) => i !== index));\r\n    };\r\n\r\n    const handleItemChange = (index, field, value) => {\r\n        const newItems = [...items];\r\n        newItems[index][field] = value;\r\n\r\n        // If product changed (from autocomplete)\r\n        if (field === 'product_id') {\r\n            // Value could be a real product ID, a REF- ID, or a custom string name\r\n            // But here 'value' passed from handleItemChange is just the ID or Name\r\n            \r\n            // We need to find the full object from searchResults (or products)\r\n            // However, handleItemChange gets the value directly.\r\n            // Let's adjust handleItemChange usage in Autocomplete onChange instead.\r\n            \r\n            // For now, let's look up in searchResults which keeps growing? \r\n            // Better: look up in products OR check if it is a ref item stored in items state\r\n            \r\n            const product = products.find(p => p.id === value);\r\n            if (product) {\r\n                newItems[index].product_name = product.name;\r\n                newItems[index].items_per_box = product.items_per_box || 1;\r\n                // Recalculate if boxes are already entered\r\n                if (newItems[index].boxes_ordered) {\r\n                    newItems[index].quantity_ordered = newItems[index].boxes_ordered * (product.items_per_box || 1);\r\n                }\r\n            }\r\n        }\r\n\r\n        // Auto-calculate total quantity if boxes or items_per_box change\r\n        if (field === 'boxes_ordered' || field === 'items_per_box') {\r\n            const boxes = field === 'boxes_ordered' ? value : newItems[index].boxes_ordered;\r\n            const perBox = field === 'items_per_box' ? value : newItems[index].items_per_box;\r\n\r\n            if (boxes && perBox) {\r\n                newItems[index].quantity_ordered = parseInt(boxes) * parseInt(perBox);\r\n            }\r\n        }\r\n\r\n        setItems(newItems);\r\n    };\r\n\r\n    const handleKeyDown = (e, index) => {\r\n        if (e.key === 'Enter' && !e.shiftKey) {\r\n            e.preventDefault();\r\n            // Move to next field or add new item if on last item\r\n            if (index === items.length - 1) {\r\n                handleAddItem();\r\n            }\r\n        }\r\n    };\r\n\r\n    const handleSubmit = async () => {\r\n        // Validation\r\n        if (!formData.supplier_id) {\r\n            toast.error('Please select a supplier');\r\n            return;\r\n        }\r\n        if (items.length === 0) {\r\n            toast.error('Please add at least one item');\r\n            return;\r\n        }\r\n        if (items.some(item => !item.product_id || item.quantity_ordered <= 0)) {\r\n            toast.error('Please fill in all item details correctly');\r\n            return;\r\n        }\r\n\r\n        setLoading(true);\r\n        try {\r\n            const { data: { session } } = await supabase.auth.getSession();\r\n            if (!session) throw new Error('Not authenticated');\r\n\r\n            if (isEdit) {\r\n                // Update existing PO\r\n                const { error: poError } = await supabase\r\n                    .from('purchase_orders')\r\n                    .update({\r\n                        supplier_id: formData.supplier_id,\r\n                        order_date: formData.order_date,\r\n                        notes: formData.notes,\r\n                        updated_at: new Date().toISOString(),\r\n                    })\r\n                    .eq('id', purchaseOrder.id);\r\n\r\n                if (poError) throw poError;\r\n\r\n                // Delete existing items\r\n                await supabase\r\n                    .from('purchase_order_items')\r\n                    .delete()\r\n                    .eq('purchase_order_id', purchaseOrder.id);\r\n\r\n                // Insert new items\r\n                const { error: itemsError } = await supabase\r\n                    .from('purchase_order_items')\r\n                    .insert(await Promise.all(items.map(async (item) => {\r\n                        let finalProductId = item.product_id;\r\n\r\n                        // Check if it's a new item (custom or reference)\r\n                        if (!products.some(p => p.id === item.product_id)) {\r\n                            // It's a new item. Create it in products table first.\r\n                            const { data: newProd, error: createError } = await supabase\r\n                                .from('products')\r\n                                .insert([{\r\n                                    organization_id: session.user.id,\r\n                                    name: item.product_name,\r\n                                    // If it was a reference item, we might want more data?\r\n                                    // For now, minimal valid product\r\n                                    price: 0, // Default price\r\n                                    stock: 0,\r\n                                    items_per_box: item.items_per_box || 1,\r\n                                    // We could add more fields if we stored them in item state\r\n                                }])\r\n                                .select()\r\n                                .single();\r\n                            \r\n                            if (createError) throw createError;\r\n                            finalProductId = newProd.id;\r\n                        }\r\n\r\n                        return {\r\n                            purchase_order_id: purchaseOrder.id,\r\n                            product_id: finalProductId,\r\n                            quantity_ordered: item.quantity_ordered,\r\n                            boxes_ordered: item.boxes_ordered ? parseInt(item.boxes_ordered) : null,\r\n                            items_per_box: item.items_per_box ? parseInt(item.items_per_box) : 1,\r\n                            unit_price: 0,\r\n                        };\r\n                    })));\r\n\r\n                if (itemsError) throw itemsError;\r\n\r\n                toast.success('PO updated successfully!');\r\n                onClose(); // Close without passing data for edits\r\n            } else {\r\n                // Generate PO number\r\n                const { data: poNumberData } = await supabase.rpc('generate_po_number');\r\n                const poNumber = poNumberData || `PO-${Date.now()}`;\r\n\r\n                // Create new PO\r\n                const { data: newPO, error: poError } = await supabase\r\n                    .from('purchase_orders')\r\n                    .insert([{\r\n                        po_number: poNumber,\r\n                        supplier_id: formData.supplier_id,\r\n                        currency_id: null,\r\n                        order_date: formData.order_date,\r\n                        status: 'draft',\r\n                        notes: formData.notes,\r\n                        created_by: session.user.id,\r\n                        organization_id: session.user.id,\r\n                        total_amount: 0,\r\n                        final_amount: 0,\r\n                    }])\r\n                    .select()\r\n                    .single();\r\n\r\n                if (poError) throw poError;\r\n\r\n                // Insert items\r\n                const { error: itemsError } = await supabase\r\n                    .from('purchase_order_items')\r\n                    .insert(await Promise.all(items.map(async (item) => {\r\n                         let finalProductId = item.product_id;\r\n\r\n                        // Check if it's a new item (custom or reference)\r\n                         if (!products.some(p => p.id === item.product_id)) {\r\n                            // It's a new item. Create it in products table first.\r\n                            const { data: newProd, error: createError } = await supabase\r\n                                .from('products')\r\n                                .insert([{\r\n                                    organization_id: session.user.id,\r\n                                    name: item.product_name,\r\n                                    price: 0,\r\n                                    stock: 0,\r\n                                    items_per_box: item.items_per_box || 1,\r\n                                }])\r\n                                .select()\r\n                                .single();\r\n                            \r\n                            if (createError) throw createError;\r\n                            finalProductId = newProd.id;\r\n                        }\r\n\r\n                        return {\r\n                            purchase_order_id: newPO.id,\r\n                            product_id: finalProductId,\r\n                            quantity_ordered: item.quantity_ordered,\r\n                            boxes_ordered: item.boxes_ordered ? parseInt(item.boxes_ordered) : null,\r\n                            items_per_box: item.items_per_box ? parseInt(item.items_per_box) : 1,\r\n                            unit_price: 0,\r\n                        };\r\n                    })));\r\n\r\n                if (itemsError) throw itemsError;\r\n\r\n                toast.success('Purchase Order created successfully!');\r\n\r\n                // Pass the created PO data back to parent for receipt modal\r\n                const itemsWithNames = items.map(item => ({\r\n                    ...item,\r\n                    product_name: products.find(p => p.id === item.product_id)?.name\r\n                }));\r\n\r\n                onClose(newPO, itemsWithNames, suppliers.find(s => s.id === formData.supplier_id));\r\n            }\r\n        } catch (error) {\r\n            console.error('Error saving PO:', error);\r\n            toast.error('Failed to save purchase order: ' + error.message);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <Dialog open={open} onClose={() => onClose()} maxWidth=\"md\" fullWidth>\r\n            <DialogTitle>\r\n                <Box display=\"flex\" alignItems=\"center\" gap={1}>\r\n                    <ShoppingCart color=\"primary\" />\r\n                    {isEdit ? 'Edit Purchase Order' : 'Create Purchase Order'}\r\n                </Box>\r\n            </DialogTitle>\r\n            <DialogContent>\r\n                <Grid container spacing={2} sx={{ mt: 1 }}>\r\n                    <Grid item xs={12} sm={6}>\r\n                        <TextField\r\n                            select\r\n                            fullWidth\r\n                            required\r\n                            label=\"Supplier\"\r\n                            name=\"supplier_id\"\r\n                            value={formData.supplier_id}\r\n                            onChange={handleChange}\r\n                        >\r\n                            {suppliers.map((supplier) => (\r\n                                <MenuItem key={supplier.id} value={supplier.id}>\r\n                                    {supplier.name}\r\n                                </MenuItem>\r\n                            ))}\r\n                        </TextField>\r\n                    </Grid>\r\n                    <Grid item xs={12} sm={6}>\r\n                        <TextField\r\n                            fullWidth\r\n                            required\r\n                            type=\"date\"\r\n                            label=\"Order Date\"\r\n                            name=\"order_date\"\r\n                            value={formData.order_date}\r\n                            onChange={handleChange}\r\n                            InputLabelProps={{ shrink: true }}\r\n                        />\r\n                    </Grid>\r\n\r\n                    <Grid item xs={12}>\r\n                        <Divider sx={{ my: 1 }} />\r\n                        <Box display=\"flex\" justifyContent=\"space-between\" alignItems=\"center\" mb={2}>\r\n                            <Typography variant=\"h6\">Items to Order</Typography>\r\n                            <Button startIcon={<Add />} onClick={handleAddItem}>\r\n                                Add Item\r\n                            </Button>\r\n                        </Box>\r\n\r\n                        {isMobile ? (\r\n                            // Mobile view - Cards instead of table\r\n                            <Box>\r\n                                {items.map((item, index) => (\r\n                                    <Card key={index} variant=\"outlined\" sx={{ mb: 2 }}>\r\n                                        <CardContent>\r\n                                            <Grid container spacing={2}>\r\n                                                <Grid item xs={12}>\r\n                                                    <Box display=\"flex\" justifyContent=\"space-between\" alignItems=\"center\" mb={1}>\r\n                                                        <Typography variant=\"subtitle2\" fontWeight={600}>\r\n                                                            Item #{index + 1}\r\n                                                        </Typography>\r\n                                                        <IconButton size=\"small\" color=\"error\" onClick={() => handleRemoveItem(index)}>\r\n                                                            <Delete fontSize=\"small\" />\r\n                                                        </IconButton>\r\n                                                    </Box>\r\n                                                </Grid>\r\n                                                <Grid item xs={12}>\r\n                                                    <Autocomplete\r\n                                                        size=\"small\"\r\n                                                        freeSolo\r\n                                                        options={searchResults}\r\n                                                        loading={searching}\r\n                                                        getOptionLabel={(option) => {\r\n                                                            if (typeof option === 'string') return option;\r\n                                                            return option.name || '';\r\n                                                        }}\r\n                                                        value={\r\n                                                            // Logic to display correct value\r\n                                                            products.find(p => p.id === item.product_id) || \r\n                                                            (item.product_name ? { name: item.product_name } : null)\r\n                                                        }\r\n                                                        onInputChange={(event, newInputValue) => {\r\n                                                            searchMedicineReference(newInputValue);\r\n                                                        }}\r\n                                                        onChange={(e, newValue) => {\r\n                                                            let newVal = '';\r\n                                                            let newName = '';\r\n                                                            let newItemsPerBox = 1;\r\n\r\n                                                            if (typeof newValue === 'string') {\r\n                                                                // Custom manual entry\r\n                                                                newVal = `CUSTOM-${Date.now()}`; // Temp ID\r\n                                                                newName = newValue;\r\n                                                            } else if (newValue) {\r\n                                                                // Selected from list (Product or Reference)\r\n                                                                newVal = newValue.id;\r\n                                                                newName = newValue.name;\r\n                                                                newItemsPerBox = newValue.items_per_box || 1;\r\n                                                            }\r\n\r\n                                                            const newItems = [...items];\r\n                                                            newItems[index].product_id = newVal;\r\n                                                            newItems[index].product_name = newName;\r\n                                                            newItems[index].items_per_box = newItemsPerBox;\r\n                                                            \r\n                                                            // Recalculate quantity (reset boxes maybe?)\r\n                                                            newItems[index].boxes_ordered = ''; // Clear boxes on product change to avoid confusion\r\n                                                            newItems[index].quantity_ordered = 1;\r\n\r\n                                                            setItems(newItems);\r\n                                                        }}\r\n                                                        renderInput={(params) => (\r\n                                                            <TextField \r\n                                                                {...params} \r\n                                                                label=\"Product\" \r\n                                                                placeholder=\"Search or type new...\" \r\n                                                                helperText=\"Select or type new product name\"\r\n                                                            />\r\n                                                        )}\r\n                                                        renderOption={(props, option) => {\r\n                                                            return (\r\n                                                            <li {...props}>\r\n                                                                <Box>\r\n                                                                    <Typography variant=\"body2\" fontWeight={option.isReference ? 600 : 400}>\r\n                                                                        {option.name}\r\n                                                                        {option.isReference && <span style={{color: 'green', fontSize: '0.8em', marginLeft: 8}}>(Database)</span>}\r\n                                                                        {!option.isReference && !option.id && <span style={{color: 'orange', fontSize: '0.8em', marginLeft: 8}}>(New)</span>}\r\n                                                                    </Typography>\r\n                                                                    {option.generic_name && (\r\n                                                                        <Typography variant=\"caption\" color=\"text.secondary\">\r\n                                                                            {option.generic_name}\r\n                                                                        </Typography>\r\n                                                                    )}\r\n                                                                </Box>\r\n                                                            </li>\r\n                                                        )}}\r\n                                                    />\r\n                                                </Grid>\r\n                                                <Grid item xs={6}>\r\n                                                    <TextField\r\n                                                        size=\"small\"\r\n                                                        fullWidth\r\n                                                        type=\"number\"\r\n                                                        label=\"Boxes\"\r\n                                                        placeholder=\"Boxes\"\r\n                                                        value={item.boxes_ordered}\r\n                                                        onChange={(e) => handleItemChange(index, 'boxes_ordered', e.target.value)}\r\n                                                        onKeyDown={(e) => handleKeyDown(e, index)}\r\n                                                        inputProps={{ min: 1 }}\r\n                                                    />\r\n                                                </Grid>\r\n                                                <Grid item xs={6}>\r\n                                                    <TextField\r\n                                                        size=\"small\"\r\n                                                        fullWidth\r\n                                                        type=\"number\"\r\n                                                        label=\"Items/Box\"\r\n                                                        placeholder=\"Per Box\"\r\n                                                        value={item.items_per_box}\r\n                                                        onChange={(e) => handleItemChange(index, 'items_per_box', e.target.value)}\r\n                                                        onKeyDown={(e) => handleKeyDown(e, index)}\r\n                                                        inputProps={{ min: 1 }}\r\n                                                    />\r\n                                                </Grid>\r\n                                                <Grid item xs={12}>\r\n                                                    <TextField\r\n                                                        size=\"small\"\r\n                                                        fullWidth\r\n                                                        type=\"number\"\r\n                                                        label=\"Total Items\"\r\n                                                        value={item.quantity_ordered}\r\n                                                        onChange={(e) => handleItemChange(index, 'quantity_ordered', e.target.value)}\r\n                                                        onKeyDown={(e) => handleKeyDown(e, index)}\r\n                                                        inputProps={{ min: 1 }}\r\n                                                        helperText=\"Total Units\"\r\n                                                    />\r\n                                                </Grid>\r\n                                            </Grid>\r\n                                        </CardContent>\r\n                                    </Card>\r\n                                ))}\r\n                            </Box>\r\n                        ) : (\r\n                            // Desktop view - Table\r\n                            <TableContainer>\r\n                                <Table size=\"small\">\r\n                                    <TableHead>\r\n                                        <TableRow>\r\n                                            <TableCell><strong>Product</strong></TableCell>\r\n                                            <TableCell width=\"100\"><strong>Boxes</strong></TableCell>\r\n                                            <TableCell width=\"100\"><strong>Items/Box</strong></TableCell>\r\n                                            <TableCell width=\"120\"><strong>Total Items</strong></TableCell>\r\n                                            <TableCell width=\"50\"></TableCell>\r\n                                        </TableRow>\r\n                                    </TableHead>\r\n                                    <TableBody>\r\n                                        {items.map((item, index) => (\r\n                                            <TableRow key={index}>\r\n                                                <TableCell>\r\n                                                    <Autocomplete\r\n                                                        size=\"small\"\r\n                                                        freeSolo\r\n                                                        options={searchResults}\r\n                                                        loading={searching}\r\n                                                        getOptionLabel={(option) => {\r\n                                                            if (typeof option === 'string') return option;\r\n                                                            return option.name || '';\r\n                                                        }}\r\n                                                        value={\r\n                                                            products.find(p => p.id === item.product_id) || \r\n                                                            (item.product_name ? { name: item.product_name } : null)\r\n                                                        }\r\n                                                        onInputChange={(event, newInputValue) => {\r\n                                                            searchMedicineReference(newInputValue);\r\n                                                        }}\r\n                                                        onChange={(e, newValue) => {\r\n                                                            let newVal = '';\r\n                                                            let newName = '';\r\n                                                            let newItemsPerBox = 1;\r\n\r\n                                                            if (typeof newValue === 'string') {\r\n                                                                newVal = `CUSTOM-${Date.now()}`;\r\n                                                                newName = newValue;\r\n                                                            } else if (newValue) {\r\n                                                                newVal = newValue.id;\r\n                                                                newName = newValue.name;\r\n                                                                newItemsPerBox = newValue.items_per_box || 1;\r\n                                                            }\r\n\r\n                                                            const newItems = [...items];\r\n                                                            newItems[index].product_id = newVal;\r\n                                                            newItems[index].product_name = newName;\r\n                                                            newItems[index].items_per_box = newItemsPerBox;\r\n                                                            newItems[index].boxes_ordered = ''; \r\n                                                            newItems[index].quantity_ordered = 1;\r\n                                                            setItems(newItems);\r\n                                                        }}\r\n                                                        renderInput={(params) => (\r\n                                                            <TextField {...params} placeholder=\"Search or type new...\" />\r\n                                                        )}\r\n                                                        renderOption={(props, option) => (\r\n                                                            <li {...props}>\r\n                                                                <Box>\r\n                                                                    <Typography variant=\"body2\" fontWeight={option.isReference ? 600 : 400}>\r\n                                                                        {option.name}\r\n                                                                        {option.isReference && <span style={{color: 'green', fontSize: '0.8em', marginLeft: 8}}>(Database)</span>}\r\n                                                                    </Typography>\r\n                                                                    {option.generic_name && (\r\n                                                                        <Typography variant=\"caption\" color=\"text.secondary\">\r\n                                                                            {option.generic_name}\r\n                                                                        </Typography>\r\n                                                                    )}\r\n                                                                </Box>\r\n                                                            </li>\r\n                                                        )}\r\n                                                    />\r\n                                                </TableCell>\r\n                                                <TableCell>\r\n                                                    <TextField\r\n                                                        size=\"small\"\r\n                                                        fullWidth\r\n                                                        type=\"number\"\r\n                                                        placeholder=\"Boxes\"\r\n                                                        value={item.boxes_ordered}\r\n                                                        onChange={(e) => handleItemChange(index, 'boxes_ordered', e.target.value)}\r\n                                                        onKeyDown={(e) => handleKeyDown(e, index)}\r\n                                                        inputProps={{ min: 1 }}\r\n                                                    />\r\n                                                </TableCell>\r\n                                                <TableCell>\r\n                                                    <TextField\r\n                                                        size=\"small\"\r\n                                                        fullWidth\r\n                                                        type=\"number\"\r\n                                                        placeholder=\"Per Box\"\r\n                                                        value={item.items_per_box}\r\n                                                        onChange={(e) => handleItemChange(index, 'items_per_box', e.target.value)}\r\n                                                        onKeyDown={(e) => handleKeyDown(e, index)}\r\n                                                        inputProps={{ min: 1 }}\r\n                                                    />\r\n                                                </TableCell>\r\n                                                <TableCell>\r\n                                                    <TextField\r\n                                                        size=\"small\"\r\n                                                        fullWidth\r\n                                                        type=\"number\"\r\n                                                        value={item.quantity_ordered}\r\n                                                        onChange={(e) => handleItemChange(index, 'quantity_ordered', e.target.value)}\r\n                                                        onKeyDown={(e) => handleKeyDown(e, index)}\r\n                                                        inputProps={{ min: 1 }}\r\n                                                        helperText=\"Total Units\"\r\n                                                    />\r\n                                                </TableCell>\r\n                                                <TableCell>\r\n                                                    <IconButton size=\"small\" color=\"error\" onClick={() => handleRemoveItem(index)}>\r\n                                                        <Delete fontSize=\"small\" />\r\n                                                    </IconButton>\r\n                                                </TableCell>\r\n                                            </TableRow>\r\n                                        ))}\r\n                                    </TableBody>\r\n                                </Table>\r\n                            </TableContainer>\r\n                        )}\r\n                    </Grid>\r\n\r\n                    <Grid item xs={12}>\r\n                        <TextField\r\n                            fullWidth\r\n                            multiline\r\n                            rows={2}\r\n                            label=\"Notes (Optional)\"\r\n                            name=\"notes\"\r\n                            value={formData.notes}\r\n                            onChange={handleChange}\r\n                            placeholder=\"Any special instructions for the supplier...\"\r\n                        />\r\n                    </Grid>\r\n\r\n                    <Grid item xs={12}>\r\n                        <Box bgcolor=\"info.light\" p={2} borderRadius={1}>\r\n                            <Typography variant=\"body2\" color=\"info.dark\">\r\n                                <strong>Note:</strong> Prices will be entered when you receive the stock from the supplier.\r\n                            </Typography>\r\n                        </Box>\r\n                    </Grid>\r\n                </Grid>\r\n            </DialogContent>\r\n            <DialogActions>\r\n                <Button onClick={() => onClose()}>Cancel</Button>\r\n                <Button onClick={handleSubmit} variant=\"contained\" disabled={loading}>\r\n                    {isEdit ? 'Update Order' : 'Create Order'}\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n    );\r\n}\r\n","import React, { useState, useEffect } from 'react';\nimport {\n    Dialog,\n    DialogTitle,\n    DialogContent,\n    DialogActions,\n    Button,\n    TextField,\n    Grid,\n    Box,\n    Typography,\n    Table,\n    TableBody,\n    TableCell,\n    TableContainer,\n    TableHead,\n    TableRow,\n    Chip,\n} from '@mui/material';\nimport { LocalShipping, Inventory } from '@mui/icons-material';\nimport { toast } from 'react-toastify';\nimport { supabase } from '../../supabaseClient';\n\nexport default function ReceiveStockDialog({ open, onClose, purchaseOrder, poItems }) {\n    const [receivingData, setReceivingData] = useState([]);\n    const [receivedDate, setReceivedDate] = useState(new Date().toISOString().split('T')[0]);\n    const [notes, setNotes] = useState('');\n    const [loading, setLoading] = useState(false);\n\n    useEffect(() => {\n        if (open && poItems) {\n            fetchProductDetails();\n        }\n    }, [open, poItems]);\n\n    const fetchProductDetails = async () => {\n        try {\n            // Get all product IDs\n            const productIds = poItems.map(item => item.product_id);\n\n            // Fetch current product details (especially selling price)\n            const { data: products, error } = await supabase\n                .from('products')\n                .select('id, price, cost_price, items_per_box')\n                .in('id', productIds);\n\n            if (error) throw error;\n\n            // Map products for easy lookup\n            const productMap = {};\n            products?.forEach(p => {\n                productMap[p.id] = p;\n            });\n\n            // Initialize receiving data\n            setReceivingData(poItems.map(item => {\n                const product = productMap[item.product_id];\n                return {\n                    po_item_id: item.id,\n                    product_id: item.product_id,\n                    product_name: item.product_name || item.products?.name,\n                    quantity_ordered: item.quantity_ordered,\n                    quantity_already_received: item.quantity_received,\n                    quantity_remaining: item.quantity_ordered - item.quantity_received,\n                    quantity_to_receive: 0,\n                    unit_price: item.unit_price || product?.cost_price || 0, // Purchasing Price (per item)\n                    selling_price: product?.price || 0, // Selling Price (per item)\n                    boxes_received: '',\n                    items_per_box: item.items_per_box || product?.items_per_box || 1,\n                    cost_per_box: '',\n                    total_cost: '', // User entry: Total Purchasing Cost\n                    selling_price_per_box: '', // User entry: Selling Price per Box (MRP)\n                    total_selling_price: 0, // Calculated: selling_price_per_box * boxes_received\n                };\n            }));\n        } catch (error) {\n            console.error('Error fetching product details:', error);\n            toast.error('Failed to load product details');\n        }\n    };\n\n    const handleQuantityChange = (index, field, value) => {\n        const newData = [...receivingData];\n\n        if (field === 'boxes_received' || field === 'items_per_box') {\n            newData[index][field] = value;\n\n            const boxes = parseFloat(newData[index].boxes_received) || 0;\n            const perBox = parseFloat(newData[index].items_per_box) || 1;\n\n            // Auto-calculate total quantity\n            if (boxes > 0) {\n                const totalQty = Math.round(boxes * perBox);\n                const maxReceivable = newData[index].quantity_remaining;\n                newData[index].quantity_to_receive = Math.min(totalQty, maxReceivable);\n            }\n        } else {\n            // Direct quantity update\n            const maxReceivable = newData[index].quantity_remaining;\n            const qty = Math.min(parseInt(value) || 0, maxReceivable);\n            newData[index].quantity_to_receive = qty;\n        }\n\n        setReceivingData(newData);\n    };\n\n    const handlePriceChange = (index, field, value) => {\n        const newData = [...receivingData];\n        newData[index][field] = parseFloat(value) || 0;\n\n        const boxes = parseFloat(newData[index].boxes_received) || 0;\n        const perBox = parseFloat(newData[index].items_per_box) || 1;\n        const totalItems = boxes * perBox;\n\n        // Auto-calculate costs based on Total Cost\n        if (field === 'total_cost' || field === 'boxes_received' || field === 'items_per_box') {\n            const totalCost = parseFloat(field === 'total_cost' ? value : newData[index].total_cost) || 0;\n\n            if (boxes > 0) {\n                newData[index].cost_per_box = totalCost / boxes;\n                if (totalItems > 0) {\n                    newData[index].unit_price = totalCost / totalItems;\n                }\n            }\n        }\n\n        // Auto-calculate selling price per item based on Selling Price/Box\n        if (field === 'selling_price_per_box' || field === 'items_per_box' || field === 'boxes_received') {\n            const sellBox = parseFloat(field === 'selling_price_per_box' ? value : newData[index].selling_price_per_box) || 0;\n\n            if (perBox > 0) {\n                newData[index].selling_price = sellBox / perBox;\n            }\n\n            // Calculate Total Selling Price\n            if (boxes > 0) {\n                newData[index].total_selling_price = sellBox * boxes;\n            }\n        }\n\n        setReceivingData(newData);\n    };\n\n    const handleReceiveAll = (index) => {\n        const newData = [...receivingData];\n        newData[index].quantity_to_receive = newData[index].quantity_remaining;\n        setReceivingData(newData);\n    };\n\n    const handleSubmit = async () => {\n        const itemsToReceive = receivingData.filter(item => item.quantity_to_receive > 0);\n\n        if (itemsToReceive.length === 0) {\n            toast.error('Please enter quantities to receive');\n            return;\n        }\n\n        // Validate prices are entered\n        const itemsWithoutPrice = itemsToReceive.filter(item => item.unit_price <= 0 || item.selling_price <= 0);\n        if (itemsWithoutPrice.length > 0) {\n            toast.error('Please enter both purchasing and selling prices for all items being received');\n            return;\n        }\n\n        setLoading(true);\n        try {\n            const { data: { session } } = await supabase.auth.getSession();\n            if (!session) throw new Error('Not authenticated');\n\n            // Process each item\n            for (const item of itemsToReceive) {\n                // Create stock receipt\n                const { data: stockReceipt, error: receiptError } = await supabase\n                    .from('stock_receipts')\n                    .insert([{\n                        product_id: item.product_id,\n                        quantity: item.quantity_to_receive,\n                        received_date: receivedDate,\n                        notes,\n                        purchase_order_id: purchaseOrder.id,\n                        organization_id: session.user.id // Ensure org_id is set\n                    }])\n                    .select()\n                    .single();\n\n                if (receiptError) throw receiptError;\n\n                // Fetch current stock to ensure accuracy\n                const { data: currentProduct, error: fetchError } = await supabase\n                    .from('products')\n                    .select('stock')\n                    .eq('id', item.product_id)\n                    .single();\n\n                if (fetchError) throw fetchError;\n\n                const newStock = (currentProduct?.stock || 0) + parseInt(item.quantity_to_receive);\n\n                // Update product stock, cost price, selling price, and box details\n                const { error: updateError } = await supabase\n                    .from('products')\n                    .update({\n                        stock: newStock,\n                        cost_price: item.unit_price, // Update cost price\n                        price: item.selling_price,   // Update selling price (per item)\n                        items_per_box: item.items_per_box, // Update items per box\n                        price_per_box: item.selling_price_per_box // Update MRP/Selling Price per Box\n                    })\n                    .eq('id', item.product_id);\n\n                if (updateError) throw updateError;\n\n                // Update PO item with received quantity and price\n                const { error: poItemError } = await supabase\n                    .from('purchase_order_items')\n                    .update({\n                        quantity_received: item.quantity_already_received + item.quantity_to_receive,\n                        unit_price: item.unit_price, // Save the purchasing price\n                    })\n                    .eq('id', item.po_item_id);\n\n                if (poItemError) throw poItemError;\n\n                // Record in receiving history\n                await supabase\n                    .from('po_receiving_history')\n                    .insert([{\n                        purchase_order_id: purchaseOrder.id,\n                        po_item_id: item.po_item_id,\n                        quantity_received: item.quantity_to_receive,\n                        received_date: receivedDate,\n                        received_by: session.user.id,\n                        stock_receipt_id: stockReceipt.id,\n                        notes,\n                        boxes_received: item.boxes_received ? parseInt(item.boxes_received) : null,\n                    }]);\n            }\n\n            // Check if PO is fully received\n            const allReceived = receivingData.every(item =>\n                (item.quantity_already_received + item.quantity_to_receive) >= item.quantity_ordered\n            );\n\n            if (allReceived) {\n                await supabase\n                    .from('purchase_orders')\n                    .update({ status: 'received' })\n                    .eq('id', purchaseOrder.id);\n            } else {\n                await supabase\n                    .from('purchase_orders')\n                    .update({ status: 'partially_received' })\n                    .eq('id', purchaseOrder.id);\n            }\n\n            toast.success('Stock received successfully!');\n            onClose();\n        } catch (error) {\n            console.error('Error receiving stock:', error);\n            toast.error('Failed to receive stock: ' + error.message);\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const totalToReceive = receivingData.reduce((sum, item) => sum + item.quantity_to_receive, 0);\n    const totalAmount = receivingData.reduce((sum, item) => sum + (parseFloat(item.total_cost) || 0), 0);\n\n    return (\n        <Dialog open={open} onClose={onClose} maxWidth=\"xl\" fullWidth>\n            <DialogTitle>\n                <Box display=\"flex\" alignItems=\"center\" gap={1}>\n                    <LocalShipping color=\"primary\" />\n                    Receive Stock - PO: {purchaseOrder?.po_number}\n                </Box>\n            </DialogTitle>\n            <DialogContent>\n                <Grid container spacing={2} sx={{ mt: 1 }}>\n                    <Grid item xs={12}>\n                        <TextField\n                            fullWidth\n                            type=\"date\"\n                            label=\"Received Date\"\n                            value={receivedDate}\n                            onChange={(e) => setReceivedDate(e.target.value)}\n                            InputLabelProps={{ shrink: true }}\n                        />\n                    </Grid>\n\n                    <Grid item xs={12}>\n                        <TableContainer sx={{ overflowX: 'auto', maxHeight: '60vh' }}>\n                            <Table size=\"small\" stickyHeader>\n                                <TableHead>\n                                    <TableRow>\n                                        <TableCell>Product</TableCell>\n                                        <TableCell align=\"center\">Ordered</TableCell>\n                                        <TableCell align=\"center\">Received</TableCell>\n                                        <TableCell align=\"center\">Remaining</TableCell>\n                                        <TableCell align=\"center\" sx={{ bgcolor: '#e3f2fd' }}>Boxes Received</TableCell>\n                                        <TableCell align=\"center\" sx={{ bgcolor: '#e3f2fd' }}>Items/Box</TableCell>\n                                        <TableCell align=\"center\" sx={{ bgcolor: '#e3f2fd' }}>Total Cost</TableCell>\n                                        <TableCell align=\"center\" sx={{ bgcolor: '#e3f2fd' }}>MRP/Box</TableCell>\n\n                                        {/* System Calculated Fields */}\n                                        <TableCell align=\"center\" sx={{ bgcolor: '#f5f5f5' }}>Total Items</TableCell>\n                                        <TableCell align=\"center\" sx={{ bgcolor: '#f5f5f5' }}>Cost/Box</TableCell>\n                                        <TableCell align=\"center\" sx={{ bgcolor: '#f5f5f5' }}>Cost/Item</TableCell>\n                                        <TableCell align=\"center\" sx={{ bgcolor: '#f5f5f5' }}>Sale/Item</TableCell>\n                                        <TableCell align=\"center\" sx={{ bgcolor: '#f5f5f5' }}>Total Selling</TableCell>\n                                        <TableCell></TableCell>\n                                    </TableRow>\n                                </TableHead>\n                                <TableBody>\n                                    {receivingData.map((item, index) => (\n                                        <TableRow key={index}>\n                                            <TableCell>{item.product_name}</TableCell>\n                                            <TableCell align=\"center\">\n                                                <Chip label={item.quantity_ordered} size=\"small\" />\n                                            </TableCell>\n                                            <TableCell align=\"center\">\n                                                <Chip\n                                                    label={item.quantity_already_received}\n                                                    size=\"small\"\n                                                    color={item.quantity_already_received > 0 ? 'success' : 'default'}\n                                                />\n                                            </TableCell>\n                                            <TableCell align=\"center\">\n                                                <Chip\n                                                    label={item.quantity_remaining}\n                                                    size=\"small\"\n                                                    color={item.quantity_remaining > 0 ? 'warning' : 'success'}\n                                                />\n                                            </TableCell>\n                                            <TableCell align=\"center\" sx={{ bgcolor: '#f5faff' }}>\n                                                <TextField\n                                                    type=\"number\"\n                                                    size=\"small\"\n                                                    placeholder=\"Boxes\"\n                                                    value={item.boxes_received}\n                                                    onChange={(e) => handleQuantityChange(index, 'boxes_received', e.target.value)}\n                                                    inputProps={{ min: 0, style: { width: '60px', textAlign: 'center' } }}\n                                                    disabled={item.quantity_remaining === 0}\n                                                />\n                                            </TableCell>\n                                            <TableCell align=\"center\" sx={{ bgcolor: '#f5faff' }}>\n                                                <TextField\n                                                    type=\"number\"\n                                                    size=\"small\"\n                                                    placeholder=\"/Box\"\n                                                    value={item.items_per_box}\n                                                    onChange={(e) => handleQuantityChange(index, 'items_per_box', e.target.value)}\n                                                    inputProps={{ min: 1, style: { width: '50px', textAlign: 'center' } }}\n                                                    disabled={item.quantity_remaining === 0}\n                                                />\n                                            </TableCell>\n                                            <TableCell align=\"center\" sx={{ bgcolor: '#f5faff' }}>\n                                                <TextField\n                                                    type=\"number\"\n                                                    size=\"small\"\n                                                    placeholder=\"Total\"\n                                                    value={item.total_cost}\n                                                    onChange={(e) => handlePriceChange(index, 'total_cost', e.target.value)}\n                                                    inputProps={{ min: 0, step: 0.01, style: { width: '80px', textAlign: 'center' } }}\n                                                />\n                                            </TableCell>\n                                            <TableCell align=\"center\" sx={{ bgcolor: '#f5faff' }}>\n                                                <TextField\n                                                    type=\"number\"\n                                                    size=\"small\"\n                                                    value={item.selling_price_per_box}\n                                                    onChange={(e) => handlePriceChange(index, 'selling_price_per_box', e.target.value)}\n                                                    placeholder=\"MRP\"\n                                                    inputProps={{\n                                                        min: 0,\n                                                        step: 0.01,\n                                                        style: { width: '80px', textAlign: 'center' }\n                                                    }}\n                                                />\n                                            </TableCell>\n\n                                            {/* Calculated Values */}\n                                            <TableCell align=\"center\" sx={{ bgcolor: '#f5f5f5' }}>\n                                                <Typography variant=\"body2\" fontWeight={600}>\n                                                    {item.quantity_to_receive}\n                                                </Typography>\n                                            </TableCell>\n                                            <TableCell align=\"center\" sx={{ bgcolor: '#f5f5f5' }}>\n                                                <Typography variant=\"body2\">\n                                                    {item.cost_per_box ? parseFloat(item.cost_per_box).toFixed(2) : '-'}\n                                                </Typography>\n                                            </TableCell>\n                                            <TableCell align=\"center\" sx={{ bgcolor: '#f5f5f5' }}>\n                                                <Typography variant=\"body2\">\n                                                    {item.unit_price ? parseFloat(item.unit_price).toFixed(2) : '-'}\n                                                </Typography>\n                                            </TableCell>\n                                            <TableCell align=\"center\" sx={{ bgcolor: '#f5f5f5' }}>\n                                                <Typography variant=\"body2\">\n                                                    {item.selling_price ? parseFloat(item.selling_price).toFixed(2) : '-'}\n                                                </Typography>\n                                            </TableCell>\n                                            <TableCell align=\"center\" sx={{ bgcolor: '#f5f5f5' }}>\n                                                <Typography variant=\"body2\" fontWeight={600} color=\"success.main\">\n                                                    {item.total_selling_price ? parseFloat(item.total_selling_price).toFixed(2) : '-'}\n                                                </Typography>\n                                            </TableCell>\n                                            <TableCell>\n                                                {item.quantity_remaining > 0 && (\n                                                    <Button\n                                                        size=\"small\"\n                                                        onClick={() => handleReceiveAll(index)}\n                                                    >\n                                                        All\n                                                    </Button>\n                                                )}\n                                            </TableCell>\n                                        </TableRow>\n                                    ))}\n                                </TableBody>\n                            </Table>\n                        </TableContainer>\n                    </Grid>\n\n                    <Grid item xs={12}>\n                        <Box bgcolor=\"primary.main\" color=\"white\" p={2} borderRadius={1}>\n                            <Grid container>\n                                <Grid item xs={6}>\n                                    <Typography variant=\"h6\">\n                                        Total Items: {totalToReceive}\n                                    </Typography>\n                                </Grid>\n                                <Grid item xs={6}>\n                                    <Typography variant=\"h6\" align=\"right\">\n                                        Total Cost: Rs {totalAmount.toFixed(2)}\n                                    </Typography>\n                                </Grid>\n                            </Grid>\n                        </Box>\n                    </Grid>\n\n                    <Grid item xs={12}>\n                        <TextField\n                            fullWidth\n                            multiline\n                            rows={2}\n                            label=\"Delivery Notes\"\n                            value={notes}\n                            onChange={(e) => setNotes(e.target.value)}\n                            placeholder=\"Optional notes about this delivery (condition, packaging, etc.)\"\n                        />\n                    </Grid>\n                </Grid>\n            </DialogContent>\n            <DialogActions>\n                <Button onClick={onClose}>Cancel</Button>\n                <Button\n                    variant=\"contained\"\n                    startIcon={<Inventory />}\n                    onClick={handleSubmit}\n                    disabled={loading || totalToReceive === 0}\n                >\n                    Receive Stock\n                </Button>\n            </DialogActions>\n        </Dialog>\n    );\n}\n","import jsPDF from 'jspdf';\nimport autoTable from 'jspdf-autotable';\n\nexport const generatePOPDF = async (po, poItems, settings) => {\n    try {\n        const doc = new jsPDF();\n\n        // Default values to prevent crashes\n        const storeName = settings?.store_name || 'Medical Store';\n        const poNumber = po?.po_number || 'DRAFT';\n        const orderDate = po?.order_date ? new Date(po.order_date).toLocaleDateString() : new Date().toLocaleDateString();\n        const supplierName = po?.suppliers?.name || 'N/A';\n        const supplierPhone = po?.suppliers?.phone || '';\n        const items = Array.isArray(poItems) ? poItems : [];\n\n        // Header - Store Name\n        doc.setFontSize(20);\n        doc.setFont(undefined, 'bold');\n        doc.text(storeName, 105, 20, { align: 'center' });\n\n        // Store details\n        doc.setFontSize(10);\n        doc.setFont(undefined, 'normal');\n        let yPos = 28;\n\n        if (settings?.address) {\n            doc.text(settings.address, 105, yPos, { align: 'center' });\n            yPos += 5;\n        }\n        if (settings?.phone) {\n            doc.text(`Phone: ${settings.phone}`, 105, yPos, { align: 'center' });\n            yPos += 5;\n        }\n        if (settings?.owner_name) {\n            doc.text(`Owner: ${settings.owner_name}`, 105, yPos, { align: 'center' });\n            yPos += 5;\n        }\n\n        // Divider line\n        doc.setLineWidth(0.5);\n        doc.line(14, yPos + 3, 196, yPos + 3);\n\n        // Title\n        doc.setFontSize(16);\n        doc.setFont(undefined, 'bold');\n        doc.text('PURCHASE ORDER', 105, yPos + 12, { align: 'center' });\n\n        // PO Info Box\n        const infoY = yPos + 22;\n        doc.setFontSize(11);\n        doc.setFont(undefined, 'bold');\n        doc.text('PO Details:', 14, infoY);\n\n        doc.setFont(undefined, 'normal');\n        doc.text(`PO Number: ${poNumber}`, 14, infoY + 7);\n        doc.text(`Order Date: ${orderDate}`, 14, infoY + 14);\n\n        // Supplier Info (right side)\n        doc.setFont(undefined, 'bold');\n        doc.text('Supplier:', 120, infoY);\n        doc.setFont(undefined, 'normal');\n\n        doc.text(supplierName, 120, infoY + 7);\n\n        if (supplierPhone) {\n            doc.text(`Phone: ${supplierPhone}`, 120, infoY + 14);\n        }\n\n        // Items Table\n        const tableColumn = [\"#\", \"Product\", \"Quantity (Boxes)\"];\n        const tableRows = items.map((item, index) => {\n            // Handle both data formats safely\n            let productName = 'N/A';\n            if (item.product_name) productName = item.product_name;\n            else if (item.products?.name) productName = item.products.name;\n\n            const quantity = item.quantity_ordered || 0;\n\n            return [\n                (index + 1).toString(),\n                productName,\n                quantity.toString()\n            ];\n        });\n\n        autoTable(doc, {\n            head: [tableColumn],\n            body: tableRows,\n            startY: infoY + 25,\n            theme: 'striped',\n            headStyles: {\n                fillColor: [41, 128, 185],\n                fontStyle: 'bold',\n                fontSize: 11\n            },\n            styles: {\n                fontSize: 10\n            },\n            columnStyles: {\n                0: { cellWidth: 15 },\n                1: { cellWidth: 125 },\n                2: { cellWidth: 40, halign: 'center' }\n            }\n        });\n\n        // Notes\n        let finalY = (doc.lastAutoTable && doc.lastAutoTable.finalY) || (infoY + 30) + 10;\n        if (po?.notes) {\n            doc.setFontSize(10);\n            doc.setFont(undefined, 'bold');\n            doc.text('Notes:', 14, finalY);\n            doc.setFont(undefined, 'normal');\n            const splitText = doc.splitTextToSize(po.notes, 180);\n            doc.text(splitText, 14, finalY + 6);\n            finalY += 6 + (splitText.length * 5);\n        }\n\n        // Digital Signature Area\n        finalY += 15;\n        if (finalY > 250) {\n            doc.addPage();\n            finalY = 20;\n        }\n\n        doc.setFontSize(10);\n        doc.setFont(undefined, 'normal');\n\n        // Signature boxes\n        doc.text('Prepared By:', 14, finalY);\n        doc.line(14, finalY + 15, 80, finalY + 15); // Line for signature\n        doc.setFontSize(9);\n        doc.text('Signature & Date', 30, finalY + 20);\n\n        doc.setFontSize(10);\n        doc.text('Approved By:', 120, finalY);\n        doc.line(120, finalY + 15, 186, finalY + 15); // Line for signature\n        doc.setFontSize(9);\n        doc.text('Signature & Date', 135, finalY + 20);\n\n        // Footer\n        const pageHeight = doc.internal.pageSize.height;\n        doc.setFontSize(9);\n        doc.setFont(undefined, 'italic');\n        doc.setTextColor(100, 100, 100);\n\n        const footerY = pageHeight - 20;\n        if (settings?.footer_text) {\n            doc.text(settings.footer_text, 105, footerY, { align: 'center' });\n        } else {\n            doc.text('Thank you for your service!', 105, footerY, { align: 'center' });\n        }\n\n        // Branding footer - REMOVED for white-label\n        // doc.setFontSize(8);\n        // doc.setTextColor(150, 150, 150); \n        // doc.text('Receipt designed and generated by MedixFlow | +923089020131', 105, footerY + 6, { align: 'center' });\n\n        // Page number\n        doc.setFontSize(8);\n        doc.text(`Page 1`, 105, footerY + 10, { align: 'center' });\n\n        return doc.output('blob');\n    } catch (error) {\n        console.error('PDF Generation Error:', error);\n        // Fallback: return a simple PDF with error message so app doesn't crash\n        const doc = new jsPDF();\n        doc.text('Error generating PDF receipt.', 10, 10);\n        doc.text(error.message, 10, 20);\n        return doc.output('blob');\n    }\n};\n","import React, { useState, useEffect } from 'react';\nimport {\n    Dialog,\n    DialogTitle,\n    DialogContent,\n    DialogActions,\n    Button,\n    Box,\n    Typography,\n    Grid,\n    Chip,\n    Table,\n    TableBody,\n    TableCell,\n    TableContainer,\n    TableHead,\n    TableRow,\n    Divider,\n    IconButton,\n    Tooltip,\n} from '@mui/material';\nimport {\n    Send,\n    Download,\n    LocalShipping,\n    Close,\n} from '@mui/icons-material';\nimport { toast } from 'react-toastify';\nimport { supabase } from '../../supabaseClient';\nimport { formatCurrency } from '../../utils/formatters';\nimport ReceiveStockDialog from '../stock/ReceiveStockDialog';\nimport { generatePOPDF } from '../../utils/poPdfGenerator';\nimport { openWhatsApp } from '../../utils/whatsappHelper';\n\nexport default function PODetailDialog({ open, onClose, purchaseOrder, onRefresh }) {\n    const [poDetails, setPODetails] = useState(null);\n    const [poItems, setPOItems] = useState([]);\n    const [receivingHistory, setReceivingHistory] = useState([]);\n    const [receiveDialogOpen, setReceiveDialogOpen] = useState(false);\n    const [loading, setLoading] = useState(false);\n\n    useEffect(() => {\n        if (open && purchaseOrder) {\n            fetchPODetails();\n        }\n    }, [open, purchaseOrder]);\n\n    const fetchPODetails = async () => {\n        if (!purchaseOrder) return;\n\n        try {\n            // Fetch PO with all relations\n            const { data: po, error: poError } = await supabase\n                .from('purchase_orders')\n                .select(`\n                    *,\n                    suppliers(name, phone, supplier_contacts(*))\n                `)\n                .eq('id', purchaseOrder.id)\n                .single();\n\n            if (poError) throw poError;\n            setPODetails(po);\n\n            // Fetch PO items\n            const { data: items, error: itemsError } = await supabase\n                .from('purchase_order_items')\n                .select('*, products(name)')\n                .eq('purchase_order_id', purchaseOrder.id);\n\n            if (itemsError) throw itemsError;\n            setPOItems(items || []);\n\n            // Fetch receiving history\n            const { data: history, error: historyError } = await supabase\n                .from('po_receiving_history')\n                .select('*')\n                .eq('purchase_order_id', purchaseOrder.id)\n                .order('created_at', { ascending: false });\n\n            if (historyError) throw historyError;\n            setReceivingHistory(history || []);\n        } catch (error) {\n            console.error('Error fetching PO details:', error);\n            toast.error('Failed to load PO details');\n        }\n    };\n\n    const handleSendToSupplier = async () => {\n        setLoading(true);\n        try {\n            const { data: { session } } = await supabase.auth.getSession();\n            const { data: settingsData } = await supabase\n                .from('settings')\n                .select('*')\n                .eq('organization_id', session.user.id)\n                .single();\n\n            // Generate and Download PDF\n            try {\n                const pdfBlob = await generatePOPDF(poDetails, poItems, settingsData);\n                const url = URL.createObjectURL(pdfBlob);\n                const link = document.createElement('a');\n                link.href = url;\n                link.download = `${poDetails.po_number}.pdf`;\n                link.click();\n                URL.revokeObjectURL(url);\n                toast.info('PDF downloaded! Please attach it to the WhatsApp chat.');\n            } catch (pdfError) {\n                console.error('PDF Error:', pdfError);\n                toast.warning('Could not generate PDF, but opening WhatsApp...');\n            }\n\n            // Update status to sent\n            const { error } = await supabase\n                .from('purchase_orders')\n                .update({\n                    status: 'sent',\n                    sent_at: new Date().toISOString(),\n                })\n                .eq('id', purchaseOrder.id);\n\n            if (error) throw error;\n\n            // Get primary contact\n            const primaryContact = poDetails.suppliers?.supplier_contacts?.find(c => c.is_primary);\n            const phone = primaryContact?.phone || poDetails.suppliers?.phone;\n\n            if (phone) {\n                const message = `Hello! Please find the Purchase Order ${poDetails.po_number}. We need these items as soon as possible. Thank you!`;\n                setTimeout(() => openWhatsApp(phone, message), 1000);\n            } else {\n                toast.warning('No phone number found for supplier');\n            }\n\n            toast.success('PO marked as sent!');\n            onRefresh();\n            fetchPODetails();\n        } catch (error) {\n            console.error('Error sending PO:', error);\n            toast.error('Failed to send PO');\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const handleDownloadPDF = async () => {\n        try {\n            const { data: { session } } = await supabase.auth.getSession();\n            const { data: settingsData } = await supabase\n                .from('settings')\n                .select('*')\n                .eq('organization_id', session.user.id)\n                .single();\n\n            const pdfBlob = await generatePOPDF(poDetails, poItems, settingsData);\n            const url = URL.createObjectURL(pdfBlob);\n            const link = document.createElement('a');\n            link.href = url;\n            link.download = `${poDetails.po_number}.pdf`;\n            link.click();\n            URL.revokeObjectURL(url);\n            toast.success('PDF downloaded!');\n        } catch (error) {\n            console.error('Error generating PDF:', error);\n            toast.error('Failed to generate PDF');\n        }\n    };\n\n    const handleReceiveStock = () => {\n        setReceiveDialogOpen(true);\n    };\n\n    const handleReceiveDialogClose = () => {\n        setReceiveDialogOpen(false);\n        fetchPODetails();\n        onRefresh();\n    };\n\n    if (!poDetails) return null;\n\n    const getStatusColor = (status) => {\n        const colors = {\n            draft: 'default',\n            sent: 'primary',\n            partially_received: 'secondary',\n            received: 'success',\n        };\n        return colors[status] || 'default';\n    };\n\n    const getStatusLabel = (status) => {\n        const labels = {\n            draft: 'Draft',\n            sent: 'Sent',\n            partially_received: 'Receiving',\n            received: 'Completed',\n        };\n        return labels[status] || status;\n    };\n\n    return (\n        <>\n            <Dialog open={open} onClose={onClose} maxWidth=\"md\" fullWidth>\n                <DialogTitle>\n                    <Box display=\"flex\" justifyContent=\"space-between\" alignItems=\"center\">\n                        <Typography variant=\"h6\">Purchase Order: {poDetails.po_number}</Typography>\n                        <IconButton onClick={onClose}>\n                            <Close />\n                        </IconButton>\n                    </Box>\n                </DialogTitle>\n                <DialogContent>\n                    <Grid container spacing={2}>\n                        {/* Status and Dates */}\n                        <Grid item xs={12}>\n                            <Box display=\"flex\" gap={1} flexWrap=\"wrap\">\n                                <Chip\n                                    label={getStatusLabel(poDetails.status)}\n                                    color={getStatusColor(poDetails.status)}\n                                />\n                                <Chip label={`Order: ${new Date(poDetails.order_date).toLocaleDateString()}`} variant=\"outlined\" />\n                                {poDetails.expected_delivery_date && (\n                                    <Chip label={`Expected: ${new Date(poDetails.expected_delivery_date).toLocaleDateString()}`} variant=\"outlined\" />\n                                )}\n                            </Box>\n                        </Grid>\n\n                        {/* Supplier Info */}\n                        <Grid item xs={12}>\n                            <Typography variant=\"subtitle2\" color=\"text.secondary\">Supplier</Typography>\n                            <Typography variant=\"h6\">{poDetails.suppliers?.name}</Typography>\n                            {poDetails.suppliers?.phone && (\n                                <Typography variant=\"body2\" color=\"text.secondary\">Phone: {poDetails.suppliers.phone}</Typography>\n                            )}\n                        </Grid>\n\n                        {/* Items */}\n                        <Grid item xs={12}>\n                            <Divider sx={{ my: 1 }} />\n                            <Typography variant=\"h6\" gutterBottom>Items</Typography>\n                            <TableContainer>\n                                <Table size=\"small\">\n                                    <TableHead>\n                                        <TableRow>\n                                            <TableCell>Product</TableCell>\n                                            <TableCell align=\"center\">Ordered</TableCell>\n                                            <TableCell align=\"center\">Received</TableCell>\n                                            {poDetails.status !== 'draft' && (\n                                                <>\n                                                    <TableCell align=\"right\">Unit Price</TableCell>\n                                                    <TableCell align=\"right\">Total</TableCell>\n                                                </>\n                                            )}\n                                        </TableRow>\n                                    </TableHead>\n                                    <TableBody>\n                                        {poItems.map((item) => (\n                                            <TableRow key={item.id}>\n                                                <TableCell>{item.products?.name}</TableCell>\n                                                <TableCell align=\"center\">\n                                                    <Chip\n                                                        label={item.boxes_ordered\n                                                            ? `${item.boxes_ordered} Boxes (${item.quantity_ordered})`\n                                                            : item.quantity_ordered\n                                                        }\n                                                        size=\"small\"\n                                                    />\n                                                </TableCell>\n                                                <TableCell align=\"center\">\n                                                    <Chip\n                                                        label={item.quantity_received}\n                                                        size=\"small\"\n                                                        color={item.quantity_received >= item.quantity_ordered ? 'success' : 'default'}\n                                                    />\n                                                </TableCell>\n                                                {poDetails.status !== 'draft' && (\n                                                    <>\n                                                        <TableCell align=\"right\">\n                                                            {item.unit_price > 0 ? `Rs ${formatCurrency(item.unit_price, '')}` : ''}\n                                                        </TableCell>\n                                                        <TableCell align=\"right\">\n                                                            {item.unit_price > 0 ? `Rs ${formatCurrency(item.quantity_ordered * item.unit_price, '')}` : ''}\n                                                        </TableCell>\n                                                    </>\n                                                )}\n                                            </TableRow>\n                                        ))}\n                                    </TableBody>\n                                </Table>\n                            </TableContainer>\n                        </Grid>\n\n                        {/* Receiving History */}\n                        {receivingHistory.length > 0 && (\n                            <Grid item xs={12}>\n                                <Divider sx={{ my: 1 }} />\n                                <Typography variant=\"h6\" gutterBottom>Receiving History</Typography>\n                                {receivingHistory.map((history) => (\n                                    <Box key={history.id} sx={{ mb: 1, p: 1, bgcolor: 'grey.50', borderRadius: 1 }}>\n                                        <Typography variant=\"body2\">\n                                            <strong>{new Date(history.received_date).toLocaleDateString()}:</strong>\n                                            {' '}Received {history.quantity_received} units\n                                            {history.notes && ` - ${history.notes}`}\n                                        </Typography>\n                                    </Box>\n                                ))}\n                            </Grid>\n                        )}\n\n                        {/* Notes */}\n                        {poDetails.notes && (\n                            <Grid item xs={12}>\n                                <Typography variant=\"subtitle2\" color=\"text.secondary\">Notes</Typography>\n                                <Typography variant=\"body2\">{poDetails.notes}</Typography>\n                            </Grid>\n                        )}\n                    </Grid>\n                </DialogContent>\n                <DialogActions sx={{ flexWrap: 'wrap', gap: 1, p: 2 }}>\n                    <Box flex={1} display=\"flex\" gap={1}>\n                        <Tooltip title=\"Download PDF\">\n                            <IconButton color=\"primary\" onClick={handleDownloadPDF}>\n                                <Download />\n                            </IconButton>\n                        </Tooltip>\n                    </Box>\n                    <Box display=\"flex\" gap={1} flexWrap=\"wrap\">\n                        {poDetails.status === 'draft' && (\n                            <Button\n                                startIcon={<Send />}\n                                variant=\"contained\"\n                                onClick={handleSendToSupplier}\n                                disabled={loading}\n                            >\n                                Send to Supplier\n                            </Button>\n                        )}\n                        {(poDetails.status === 'sent' || poDetails.status === 'partially_received') && (\n                            <Button\n                                startIcon={<LocalShipping />}\n                                variant=\"contained\"\n                                color=\"primary\"\n                                onClick={handleReceiveStock}\n                            >\n                                Receive Stock\n                            </Button>\n                        )}\n                        <Button onClick={onClose}>Close</Button>\n                    </Box>\n                </DialogActions>\n            </Dialog>\n\n            <ReceiveStockDialog\n                open={receiveDialogOpen}\n                onClose={handleReceiveDialogClose}\n                purchaseOrder={poDetails}\n                poItems={poItems}\n            />\n        </>\n    );\n}\n","\"use client\";\n\nimport createSvgIcon from './utils/createSvgIcon';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nexport default createSvgIcon( /*#__PURE__*/_jsx(\"path\", {\n  d: \"M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92\"\n}), 'Share');","import { formatCurrency } from './formatters';\n\nexport const printPO = (po, items, settings) => {\n    try {\n        const storeName = settings?.store_name || 'Medical Store';\n        const currency = settings?.currency_symbol || 'Rs';\n        const poNumber = po?.po_number || 'DRAFT';\n        const orderDate = po?.order_date ? new Date(po.order_date).toLocaleDateString() : new Date().toLocaleDateString();\n        const supplierName = po?.suppliers?.name || 'N/A';\n        const supplierPhone = po?.suppliers?.phone || '';\n\n        // Create receipt HTML\n        const receiptHTML = `\n<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"UTF-8\">\n    <title>PO #${poNumber}</title>\n    <style>\n        @media print {\n            @page {\n                size: 80mm auto;\n                margin: 5mm;\n            }\n            body {\n                margin: 0;\n                padding: 0;\n            }\n        }\n        \n        body {\n            font-family: 'Courier New', monospace;\n            width: 80mm;\n            margin: 0 auto;\n            padding: 10px;\n            font-size: 12px;\n        }\n        \n        .header {\n            text-align: center;\n            margin-bottom: 15px;\n            border-bottom: 2px dashed #000;\n            padding-bottom: 10px;\n        }\n       \n        .store-name {\n            font-size: 18px;\n            font-weight: bold;\n            margin-bottom: 5px;\n        }\n        \n        .receipt-title {\n            font-size: 14px;\n            font-weight: bold;\n            margin-bottom: 5px;\n        }\n        \n        .info-row {\n            display: flex;\n            justify-content: space-between;\n            font-size: 11px;\n            margin-bottom: 2px;\n        }\n        \n        .items-table {\n            width: 100%;\n            margin: 10px 0;\n            border-collapse: collapse;\n        }\n        \n        .items-table th {\n            text-align: left;\n            border-bottom: 1px solid #000;\n            padding: 5px 2px;\n            font-size: 10px;\n        }\n        \n        .items-table td {\n            padding: 5px 2px;\n            font-size: 10px;\n            vertical-align: top;\n        }\n        \n        .item-name {\n            max-width: 40mm;\n            word-wrap: break-word;\n        }\n        \n        .text-center {\n            text-align: center;\n        }\n        \n        .text-right {\n            text-align: right;\n        }\n        \n        .footer {\n            text-align: center;\n            margin-top: 15px;\n            padding-top: 10px;\n            border-top: 2px dashed #000;\n            font-size: 10px;\n            color: #555;\n        }\n        \n        .branding {\n            margin-top: 10px;\n            font-size: 9px;\n            color: #888;\n            font-style: italic;\n        }\n\n        .notes {\n            margin-top: 10px;\n            border-top: 1px dashed #000;\n            padding-top: 5px;\n            font-size: 11px;\n        }\n    </style>\n</head>\n<body>\n    <div class=\"header\">\n        <div class=\"store-name\">${storeName}</div>\n        ${settings?.address ? `<div style=\"font-size: 10px;\">${settings.address}</div>` : ''}\n        ${settings?.phone ? `<div style=\"font-size: 10px;\">Phone: ${settings.phone}</div>` : ''}\n        <div class=\"receipt-title\" style=\"margin-top: 10px;\">PURCHASE ORDER</div>\n    </div>\n\n    <div class=\"info-row\">\n        <span>PO #:</span>\n        <span>${poNumber}</span>\n    </div>\n    <div class=\"info-row\">\n        <span>Date:</span>\n        <span>${orderDate}</span>\n    </div>\n    <div class=\"info-row\">\n        <span>Supplier:</span>\n        <span>${supplierName}</span>\n    </div>\n    ${supplierPhone ? `\n    <div class=\"info-row\">\n        <span>Supplier Ph:</span>\n        <span>${supplierPhone}</span>\n    </div>` : ''}\n    \n    <table class=\"items-table\">\n        <thead>\n            <tr>\n                <th>Item</th>\n                <th class=\"text-right\">Qty (Boxes)</th>\n            </tr>\n        </thead>\n        <tbody>\n            ${items.map(item => {\n            // Handle both data formats safely\n            let productName = 'N/A';\n            if (item.product_name) productName = item.product_name;\n            else if (item.products?.name) productName = item.products.name;\n\n            const quantity = item.quantity_ordered || 0;\n\n            return `\n                <tr>\n                    <td class=\"item-name\">${productName}</td>\n                    <td class=\"text-right\">${quantity}</td>\n                </tr>\n                `;\n        }).join('')}\n        </tbody>\n    </table>\n    \n    ${po.notes ? `\n    <div class=\"notes\">\n        <strong>Notes:</strong><br/>\n        ${po.notes}\n    </div>\n    ` : ''}\n    \n    <div class=\"footer\">\n        ${settings?.footer_text || 'Thank you for your service!'}\n        <div class=\"branding\">\n            \n        </div>\n    </div>\n    \n    <script>\n        // Auto-close window after printing or canceling\n        window.onafterprint = function() {\n            window.close();\n        };\n        \n        // Trigger print dialog immediately\n        window.onload = function() {\n            window.print();\n        };\n    </script>\n</body>\n</html>\n        `;\n\n        // Open in new window and print\n        const printWindow = window.open('', '_blank', 'width=400,height=600');\n        if (printWindow) {\n            printWindow.document.write(receiptHTML);\n            printWindow.document.close();\n            return true;\n        } else {\n            console.error('Could not open print window. Popup blocked?');\n            return false;\n        }\n    } catch (error) {\n        console.error('PO printing failed:', error);\n        return false;\n    }\n};\n","import React from 'react';\nimport {\n    Dialog,\n    DialogTitle,\n    DialogContent,\n    DialogActions,\n    Button,\n    Box,\n    Typography,\n    IconButton,\n    Divider,\n    useTheme,\n    useMediaQuery,\n    Paper,\n    Table,\n    TableBody,\n    TableRow,\n    TableCell,\n    TableHead,\n    TableContainer,\n} from '@mui/material';\nimport {\n    Close,\n    Download,\n    Print,\n    WhatsApp,\n    Share,\n    CheckCircle,\n} from '@mui/icons-material';\nimport { toast } from 'react-toastify';\nimport { generatePOPDF } from '../../utils/poPdfGenerator';\nimport { openWhatsApp } from '../../utils/whatsappHelper';\nimport { printPO } from '../../utils/printPO';\nimport html2canvas from 'html2canvas';\n\nexport default function POReceiptModal({ open, onClose, purchaseOrder, poItems, supplier, settings }) {\n    const theme = useTheme();\n    const isMobile = useMediaQuery(theme.breakpoints.down('sm'));\n\n    // Return null if no data\n    if (!purchaseOrder || !poItems || !supplier) {\n        return null;\n    }\n\n    const handleDownloadPDF = async () => {\n        try {\n            const pdfBlob = await generatePOPDF(purchaseOrder, poItems, settings);\n            const url = URL.createObjectURL(pdfBlob);\n            const link = document.createElement('a');\n            link.href = url;\n            link.download = `${purchaseOrder.po_number}.pdf`;\n            link.click();\n            URL.revokeObjectURL(url);\n            toast.success('PDF downloaded!');\n        } catch (error) {\n            console.error('Error generating PDF:', error);\n            toast.error('Failed to generate PDF: ' + error.message);\n        }\n    };\n\n    const handlePrint = () => {\n        const success = printPO(purchaseOrder, poItems, settings);\n        if (!success) {\n            toast.error('Failed to open print window. Please allow popups.');\n        }\n    };\n\n    const handleShare = async () => {\n        try {\n            const message = `Purchase Order: ${purchaseOrder.po_number}\\n\\nSupplier: ${supplier?.name}\\nDate: ${new Date(purchaseOrder.order_date).toLocaleDateString()}\\n\\nItems:\\n${poItems.map(item => `- ${item.product_name} x${item.quantity_ordered}`).join('\\n')}`;\n\n            if (navigator.share) {\n                await navigator.share({\n                    title: `PO ${purchaseOrder.po_number}`,\n                    text: message,\n                });\n            } else {\n                // Fallback to copy\n                await navigator.clipboard.writeText(message);\n                toast.success('Order details copied to clipboard!');\n            }\n        } catch (error) {\n            console.error('Error sharing:', error);\n        }\n    };\n\n    const handleGenerateImage = async () => {\n        try {\n            const element = document.getElementById('po-receipt-content');\n            if (!element) return null;\n\n            const canvas = await html2canvas(element, {\n                scale: 2,\n                backgroundColor: '#ffffff',\n                logging: false,\n            });\n\n            return new Promise((resolve) => {\n                canvas.toBlob((blob) => {\n                    resolve(blob);\n                }, 'image/png');\n            });\n        } catch (error) {\n            console.error('Error generating image:', error);\n            return null;\n        }\n    };\n\n    const handleWhatsApp = async () => {\n        const phone = supplier?.phone || supplier?.supplier_contacts?.find(c => c.is_primary)?.phone;\n        if (!phone) {\n            toast.error('No phone number found for supplier');\n            return;\n        }\n\n        const loadingToast = toast.loading('Generating receipt image...');\n\n        try {\n            const imageBlob = await handleGenerateImage();\n            if (!imageBlob) {\n                throw new Error('Failed to generate image');\n            }\n\n            const imageFile = new File(\n                [imageBlob],\n                `PO-${purchaseOrder.po_number}.png`,\n                { type: 'image/png' }\n            );\n\n            // Mobile: Use Web Share API for seamless sharing\n            if (navigator.share && navigator.canShare && navigator.canShare({ files: [imageFile] })) {\n                toast.update(loadingToast, {\n                    render: 'Opening share menu...',\n                    type: 'info',\n                    isLoading: false,\n                    autoClose: 2000\n                });\n\n                await navigator.share({\n                    title: `PO ${purchaseOrder.po_number}`,\n                    text: `Purchase Order: ${purchaseOrder.po_number}\\n\\nPlease find the order details in the attached image.\\n\\nThank you!`,\n                    files: [imageFile]\n                });\n\n                toast.success('Shared successfully!');\n            } else {\n                // Desktop: Download and open WhatsApp Web\n                const url = URL.createObjectURL(imageBlob);\n                const link = document.createElement('a');\n                link.href = url;\n                link.download = `PO-${purchaseOrder.po_number}.png`;\n                link.click();\n                URL.revokeObjectURL(url);\n\n                toast.update(loadingToast, {\n                    render: 'Image downloaded! Opening WhatsApp - please attach it.',\n                    type: 'success',\n                    isLoading: false,\n                    autoClose: 5000\n                });\n\n                const message = `Purchase Order: ${purchaseOrder.po_number}\\n\\nPlease find the order details in the downloaded image file.\\n\\nThank you!`;\n\n                setTimeout(() => {\n                    openWhatsApp(phone, message);\n                }, 1000);\n            }\n        } catch (e) {\n            console.error('Error handling WhatsApp share:', e);\n\n            if (e.name === 'AbortError') {\n                toast.dismiss(loadingToast);\n                return;\n            }\n\n            toast.update(loadingToast, {\n                render: 'Failed to share. Opening WhatsApp with text only.',\n                type: 'warning',\n                isLoading: false,\n                autoClose: 3000\n            });\n\n            const message = `Purchase Order: ${purchaseOrder.po_number}\\n\\nItems:\\n${poItems.map(item => `- ${item.product_name} x${item.quantity_ordered}`).join('\\n')}\\n\\nPlease confirm availability.`;\n            openWhatsApp(phone, message);\n        }\n    };\n\n    return (\n        <Dialog open={open} onClose={onClose} maxWidth=\"sm\" fullWidth>\n            <DialogTitle>\n                <Box display=\"flex\" justifyContent=\"space-between\" alignItems=\"center\">\n                    <Box display=\"flex\" alignItems=\"center\" gap={1}>\n                        <CheckCircle color=\"success\" />\n                        <Typography variant=\"h6\">Purchase Order Created!</Typography>\n                    </Box>\n                    <IconButton onClick={onClose} size=\"small\">\n                        <Close />\n                    </IconButton>\n                </Box>\n            </DialogTitle>\n\n            <DialogContent>\n                {/* Professional Receipt Card */}\n                <Paper\n                    id=\"po-receipt-content\"\n                    elevation={3}\n                    sx={{ p: 3, bgcolor: 'grey.50', border: '1px solid', borderColor: 'grey.300' }}\n                >\n                    {/* Header */}\n                    <Box textAlign=\"center\" mb={2}>\n                        <Typography variant=\"h5\" fontWeight={700} color=\"primary\" gutterBottom>\n                            {settings?.store_name || 'Medical Store'}\n                        </Typography>\n                        {settings?.address && (\n                            <Typography variant=\"body2\" color=\"text.secondary\">\n                                {settings.address}\n                            </Typography>\n                        )}\n                        {settings?.phone && (\n                            <Typography variant=\"body2\" color=\"text.secondary\">\n                                Phone: {settings.phone}\n                            </Typography>\n                        )}\n                        {settings?.owner_name && (\n                            <Typography variant=\"body2\" color=\"text.secondary\">\n                                Owner: {settings.owner_name}\n                            </Typography>\n                        )}\n                    </Box>\n\n                    <Divider sx={{ my: 2, borderColor: 'primary.main', borderWidth: 1 }} />\n\n                    {/* PO Title */}\n                    <Box textAlign=\"center\" my={2}>\n                        <Typography variant=\"h6\" fontWeight={700} color=\"text.primary\">\n                            PURCHASE ORDER\n                        </Typography>\n                        <Typography variant=\"h4\" fontWeight={700} color=\"primary\" mt={1}>\n                            {purchaseOrder.po_number}\n                        </Typography>\n                    </Box>\n\n                    <Divider sx={{ my: 2 }} />\n\n                    {/* Details Table */}\n                    <Table size=\"small\">\n                        <TableBody>\n                            <TableRow>\n                                <TableCell sx={{ fontWeight: 600, border: 'none', py: 0.5 }}>Date:</TableCell>\n                                <TableCell sx={{ border: 'none', py: 0.5 }}>\n                                    {new Date(purchaseOrder.order_date).toLocaleDateString()}\n                                </TableCell>\n                            </TableRow>\n                            <TableRow>\n                                <TableCell sx={{ fontWeight: 600, border: 'none', py: 0.5 }}>Supplier:</TableCell>\n                                <TableCell sx={{ border: 'none', py: 0.5 }}>{supplier?.name}</TableCell>\n                            </TableRow>\n                            {supplier?.phone && (\n                                <TableRow>\n                                    <TableCell sx={{ fontWeight: 600, border: 'none', py: 0.5 }}>Supplier Phone:</TableCell>\n                                    <TableCell sx={{ border: 'none', py: 0.5 }}>{supplier.phone}</TableCell>\n                                </TableRow>\n                            )}\n                        </TableBody>\n                    </Table>\n\n                    <Divider sx={{ my: 2 }} />\n\n                    {/* Items with Headers */}\n                    <Box mb={2}>\n                        <Typography variant=\"subtitle2\" fontWeight={700} color=\"text.secondary\" gutterBottom>\n                            Items Ordered:\n                        </Typography>\n                        <TableContainer sx={{ bgcolor: 'white', borderRadius: 1, border: '1px solid', borderColor: 'grey.300' }}>\n                            <Table size=\"small\">\n                                <TableHead>\n                                    <TableRow sx={{ bgcolor: 'grey.100' }}>\n                                        <TableCell sx={{ fontWeight: 700 }}>Product</TableCell>\n                                        <TableCell align=\"right\" sx={{ fontWeight: 700 }}>Quantity</TableCell>\n                                    </TableRow>\n                                </TableHead>\n                                <TableBody>\n                                    {poItems.map((item, index) => (\n                                        <TableRow key={index} hover>\n                                            <TableCell>{item.product_name}</TableCell>\n                                            <TableCell align=\"right\">\n                                                <strong>\n                                                    {item.boxes_ordered\n                                                        ? `${item.boxes_ordered} Boxes (${item.quantity_ordered} items)`\n                                                        : `${item.quantity_ordered} items`\n                                                    }\n                                                </strong>\n                                            </TableCell>\n                                        </TableRow>\n                                    ))}\n                                </TableBody>\n                            </Table>\n                        </TableContainer>\n                    </Box>\n\n                    {/* Notes */}\n                    {purchaseOrder.notes && (\n                        <Box mb={2}>\n                            <Typography variant=\"subtitle2\" fontWeight={700} color=\"text.secondary\" gutterBottom>\n                                Notes:\n                            </Typography>\n                            <Box sx={{ bgcolor: 'info.lighter', p: 1.5, borderRadius: 1, border: '1px dashed', borderColor: 'info.main' }}>\n                                <Typography variant=\"body2\">{purchaseOrder.notes}</Typography>\n                            </Box>\n                        </Box>\n                    )}\n\n                    <Divider sx={{ my: 2 }} />\n\n                    {/* Signature Area */}\n                    <Box mt={3}>\n                        <Typography variant=\"caption\" color=\"text.secondary\" display=\"block\" gutterBottom>\n                            Digital Signature:\n                        </Typography>\n                        <Box\n                            sx={{\n                                border: '2px dashed',\n                                borderColor: 'grey.400',\n                                borderRadius: 1,\n                                p: 2,\n                                textAlign: 'center',\n                                bgcolor: 'grey.100'\n                            }}\n                        >\n                            <Typography variant=\"body2\" color=\"text.secondary\" fontStyle=\"italic\">\n                                Authorized by: {settings?.owner_name || 'Store Owner'}\n                            </Typography>\n                            <Typography variant=\"caption\" color=\"text.secondary\">\n                                {new Date().toLocaleString()}\n                            </Typography>\n                        </Box>\n                    </Box>\n\n                    {/* Footer */}\n                    {settings?.footer_text && (\n                        <Box mt={2} textAlign=\"center\">\n                            <Typography variant=\"caption\" color=\"text.secondary\" fontStyle=\"italic\">\n                                {settings.footer_text}\n                            </Typography>\n                        </Box>\n                    )}\n\n                    {/* Branding */}\n                    <Box mt={2} textAlign=\"center\" pt={2} borderTop=\"1px dashed #ccc\">\n                        <Typography variant=\"caption\" color=\"text.secondary\" fontStyle=\"italic\">\n                            Receipt designed and generated by <strong>MedixFlow</strong>\n                        </Typography>\n                        <Typography variant=\"caption\" display=\"block\" color=\"text.secondary\">\n                            Contact: +923089020131\n                        </Typography>\n                    </Box>\n                </Paper>\n            </DialogContent>\n\n            <DialogActions sx={{ p: 2, flexDirection: 'column', gap: 1, bgcolor: 'grey.50' }}>\n                <Box display=\"flex\" gap={1} width=\"100%\" flexWrap=\"wrap\" justifyContent=\"center\">\n                    <Button\n                        variant=\"contained\"\n                        startIcon={<WhatsApp />}\n                        onClick={handleWhatsApp}\n                        fullWidth={isMobile}\n                        sx={{ bgcolor: '#25D366', '&:hover': { bgcolor: '#1fb855' } }}\n                    >\n                        Send via WhatsApp\n                    </Button>\n                    <Button\n                        variant=\"outlined\"\n                        startIcon={<Download />}\n                        onClick={handleDownloadPDF}\n                        fullWidth={isMobile}\n                    >\n                        Download PDF\n                    </Button>\n                </Box>\n                <Box display=\"flex\" gap={1} width=\"100%\" flexWrap=\"wrap\" justifyContent=\"center\">\n                    <Button\n                        variant=\"outlined\"\n                        startIcon={<Print />}\n                        onClick={handlePrint}\n                        fullWidth={isMobile}\n                    >\n                        Print\n                    </Button>\n                    <Button\n                        variant=\"outlined\"\n                        startIcon={<Share />}\n                        onClick={handleShare}\n                        fullWidth={isMobile}\n                    >\n                        Share\n                    </Button>\n                </Box>\n                <Button onClick={onClose} fullWidth variant=\"text\" sx={{ mt: 1 }}>\n                    Close\n                </Button>\n            </DialogActions>\n        </Dialog>\n    );\n}\n","import React, { useState, useEffect, useRef } from 'react';\nimport {\n    Container,\n    Card,\n    CardContent,\n    Typography,\n    Button,\n    Table,\n    TableBody,\n    TableCell,\n    TableContainer,\n    TableHead,\n    TableRow,\n    Box,\n    Chip,\n    TextField,\n    InputAdornment,\n    MenuItem,\n    IconButton,\n    Tooltip,\n    useTheme,\n    useMediaQuery,\n    TablePagination,\n} from '@mui/material';\nimport {\n    Add,\n    Search,\n    Visibility,\n    Edit,\n    Send,\n    CheckCircle,\n    Cancel,\n    LocalShipping,\n    PendingActions,\n    Delete,\n    Keyboard,\n} from '@mui/icons-material';\nimport { toast } from 'react-toastify';\nimport { supabase } from '../../supabaseClient';\nimport { formatCurrency } from '../../utils/formatters';\nimport CreateEditPODialog from './CreateEditPODialog';\nimport PODetailDialog from './PODetailDialog';\nimport POReceiptModal from './POReceiptModal';\nimport useSettings from '../../hooks/useSettings';\nimport useKeyboardShortcuts from '../../hooks/useKeyboardShortcuts';\nimport { useKeyboard } from '../../contexts/KeyboardContext';\n\nexport default function PurchaseOrdersPage() {\n    const { settings } = useSettings();\n    const { toggleHelp } = useKeyboard();\n    const theme = useTheme();\n    const isMobile = useMediaQuery(theme.breakpoints.down('sm'));\n\n    const [purchaseOrders, setPurchaseOrders] = useState([]);\n    const [suppliers, setSuppliers] = useState([]);\n    const [loading, setLoading] = useState(true);\n\n    // Filter states\n    const [searchQuery, setSearchQuery] = useState('');\n    const [statusFilter, setStatusFilter] = useState('all');\n    const [supplierFilter, setSupplierFilter] = useState('all');\n\n    // Pagination states\n    const [page, setPage] = useState(0);\n    const [rowsPerPage, setRowsPerPage] = useState(25);\n    const [totalCount, setTotalCount] = useState(0);\n\n    // Dialog states\n    const [createDialogOpen, setCreateDialogOpen] = useState(false);\n    const [detailDialogOpen, setDetailDialogOpen] = useState(false);\n    const [selectedPO, setSelectedPO] = useState(null);\n    const [receiptModalOpen, setReceiptModalOpen] = useState(false);\n    const [receiptData, setReceiptData] = useState({ po: null, items: [], supplier: null });\n\n    const searchInputRef = useRef(null);\n\n    useKeyboardShortcuts({\n        'Alt+n': () => handleCreateNew(),\n        'Alt+f': () => searchInputRef.current?.focus(),\n    }, 'Purchase Orders Page');\n\n    useEffect(() => {\n        fetchPurchaseOrders();\n        fetchSuppliers();\n    }, []);\n\n    useEffect(() => {\n        const delayDebounceFn = setTimeout(() => {\n            fetchPurchaseOrders();\n        }, 500);\n\n        return () => clearTimeout(delayDebounceFn);\n    }, [searchQuery, statusFilter, supplierFilter, page, rowsPerPage]);\n\n    useEffect(() => {\n        fetchSuppliers();\n    }, []);\n\n    const fetchPurchaseOrders = async () => {\n        setLoading(true);\n        try {\n            const { data: { session } } = await supabase.auth.getSession();\n            if (!session) return;\n\n            let query = supabase\n                .from('purchase_orders')\n                .select(`\n                    *,\n                    suppliers(name, phone, supplier_contacts(*))\n                `, { count: 'exact' })\n                .eq('organization_id', session.user.id)\n                .is('deleted_at', null)\n                .order('created_at', { ascending: false });\n\n            // Apply filters\n            if (searchQuery) {\n                query = query.ilike('po_number', `%${searchQuery}%`);\n            }\n\n            if (statusFilter !== 'all') {\n                query = query.eq('status', statusFilter);\n            }\n\n            if (supplierFilter !== 'all') {\n                query = query.eq('supplier_id', supplierFilter);\n            }\n\n            const from = page * rowsPerPage;\n            const to = from + rowsPerPage - 1;\n\n            const { data, count, error } = await query.range(from, to);\n\n            if (error) throw error;\n            setPurchaseOrders(data || []);\n            setTotalCount(count || 0);\n        } catch (error) {\n            console.error('Error fetching POs:', error);\n            toast.error('Failed to load purchase orders');\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const fetchSuppliers = async () => {\n        const { data: { session } } = await supabase.auth.getSession();\n        if (!session) return;\n\n        const { data, error } = await supabase\n            .from('suppliers')\n            .select('*, supplier_contacts(*)')\n            .eq('organization_id', session.user.id)\n            .is('deleted_at', null)\n            .order('name');\n\n        if (error) {\n            console.error('Error fetching suppliers:', error);\n        } else {\n            setSuppliers(data || []);\n        }\n    };\n\n    const handleChangePage = (event, newPage) => {\n        setPage(newPage);\n    };\n\n    const handleChangeRowsPerPage = (event) => {\n        setRowsPerPage(parseInt(event.target.value, 10));\n        setPage(0);\n    };\n\n    const getStatusColor = (status) => {\n        const colors = {\n            draft: 'default',\n            sent: 'primary',\n            partially_received: 'secondary',\n            received: 'success',\n        };\n        return colors[status] || 'default';\n    };\n\n    const getStatusIcon = (status) => {\n        const icons = {\n            draft: <Edit fontSize=\"small\" />,\n            sent: <Send fontSize=\"small\" />,\n            partially_received: <LocalShipping fontSize=\"small\" />,\n            received: <CheckCircle fontSize=\"small\" />,\n        };\n        return icons[status];\n    };\n\n    const getStatusLabel = (status) => {\n        const labels = {\n            draft: 'Draft',\n            sent: 'Sent',\n            partially_received: 'Receiving',\n            received: 'Completed',\n        };\n        return labels[status] || status;\n    };\n\n    const handleViewDetails = (po) => {\n        setSelectedPO(po);\n        setDetailDialogOpen(true);\n    };\n\n    const handleEdit = (po) => {\n        setSelectedPO(po);\n        setCreateDialogOpen(true);\n    };\n\n    const handleCreateNew = () => {\n        setSelectedPO(null);\n        setCreateDialogOpen(true);\n    };\n\n    const handleDialogClose = (newPO, items, supplier) => {\n        setCreateDialogOpen(false);\n\n        // If PO was created (not edited), show receipt modal\n        if (newPO && items && supplier) {\n            setReceiptData({ po: newPO, items, supplier });\n            setReceiptModalOpen(true);\n        }\n\n        setSelectedPO(null);\n        fetchPurchaseOrders();\n    };\n\n    const handleDelete = async (po) => {\n        if (!window.confirm(`Are you sure you want to delete PO ${po.po_number}?`)) {\n            return;\n        }\n\n        try {\n            const { error } = await supabase\n                .from('purchase_orders')\n                .update({ deleted_at: new Date().toISOString() })\n                .eq('id', po.id);\n\n            if (error) throw error;\n\n            toast.success('Purchase order deleted!');\n            fetchPurchaseOrders();\n        } catch (error) {\n            console.error('Error deleting PO:', error);\n            toast.error('Failed to delete purchase order');\n        }\n    };\n\n    return (\n        <Container maxWidth=\"xl\">\n            <Box\n                display=\"flex\"\n                flexDirection={isMobile ? 'column' : 'row'}\n                justifyContent=\"space-between\"\n                alignItems={isMobile ? 'flex-start' : 'center'}\n                gap={2}\n                mb={3}\n            >\n                <Typography variant=\"h4\" fontWeight={700} color=\"primary\">\n                    Purchase Orders\n                </Typography>\n                <Box display=\"flex\" gap={1}>\n                    <Button\n                        variant=\"outlined\"\n                        startIcon={<Keyboard />}\n                        onClick={toggleHelp}\n                        size={isMobile ? 'small' : 'medium'}\n                    >\n                        Shortcuts\n                    </Button>\n                    <Button\n                        variant=\"contained\"\n                        startIcon={<Add />}\n                        onClick={handleCreateNew}\n                        fullWidth={isMobile}\n                    >\n                        New Purchase Order (Alt+n)\n                    </Button>\n                </Box>\n            </Box>\n\n            {/* Filters */}\n            <Card sx={{ mb: 3 }}>\n                <CardContent>\n                    <Box display=\"flex\" gap={2} flexWrap=\"wrap\">\n                        <TextField\n                            label=\"Search PO (Alt+f)\"\n                            inputRef={searchInputRef}\n                            value={searchQuery}\n                            onChange={(e) => setSearchQuery(e.target.value)}\n                            size=\"small\"\n                            sx={{ minWidth: 250 }}\n                            InputProps={{\n                                startAdornment: (\n                                    <InputAdornment position=\"start\">\n                                        <Search />\n                                    </InputAdornment>\n                                ),\n                            }}\n                        />\n                        <TextField\n                            select\n                            label=\"Status\"\n                            value={statusFilter}\n                            onChange={(e) => setStatusFilter(e.target.value)}\n                            size=\"small\"\n                            sx={{ minWidth: 150 }}\n                        >\n                            <MenuItem value=\"all\">All Status</MenuItem>\n                            <MenuItem value=\"draft\">Draft</MenuItem>\n                            <MenuItem value=\"sent\">Sent</MenuItem>\n                            <MenuItem value=\"partially_received\">Receiving</MenuItem>\n                            <MenuItem value=\"received\">Completed</MenuItem>\n                        </TextField>\n                        <TextField\n                            select\n                            label=\"Supplier\"\n                            value={supplierFilter}\n                            onChange={(e) => setSupplierFilter(e.target.value)}\n                            size=\"small\"\n                            sx={{ minWidth: 200 }}\n                        >\n                            <MenuItem value=\"all\">All Suppliers</MenuItem>\n                            {suppliers.map((supplier) => (\n                                <MenuItem key={supplier.id} value={supplier.id}>\n                                    {supplier.name}\n                                </MenuItem>\n                            ))}\n                        </TextField>\n                    </Box>\n                </CardContent>\n            </Card>\n\n            {/* Purchase Orders Table */}\n            <Card>\n                <TableContainer sx={{ overflowX: 'auto', maxWidth: '100%' }}>\n                    <Table sx={{ minWidth: 900 }}>\n                        <TableHead>\n                            <TableRow>\n                                <TableCell><strong>PO Number</strong></TableCell>\n                                <TableCell><strong>Supplier</strong></TableCell>\n                                <TableCell><strong>Order Date</strong></TableCell>\n                                <TableCell><strong>Status</strong></TableCell>\n                                <TableCell align=\"right\"><strong>Total Amount</strong></TableCell>\n                                <TableCell align=\"right\"><strong>Actions</strong></TableCell>\n                            </TableRow>\n                        </TableHead>\n                        <TableBody>\n                            {loading ? (\n                                <TableRow>\n                                    <TableCell colSpan={6} align=\"center\">Loading...</TableCell>\n                                </TableRow>\n                            ) : purchaseOrders.length === 0 ? (\n                                <TableRow>\n                                    <TableCell colSpan={6} align=\"center\">\n                                        No purchase orders found\n                                    </TableCell>\n                                </TableRow>\n                            ) : (\n                                purchaseOrders.map((po) => (\n                                    <TableRow key={po.id} hover>\n                                        <TableCell>\n                                            <Typography variant=\"body2\" fontWeight={600}>\n                                                {po.po_number}\n                                            </Typography>\n                                        </TableCell>\n                                        <TableCell>{po.suppliers?.name || ''}</TableCell>\n                                        <TableCell>\n                                            {new Date(po.order_date).toLocaleDateString()}\n                                        </TableCell>\n                                        <TableCell>\n                                            <Chip\n                                                icon={getStatusIcon(po.status)}\n                                                label={getStatusLabel(po.status)}\n                                                color={getStatusColor(po.status)}\n                                                size=\"small\"\n                                            />\n                                        </TableCell>\n                                        <TableCell align=\"right\">\n                                            <Typography variant=\"body2\" fontWeight={600}>\n                                                {settings?.currency_symbol || 'Rs'}\n                                                {formatCurrency(po.final_amount || po.total_amount, '')}\n                                            </Typography>\n                                        </TableCell>\n                                        <TableCell align=\"right\">\n                                            <Box display=\"flex\" gap={1} justifyContent=\"flex-end\">\n                                                <Tooltip title=\"View Details\">\n                                                    <IconButton\n                                                        size=\"small\"\n                                                        color=\"primary\"\n                                                        onClick={() => handleViewDetails(po)}\n                                                    >\n                                                        <Visibility fontSize=\"small\" />\n                                                    </IconButton>\n                                                </Tooltip>\n                                                {po.status === 'draft' && (\n                                                    <>\n                                                        <Tooltip title=\"Edit\">\n                                                            <IconButton\n                                                                size=\"small\"\n                                                                color=\"secondary\"\n                                                                onClick={() => handleEdit(po)}\n                                                            >\n                                                                <Edit fontSize=\"small\" />\n                                                            </IconButton>\n                                                        </Tooltip>\n                                                        <Tooltip title=\"Delete\">\n                                                            <IconButton\n                                                                size=\"small\"\n                                                                color=\"error\"\n                                                                onClick={() => handleDelete(po)}\n                                                            >\n                                                                <Delete fontSize=\"small\" />\n                                                            </IconButton>\n                                                        </Tooltip>\n                                                    </>\n                                                )}\n                                            </Box>\n                                        </TableCell>\n                                    </TableRow>\n                                ))\n                            )}\n                        </TableBody>\n                    </Table>\n                </TableContainer>\n            </Card>\n\n            <TablePagination\n                rowsPerPageOptions={[10, 25, 50, 100]}\n                component=\"div\"\n                count={totalCount}\n                rowsPerPage={rowsPerPage}\n                page={page}\n                onPageChange={handleChangePage}\n                onRowsPerPageChange={handleChangeRowsPerPage}\n            />\n\n            {/* Dialogs */}\n            <CreateEditPODialog\n                open={createDialogOpen}\n                onClose={handleDialogClose}\n                purchaseOrder={selectedPO}\n                suppliers={suppliers}\n            />\n\n            <PODetailDialog\n                open={detailDialogOpen}\n                onClose={() => setDetailDialogOpen(false)}\n                purchaseOrder={selectedPO}\n                onRefresh={fetchPurchaseOrders}\n            />\n\n            <POReceiptModal\n                open={receiptModalOpen}\n                onClose={() => setReceiptModalOpen(false)}\n                purchaseOrder={receiptData.po}\n                poItems={receiptData.items}\n                supplier={receiptData.supplier}\n                settings={settings}\n            />\n        </Container>\n    );\n}\n","\"use client\";\n\nimport createSvgIcon from './utils/createSvgIcon';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nexport default createSvgIcon( /*#__PURE__*/_jsx(\"path\", {\n  d: \"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z\"\n}), 'Add');","\"use client\";\n\nimport createSvgIcon from './utils/createSvgIcon';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nexport default createSvgIcon( /*#__PURE__*/_jsx(\"path\", {\n  d: \"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z\"\n}), 'Edit');","/**\n * Generates a WhatsApp URL for ordering a product\n * @param {string} phone - Supplier's phone number\n * @param {string} productName - Name of the product\n * @param {number} currentStock - Current stock level\n * @param {string} storeName - Name of the medical store (optional)\n * @returns {string|null} - WhatsApp URL or null if no phone provided\n */\nexport const generateWhatsAppLink = (phone, productName, currentStock, storeName = 'Medical Store') => {\n    if (!phone) return null;\n\n    // Remove non-numeric characters from phone\n    const cleanPhone = phone.replace(/\\D/g, '');\n\n    const message = `Hi, this is ${storeName}. We need to order \"${productName}\". Current stock is ${currentStock}. Please let us know availability and price.`;\n\n    const encodedMessage = encodeURIComponent(message);\n\n    return `https://wa.me/${cleanPhone}?text=${encodedMessage}`;\n};\n\n/**\n * Opens WhatsApp in a new tab\n * @param {string} phone - Supplier's phone number\n * @param {string} productName - Name of the product\n * @param {number} currentStock - Current stock level\n * @param {string} storeName - Name of the medical store\n */\nexport const openWhatsAppOrder = (phone, productName, currentStock, storeName) => {\n    const url = generateWhatsAppLink(phone, productName, currentStock, storeName);\n    if (url) {\n        window.open(url, '_blank');\n    } else {\n        alert('Supplier phone number is missing!');\n    }\n};\n\n/**\n * Opens WhatsApp with a custom message\n * @param {string} phone - Phone number\n * @param {string} message - Message to send\n */\nexport const openWhatsApp = (phone, message) => {\n    if (!phone) {\n        alert('Phone number is missing!');\n        return;\n    }\n\n    // Remove non-numeric characters from phone\n    const cleanPhone = phone.replace(/\\D/g, '');\n    const encodedMessage = encodeURIComponent(message);\n    const url = `https://wa.me/${cleanPhone}?text=${encodedMessage}`;\n\n    window.open(url, '_blank');\n};\n\n","\"use client\";\n\nimport createSvgIcon from './utils/createSvgIcon';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nexport default createSvgIcon( /*#__PURE__*/_jsx(\"path\", {\n  d: \"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8z\"\n}), 'CheckCircle');"],"names":["createSvgIcon","_jsx","d","formatCurrency","value","symbol","arguments","length","undefined","isNaN","concat","num","Number","toLocaleString","minimumFractionDigits","maximumFractionDigits","formatNumber","formatPercentage","decimals","toFixed","CreateEditPODialog","_ref","open","onClose","purchaseOrder","suppliers","isEdit","theme","useTheme","isMobile","useMediaQuery","breakpoints","down","formData","setFormData","useState","supplier_id","order_date","Date","toISOString","split","notes","items","setItems","products","setProducts","loading","setLoading","searchResults","setSearchResults","searching","setSearching","useEffect","fetchProducts","loadPOData","resetForm","async","data","session","supabase","auth","getSession","from","select","eq","user","id","is","order","searchMedicineReference","query","localMatches","filter","p","name","toLowerCase","includes","refData","or","limit","newRefItems","ref","some","brand_name","map","_objectSpread","isReference","items_per_box","standard_packaging","extractItemsPerBox","error","console","packagingString","match","parseInt","item","_item$products","product_id","product_name","quantity_ordered","boxes_ordered","handleChange","e","target","handleAddItem","handleRemoveItem","index","_","i","handleItemChange","field","newItems","product","find","boxes","perBox","handleKeyDown","key","shiftKey","preventDefault","_jsxs","Dialog","maxWidth","fullWidth","children","DialogTitle","Box","display","alignItems","gap","ShoppingCart","color","DialogContent","Grid","container","spacing","sx","mt","xs","sm","TextField","required","label","onChange","supplier","MenuItem","type","InputLabelProps","shrink","Divider","my","justifyContent","mb","Typography","variant","Button","startIcon","Add","onClick","Card","CardContent","fontWeight","IconButton","size","Delete","fontSize","Autocomplete","freeSolo","options","getOptionLabel","option","onInputChange","event","newInputValue","newValue","newVal","newName","newItemsPerBox","now","renderInput","params","placeholder","helperText","renderOption","props","style","marginLeft","generic_name","onKeyDown","inputProps","min","TableContainer","Table","TableHead","TableRow","TableCell","width","TableBody","multiline","rows","bgcolor","borderRadius","DialogActions","toast","Error","poError","update","updated_at","delete","itemsError","insert","Promise","all","finalProductId","newProd","createError","organization_id","price","stock","single","purchase_order_id","unit_price","success","poNumberData","rpc","poNumber","newPO","po_number","currency_id","status","created_by","total_amount","final_amount","itemsWithNames","_products$find","s","message","disabled","ReceiveStockDialog","poItems","receivingData","setReceivingData","receivedDate","setReceivedDate","setNotes","fetchProductDetails","productIds","in","productMap","forEach","po_item_id","quantity_already_received","quantity_received","quantity_remaining","quantity_to_receive","cost_price","selling_price","boxes_received","cost_per_box","total_cost","selling_price_per_box","total_selling_price","handleQuantityChange","newData","parseFloat","totalQty","Math","round","maxReceivable","qty","handlePriceChange","totalItems","totalCost","sellBox","totalToReceive","reduce","sum","totalAmount","LocalShipping","overflowX","maxHeight","stickyHeader","align","Chip","textAlign","step","handleReceiveAll","Inventory","itemsToReceive","stockReceipt","receiptError","quantity","received_date","currentProduct","fetchError","newStock","updateError","price_per_box","poItemError","received_by","stock_receipt_id","every","generatePOPDF","po","settings","_po$suppliers","_po$suppliers2","doc","jsPDF","storeName","store_name","orderDate","toLocaleDateString","supplierName","supplierPhone","phone","Array","isArray","setFontSize","setFont","text","yPos","address","owner_name","setLineWidth","line","infoY","tableColumn","tableRows","productName","toString","autoTable","head","body","startY","headStyles","fillColor","fontStyle","styles","columnStyles","cellWidth","halign","finalY","lastAutoTable","splitText","splitTextToSize","addPage","pageHeight","internal","pageSize","height","setTextColor","footerY","footer_text","output","PODetailDialog","_poDetails$suppliers3","_poDetails$suppliers4","onRefresh","poDetails","setPODetails","setPOItems","receivingHistory","setReceivingHistory","receiveDialogOpen","setReceiveDialogOpen","fetchPODetails","history","historyError","ascending","_Fragment","Close","flexWrap","draft","sent","partially_received","received","getStatusColor","expected_delivery_date","gutterBottom","flex","Tooltip","title","settingsData","pdfBlob","url","URL","createObjectURL","link","document","createElement","href","download","click","revokeObjectURL","Download","Send","_poDetails$suppliers","_poDetails$suppliers$","_poDetails$suppliers2","info","pdfError","warning","sent_at","primaryContact","supplier_contacts","c","is_primary","setTimeout","openWhatsApp","handleReceiveStock","handleReceiveDialogClose","printPO","currency_symbol","receiptHTML","join","printWindow","window","write","close","POReceiptModal","CheckCircle","Paper","elevation","border","borderColor","borderWidth","py","hover","pt","borderTop","flexDirection","WhatsApp","_supplier$supplier_co","_supplier$supplier_co2","loadingToast","imageBlob","element","getElementById","canvas","html2canvas","scale","backgroundColor","logging","resolve","toBlob","blob","handleGenerateImage","imageFile","File","navigator","share","canShare","files","render","isLoading","autoClose","dismiss","Print","handlePrint","Share","clipboard","writeText","PurchaseOrdersPage","useSettings","toggleHelp","useKeyboard","purchaseOrders","setPurchaseOrders","setSuppliers","searchQuery","setSearchQuery","statusFilter","setStatusFilter","supplierFilter","setSupplierFilter","page","setPage","rowsPerPage","setRowsPerPage","totalCount","setTotalCount","createDialogOpen","setCreateDialogOpen","detailDialogOpen","setDetailDialogOpen","selectedPO","setSelectedPO","receiptModalOpen","setReceiptModalOpen","receiptData","setReceiptData","searchInputRef","useRef","useKeyboardShortcuts","Alt+n","handleCreateNew","Alt+f","_searchInputRef$curre","current","focus","fetchPurchaseOrders","fetchSuppliers","delayDebounceFn","clearTimeout","count","ilike","to","range","getStatusLabel","Container","Keyboard","inputRef","minWidth","InputProps","startAdornment","InputAdornment","position","Search","colSpan","icon","Edit","handleViewDetails","Visibility","handleEdit","confirm","deleted_at","handleDelete","TablePagination","rowsPerPageOptions","component","onPageChange","handleChangePage","newPage","onRowsPerPageChange","handleDialogClose","openWhatsAppOrder","currentStock","cleanPhone","replace","encodedMessage","encodeURIComponent","generateWhatsAppLink","alert"],"sourceRoot":""}