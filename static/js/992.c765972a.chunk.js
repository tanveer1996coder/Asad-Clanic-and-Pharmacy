"use strict";(self.webpackChunksupabase_sales_app=self.webpackChunksupabase_sales_app||[]).push([[992],{4992:(e,t,n)=>{n.r(t),n.d(t,{default:()=>M});var r=n(89379),s=n(65043),i=n(19252),a=n(96446),o=n(85865),l=n(77739),c=n(17392),d=n(11906),h=n(68903),u=n(12110),x=n(26494),g=n(5146),j=n(51787),y=n(43845),A=n(79650),m=n(71806),p=n(84882),v=n(28076),f=n(10039),b=n(73460),S=n(19090),_=n(59662),w=n(70579);const L=(0,_.A)((0,w.jsx)("path",{d:"M18 17H6v-2h12zm0-4H6v-2h12zm0-4H6V7h12zM3 22l1.5-1.5L6 22l1.5-1.5L9 22l1.5-1.5L12 22l1.5-1.5L15 22l1.5-1.5L18 22l1.5-1.5L21 22V2l-1.5 1.5L18 2l-1.5 1.5L15 2l-1.5 1.5L12 2l-1.5 1.5L9 2 7.5 3.5 6 2 4.5 3.5 3 2z"}),"Receipt");var C=n(47805),I=n(47968),D=n(79484);const k=(0,_.A)((0,w.jsx)("path",{d:"M10 18h4v-2h-4zM3 6v2h18V6zm3 7h12v-2H6z"}),"FilterList");var z=n(47503),N=n(27001),P=n(12807),q=n(43243),W=n(11737);function M(){const{settings:e}=(0,W.A)(),[t,n]=(0,s.useState)([]),[_,M]=(0,s.useState)(!0),[H,V]=(0,s.useState)(""),[T,E]=(0,s.useState)({start:"",end:""}),[R,U]=(0,s.useState)(0),[O,F]=(0,s.useState)(50),[B,Z]=(0,s.useState)(0),[Y,G]=(0,s.useState)(0),[K,Q]=(0,s.useState)(0);async function X(){M(!0);try{const{data:{session:e}}=await N.N.auth.getSession();if(!e)return;const t=e.user.id;let r=N.N.from("sales").select("*, products(name, form, strength)",{count:"exact"}).eq("organization_id",t).is("deleted_at",null).order("created_at",{ascending:!1});if(T.start){const e=new Date(T.start);e.setHours(0,0,0,0),r=r.gte("created_at",e.toISOString())}if(T.end){const e=new Date(T.end);e.setHours(23,59,59,999),r=r.lte("created_at",e.toISOString())}const s=R*O,i=s+O-1,{data:a,count:o,error:l}=await r.range(s,i);if(l)throw l;let c=a||[];if(H&&a){const e=H.toLowerCase();c=a.filter(t=>{var n,r,s,i;return(null===(n=t.products)||void 0===n||null===(r=n.name)||void 0===r?void 0:r.toLowerCase().includes(e))||(null===(s=t.products)||void 0===s||null===(i=s.form)||void 0===i?void 0:i.toLowerCase().includes(e))||t.id.toLowerCase().includes(e)})}n(c),Z(o||0);const{data:d}=await N.N.from("sales").select("quantity, price_at_sale").eq("organization_id",t).is("deleted_at",null);if(d){const e=d.reduce((e,t)=>e+t.quantity*t.price_at_sale,0),t=d.reduce((e,t)=>e+t.quantity,0);G(e),Q(t)}}catch(e){console.error("Error fetching sales:",e),z.oR.error("Failed to load sales history")}finally{M(!1)}}function J(e){E((0,r.A)((0,r.A)({},T),{},{[e.target.name]:e.target.value}))}(0,s.useEffect)(()=>{const e=setTimeout(()=>{X()},500);return()=>clearTimeout(e)},[H,T,R,O]);return(0,w.jsxs)(i.A,{maxWidth:"xl",children:[(0,w.jsxs)(a.A,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[(0,w.jsxs)(a.A,{display:"flex",alignItems:"center",gap:2,children:[(0,w.jsx)(L,{color:"primary",sx:{fontSize:40}}),(0,w.jsx)(o.A,{variant:"h4",fontWeight:700,color:"primary",children:"Sales History & Audit Log"})]}),(0,w.jsxs)(a.A,{display:"flex",gap:1,children:[(0,w.jsx)(l.A,{title:"Refresh",children:(0,w.jsx)(c.A,{onClick:X,color:"primary",children:(0,w.jsx)(C.A,{})})}),(0,w.jsx)(d.A,{variant:"outlined",startIcon:(0,w.jsx)(I.A,{}),onClick:function(){const e=t.map(e=>{var t,n;return{"Sale ID":e.id,Date:(0,q.Yq)(e.sale_date||e.created_at),Time:(0,q.fU)(e.created_at),Product:(null===(t=e.products)||void 0===t?void 0:t.name)||"\u2014",Category:(null===(n=e.products)||void 0===n?void 0:n.category)||"\u2014",Quantity:e.quantity,Price:e.price_at_sale,Total:e.quantity*e.price_at_sale}}),n=Object.keys(e[0]).join(","),r=e.map(e=>Object.values(e).join(",")).join("\n"),s=new Blob([n+"\n"+r],{type:"text/csv"}),i=window.URL.createObjectURL(s),a=document.createElement("a");a.href=i,a.download="sales-history-".concat((new Date).toISOString().split("T")[0],".csv"),a.click(),z.oR.success("Sales history exported!")},disabled:0===t.length,children:"Export CSV"})]})]}),(0,w.jsxs)(h.Ay,{container:!0,spacing:2,mb:3,children:[(0,w.jsx)(h.Ay,{item:!0,xs:12,sm:4,children:(0,w.jsx)(u.A,{children:(0,w.jsxs)(x.A,{children:[(0,w.jsx)(o.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Total Transactions"}),(0,w.jsx)(o.A,{variant:"h4",fontWeight:700,color:"primary",children:(0,P.ZV)(B)})]})})}),(0,w.jsx)(h.Ay,{item:!0,xs:12,sm:4,children:(0,w.jsx)(u.A,{children:(0,w.jsxs)(x.A,{children:[(0,w.jsx)(o.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Total Revenue"}),(0,w.jsx)(o.A,{variant:"h4",fontWeight:700,color:"success.main",children:(0,P.vv)(Y,e.currency_symbol)})]})})}),(0,w.jsx)(h.Ay,{item:!0,xs:12,sm:4,children:(0,w.jsx)(u.A,{children:(0,w.jsxs)(x.A,{children:[(0,w.jsx)(o.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Items Sold"}),(0,w.jsx)(o.A,{variant:"h4",fontWeight:700,color:"info.main",children:(0,P.ZV)(K)})]})})})]}),(0,w.jsx)(u.A,{sx:{mb:3},children:(0,w.jsx)(x.A,{children:(0,w.jsxs)(h.Ay,{container:!0,spacing:2,alignItems:"center",children:[(0,w.jsx)(h.Ay,{item:!0,xs:12,md:4,children:(0,w.jsx)(g.A,{fullWidth:!0,placeholder:"Search by product, category, or sale ID...",value:H,onChange:e=>V(e.target.value),InputProps:{startAdornment:(0,w.jsx)(j.A,{position:"start",children:(0,w.jsx)(D.A,{})})}})}),(0,w.jsx)(h.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,w.jsx)(g.A,{fullWidth:!0,type:"date",label:"Start Date",name:"start",value:T.start,onChange:J,InputLabelProps:{shrink:!0}})}),(0,w.jsx)(h.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,w.jsx)(g.A,{fullWidth:!0,type:"date",label:"End Date",name:"end",value:T.end,onChange:J,InputLabelProps:{shrink:!0}})}),(0,w.jsx)(h.Ay,{item:!0,xs:12,md:2,children:(0,w.jsx)(d.A,{fullWidth:!0,variant:"outlined",onClick:function(){V(""),E({start:"",end:""}),U(0)},startIcon:(0,w.jsx)(k,{}),children:"Clear Filters"})})]})})}),(0,w.jsx)(u.A,{children:(0,w.jsxs)(x.A,{children:[(0,w.jsxs)(o.A,{variant:"h6",fontWeight:600,mb:2,children:["All Sales Transactions",(0,w.jsx)(y.A,{label:"Showing ".concat(t.length," of ").concat(B),size:"small",color:"primary",sx:{ml:2}})]}),(0,w.jsx)(A.A,{sx:{overflowX:"auto",maxWidth:"100%"},children:(0,w.jsxs)(m.A,{children:[(0,w.jsx)(p.A,{children:(0,w.jsxs)(v.A,{children:[(0,w.jsx)(f.A,{children:(0,w.jsx)("strong",{children:"Date & Time"})}),(0,w.jsx)(f.A,{children:(0,w.jsx)("strong",{children:"Sale ID"})}),(0,w.jsx)(f.A,{children:(0,w.jsx)("strong",{children:"Product"})}),(0,w.jsx)(f.A,{children:(0,w.jsx)("strong",{children:"Category"})}),(0,w.jsx)(f.A,{align:"right",children:(0,w.jsx)("strong",{children:"Unit"})}),(0,w.jsx)(f.A,{align:"right",children:(0,w.jsx)("strong",{children:"Items"})}),(0,w.jsx)(f.A,{align:"right",children:(0,w.jsx)("strong",{children:"Boxes"})}),(0,w.jsx)(f.A,{align:"right",children:(0,w.jsx)("strong",{children:"Unit Price"})}),(0,w.jsx)(f.A,{align:"right",children:(0,w.jsx)("strong",{children:"Total Amount"})})]})}),(0,w.jsx)(b.A,{children:_?(0,w.jsx)(v.A,{children:(0,w.jsx)(f.A,{colSpan:9,align:"center",children:"Loading..."})}):0===t.length?(0,w.jsx)(v.A,{children:(0,w.jsx)(f.A,{colSpan:9,align:"center",children:0===t.length?"No sales recorded yet":"No sales match your filters"})}):t.map(t=>{var n,r;const s="box"===t.selling_unit,i=t.items_per_box||1,a=s?t.quantity:0,c=s?t.quantity*i:t.quantity;return(0,w.jsxs)(v.A,{hover:!0,children:[(0,w.jsxs)(f.A,{children:[(0,w.jsx)(o.A,{variant:"body2",fontWeight:600,children:(0,q.Yq)(t.sale_date||t.created_at)}),(0,w.jsx)(o.A,{variant:"caption",color:"text.secondary",children:(0,q.fU)(t.created_at)})]}),(0,w.jsx)(f.A,{children:(0,w.jsx)(l.A,{title:"Sale ID",children:(0,w.jsxs)(o.A,{variant:"caption",sx:{fontFamily:"monospace"},children:[t.id.substring(0,8),"..."]})})}),(0,w.jsx)(f.A,{children:(0,w.jsx)(o.A,{variant:"body2",fontWeight:600,children:(null===(n=t.products)||void 0===n?void 0:n.name)||"\u2014"})}),(0,w.jsx)(f.A,{children:(null===(r=t.products)||void 0===r?void 0:r.category)&&(0,w.jsx)(y.A,{label:t.products.category,size:"small",variant:"outlined"})}),(0,w.jsx)(f.A,{align:"right",children:(0,w.jsx)(y.A,{label:s?"Box":"Item",size:"small",color:s?"secondary":"primary",variant:"outlined"})}),(0,w.jsx)(f.A,{align:"right",children:(0,w.jsx)(o.A,{variant:"body2",children:(0,P.ZV)(c)})}),(0,w.jsx)(f.A,{align:"right",children:(0,w.jsx)(o.A,{variant:"body2",children:a>0?(0,P.ZV)(a):"\u2014"})}),(0,w.jsx)(f.A,{align:"right",children:(0,w.jsx)(o.A,{variant:"body2",children:(0,P.vv)(t.price_at_sale,e.currency_symbol)})}),(0,w.jsx)(f.A,{align:"right",children:(0,w.jsx)(o.A,{variant:"body2",fontWeight:700,color:"success.main",children:(0,P.vv)(t.quantity*t.price_at_sale,e.currency_symbol)})})]},t.id)})})]})}),(0,w.jsx)(S.A,{rowsPerPageOptions:[25,50,100,200],component:"div",count:B,rowsPerPage:O,page:R,onPageChange:(e,t)=>{U(t)},onRowsPerPageChange:e=>{F(parseInt(e.target.value,10)),U(0)}})]})})]})}},12807:(e,t,n)=>{function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"PKR";if(null===e||void 0===e||isNaN(e))return"".concat(t," 0.00");const n=Number(e);return"".concat(t," ").concat(n.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}))}function s(e){return null===e||void 0===e||isNaN(e)?"0":Number(e).toLocaleString("en-US")}function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return null===e||void 0===e||isNaN(e)?"0%":"".concat(Number(e).toFixed(t),"%")}n.d(t,{Ee:()=>i,ZV:()=>s,vv:()=>r})},43243:(e,t,n)=>{n.d(t,{V0:()=>l,Yq:()=>i,fU:()=>a,go:()=>o,t6:()=>c});var r=n(82125),s=n(98920);function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"MMM dd, yyyy";if(!e)return"\u2014";try{const n="string"===typeof e?(0,s.A)(e):e;return(0,r.A)(n,t)}catch(n){return console.error("Error formatting date:",n),String(e)}}function a(e){if(!e)return"\u2014";try{const t="string"===typeof e?(0,s.A)(e):e;return(0,r.A)(t,"h:mm a")}catch(t){return console.error("Error formatting time:",t),String(e)}}function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:7,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15;const r=function(e){if(!e)return null;try{const t="string"===typeof e?new Date(e):e,n=new Date;n.setHours(0,0,0,0),t.setHours(0,0,0,0);const r=t-n;return Math.ceil(r/864e5)}catch(t){return console.error("Error calculating days until expiry:",t),null}}(e);return null===r?{type:"unknown",color:"default",label:"No expiry date"}:r<0?{type:"expired",color:"error",label:"Expired",days:r}:r<=t?{type:"urgent",color:"error",label:"".concat(r," days left"),days:r}:r<=n?{type:"warning",color:"warning",label:"".concat(r," days left"),days:r}:{type:"ok",color:"success",label:"Good",days:r}}function l(e){return 0===e?{type:"out",color:"error",label:"Out of stock"}:e<=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:10)?{type:"low",color:"warning",label:"Low stock"}:{type:"ok",color:"success",label:"In stock"}}function c(e){const t=new Date;return t.setDate(t.getDate()-e),(0,r.A)(t,"yyyy-MM-dd")}},47805:(e,t,n)=>{n.d(t,{A:()=>i});var r=n(59662),s=n(70579);const i=(0,r.A)((0,s.jsx)("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4z"}),"Refresh")},47968:(e,t,n)=>{n.d(t,{A:()=>i});var r=n(59662),s=n(70579);const i=(0,r.A)((0,s.jsx)("path",{d:"M5 20h14v-2H5zM19 9h-4V3H9v6H5l7 7z"}),"Download")}}]);
//# sourceMappingURL=992.c765972a.chunk.js.map