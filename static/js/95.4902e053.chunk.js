"use strict";(self.webpackChunksupabase_sales_app=self.webpackChunksupabase_sales_app||[]).push([[95],{3900:(t,e,r)=>{r.d(e,{A:()=>l});r(65043);var n=r(59662),s=r(70579);const l=(0,n.A)((0,s.jsx)("path",{d:"M15.41 16.09l-4.58-4.59 4.58-4.59L14 5.5l-6 6 6 6z"}),"KeyboardArrowLeft")},5794:(t,e,r)=>{r.r(e),r.d(e,{default:()=>B});var n=r(89379),s=r(65043),l=r(35475),o=r(19252),i=r(96446),a=r(85865),c=r(11906),d=r(12110),x=r(26494),h=r(68903),u=r(5146),A=r(8939),j=r(24056),y=r(79650),p=r(71806),m=r(84882),g=r(28076),f=r(10039),v=r(73460),_=r(43845),b=r(17673),k=r(47968),w=r(59662),S=r(70579);const L=(0,w.A)((0,S.jsx)("path",{d:"m16 6 2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"}),"TrendingUp");var N=r(67957),C=r(34642),E=r(50108),D=r(88420),W=r(58763),I=r(52185),P=r(6026),M=r(3831),R=(0,D.gu)({chartName:"BarChart",GraphicalChild:W.y,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:I.W},{axisType:"yAxis",AxisComp:P.h}],formatAxisMap:M.pr}),T=r(87734),V=r(86150),Z=r(47503),F=r(27001),U=r(12807),q=r(43243),z=r(11737),K=r(5766),O=r.n(K),H=r(90990),X=r(8649);function B(){const{settings:t}=(0,z.A)(),{toggleHelp:e}=(0,X.d)(),[r]=(0,l.ok)(),[w,D]=(0,s.useState)(0),[M,K]=(0,s.useState)({start:(0,q.t6)(30),end:(new Date).toISOString().split("T")[0]}),[B,G]=(0,s.useState)(!1),[Q,Y]=(0,s.useState)(null),[J,$]=(0,s.useState)(null),[tt,et]=(0,s.useState)([]),[rt,nt]=(0,s.useState)([]),[st,lt]=(0,s.useState)([]);async function ot(){const{data:t}=await F.N.rpc("get_sales_summary",{start_date:M.start,end_date:M.end});Y((null===t||void 0===t?void 0:t[0])||{total_sales:0,total_revenue:0,total_items_sold:0})}async function it(){const{data:t}=await F.N.rpc("get_profit_summary",{start_date:M.start,end_date:M.end});$((null===t||void 0===t?void 0:t[0])||{total_revenue:0,total_cost:0,total_profit:0,profit_margin:0})}async function at(){const{data:e}=await F.N.rpc("get_near_expiry_products",{days_threshold:parseInt(t.expiry_alert_days||"15")});et(e||[])}async function ct(){const{data:t}=await F.N.rpc("get_low_stock_products");nt(t||[])}async function dt(){const{data:t}=await F.N.rpc("get_top_products",{limit_count:10,days_back:30});lt(t||[])}(0,H.A)({"Alt+e":()=>ht(),"Alt+1":()=>D(0),"Alt+2":()=>D(1),"Alt+3":()=>D(2)},"Reports Page"),(0,s.useEffect)(()=>{const t=r.get("tab");if(t){const e=parseInt(t);e>=0&&e<=2&&D(e)}},[r]),(0,s.useEffect)(()=>{t&&async function(){G(!0);try{await Promise.all([ot(),it(),at(),ct(),dt()])}catch(t){console.error("Error fetching reports:",t),Z.oR.error("Failed to load reports")}finally{G(!1)}}()},[M,t]);const xt=t=>{K((0,n.A)((0,n.A)({},M),{},{[t.target.name]:t.target.value}))},ht=()=>{let t=[],e="report";if(0===w?(t=st.map(t=>({Product:t.product_name,"Quantity Sold":t.total_quantity,Revenue:t.total_revenue,"Sales Count":t.sales_count})),e="top_products_report"):1===w?(t=tt.map(t=>({Product:t.name,"Expiry Date":t.expiry_date,"Days Left":t.days_until_expiry,Stock:t.stock})),e="expiry_report"):2===w&&(t=rt.map(t=>({Product:t.name,Form:t.form,Stock:t.stock,"Min Level":t.min_stock_level})),e="low_stock_report"),0===t.length)return void Z.oR.info("No data to export");const r=O().unparse(t),n=new Blob([r],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a"),l=URL.createObjectURL(n);s.setAttribute("href",l),s.setAttribute("download","".concat(e,"_").concat((new Date).toISOString().split("T")[0],".csv")),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s)};return(0,S.jsxs)(o.A,{maxWidth:"xl",children:[(0,S.jsxs)(i.A,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[(0,S.jsx)(a.A,{variant:"h4",fontWeight:700,color:"primary",children:"Reports & Analytics"}),(0,S.jsx)(c.A,{variant:"outlined",startIcon:(0,S.jsx)(b.A,{}),onClick:e,children:"Shortcuts"})]}),(0,S.jsx)(d.A,{sx:{mb:3},children:(0,S.jsx)(x.A,{children:(0,S.jsxs)(h.Ay,{container:!0,spacing:2,alignItems:"center",children:[(0,S.jsx)(h.Ay,{item:!0,xs:12,sm:4,children:(0,S.jsx)(u.A,{fullWidth:!0,type:"date",label:"Start Date",name:"start",value:M.start,onChange:xt,InputLabelProps:{shrink:!0}})}),(0,S.jsx)(h.Ay,{item:!0,xs:12,sm:4,children:(0,S.jsx)(u.A,{fullWidth:!0,type:"date",label:"End Date",name:"end",value:M.end,onChange:xt,InputLabelProps:{shrink:!0}})}),(0,S.jsx)(h.Ay,{item:!0,xs:12,sm:4,children:(0,S.jsx)(c.A,{fullWidth:!0,variant:"outlined",startIcon:(0,S.jsx)(k.A,{}),onClick:ht,children:"Export to Excel"})})]})})}),(0,S.jsxs)(h.Ay,{container:!0,spacing:3,mb:4,children:[(0,S.jsx)(h.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,S.jsx)(d.A,{children:(0,S.jsxs)(x.A,{children:[(0,S.jsxs)(i.A,{display:"flex",alignItems:"center",gap:1,mb:1,children:[(0,S.jsx)(L,{color:"primary"}),(0,S.jsx)(a.A,{variant:"body2",color:"text.secondary",children:"Total Sales"})]}),(0,S.jsx)(a.A,{variant:"h4",fontWeight:700,children:(0,U.ZV)((null===Q||void 0===Q?void 0:Q.total_sales)||0)}),(0,S.jsxs)(a.A,{variant:"caption",color:"text.secondary",children:[(0,U.ZV)((null===Q||void 0===Q?void 0:Q.total_items_sold)||0)," items sold"]})]})})}),(0,S.jsx)(h.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,S.jsx)(d.A,{children:(0,S.jsxs)(x.A,{children:[(0,S.jsxs)(i.A,{display:"flex",alignItems:"center",gap:1,mb:1,children:[(0,S.jsx)(N.A,{color:"success"}),(0,S.jsx)(a.A,{variant:"body2",color:"text.secondary",children:"Revenue"})]}),(0,S.jsx)(a.A,{variant:"h4",fontWeight:700,color:"success.main",children:(0,U.vv)((null===Q||void 0===Q?void 0:Q.total_revenue)||0,t.currency_symbol)})]})})}),(0,S.jsx)(h.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,S.jsx)(d.A,{children:(0,S.jsxs)(x.A,{children:[(0,S.jsxs)(i.A,{display:"flex",alignItems:"center",gap:1,mb:1,children:[(0,S.jsx)(N.A,{color:"info"}),(0,S.jsx)(a.A,{variant:"body2",color:"text.secondary",children:"Profit"})]}),(0,S.jsx)(a.A,{variant:"h4",fontWeight:700,color:"info.main",children:(0,U.vv)((null===J||void 0===J?void 0:J.total_profit)||0,t.currency_symbol)}),(0,S.jsxs)(a.A,{variant:"caption",color:"text.secondary",children:["Margin: ",(0,U.Ee)((null===J||void 0===J?void 0:J.profit_margin)||0)]})]})})}),(0,S.jsx)(h.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,S.jsx)(d.A,{children:(0,S.jsxs)(x.A,{children:[(0,S.jsxs)(i.A,{display:"flex",alignItems:"center",gap:1,mb:1,children:[(0,S.jsx)(C.A,{color:"warning"}),(0,S.jsx)(a.A,{variant:"body2",color:"text.secondary",children:"Alerts"})]}),(0,S.jsx)(a.A,{variant:"h4",fontWeight:700,color:"warning.main",children:rt.length+tt.length}),(0,S.jsxs)(a.A,{variant:"caption",color:"text.secondary",children:[rt.length," low stock, ",tt.length," expiring"]})]})})})]}),(0,S.jsxs)(d.A,{children:[(0,S.jsxs)(A.A,{value:w,onChange:(t,e)=>D(e),variant:"scrollable",children:[(0,S.jsx)(j.A,{label:"Top Products"}),(0,S.jsx)(j.A,{label:"Expiry Report"}),(0,S.jsx)(j.A,{label:"Low Stock"})]}),(0,S.jsxs)(x.A,{children:[0===w&&(0,S.jsxs)(i.A,{children:[(0,S.jsx)(a.A,{variant:"h6",fontWeight:600,mb:2,children:"Top Selling Products (Last 30 Days)"}),0===st.length?(0,S.jsx)(a.A,{color:"text.secondary",children:"No sales data available"}):(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(E.u,{width:"100%",height:300,children:(0,S.jsxs)(R,{data:st.slice(0,5),children:[(0,S.jsx)(T.d,{strokeDasharray:"3 3"}),(0,S.jsx)(I.W,{dataKey:"product_name"}),(0,S.jsx)(P.h,{}),(0,S.jsx)(V.m,{}),(0,S.jsx)(W.y,{dataKey:"total_quantity",fill:"#6366f1"})]})}),(0,S.jsx)(y.A,{sx:{mt:3,overflowX:"auto"},children:(0,S.jsxs)(p.A,{sx:{minWidth:600},children:[(0,S.jsx)(m.A,{children:(0,S.jsxs)(g.A,{children:[(0,S.jsx)(f.A,{children:(0,S.jsx)("strong",{children:"Product"})}),(0,S.jsx)(f.A,{children:(0,S.jsx)("strong",{children:"Quantity Sold"})}),(0,S.jsx)(f.A,{children:(0,S.jsx)("strong",{children:"Revenue"})}),(0,S.jsx)(f.A,{children:(0,S.jsx)("strong",{children:"Sales Count"})})]})}),(0,S.jsx)(v.A,{children:st.map((e,r)=>(0,S.jsxs)(g.A,{children:[(0,S.jsx)(f.A,{children:e.product_name}),(0,S.jsx)(f.A,{children:(0,U.ZV)(e.total_quantity)}),(0,S.jsx)(f.A,{children:(0,U.vv)(e.total_revenue,t.currency_symbol)}),(0,S.jsx)(f.A,{children:(0,U.ZV)(e.sales_count)})]},r))})]})})]})]}),1===w&&(0,S.jsxs)(i.A,{children:[(0,S.jsxs)(a.A,{variant:"h6",fontWeight:600,mb:2,children:["Products Near Expiry (Within ",t.expiry_alert_days||15," Days)"]}),0===tt.length?(0,S.jsx)(a.A,{color:"text.secondary",children:"No products near expiry!"}):(0,S.jsx)(y.A,{sx:{overflowX:"auto"},children:(0,S.jsxs)(p.A,{sx:{minWidth:600},children:[(0,S.jsx)(m.A,{children:(0,S.jsxs)(g.A,{children:[(0,S.jsx)(f.A,{children:(0,S.jsx)("strong",{children:"Product"})}),(0,S.jsx)(f.A,{children:(0,S.jsx)("strong",{children:"Expiry Date"})}),(0,S.jsx)(f.A,{children:(0,S.jsx)("strong",{children:"Days Left"})}),(0,S.jsx)(f.A,{children:(0,S.jsx)("strong",{children:"Stock"})}),(0,S.jsx)(f.A,{children:(0,S.jsx)("strong",{children:"Status"})})]})}),(0,S.jsx)(v.A,{children:tt.map((e,r)=>{const n=(0,q.go)(e.expiry_date,7,parseInt(t.expiry_alert_days||"15"));return(0,S.jsxs)(g.A,{children:[(0,S.jsx)(f.A,{children:e.name}),(0,S.jsx)(f.A,{children:(0,q.Yq)(e.expiry_date)}),(0,S.jsxs)(f.A,{children:[e.days_until_expiry," days"]}),(0,S.jsx)(f.A,{children:(0,U.ZV)(e.stock)}),(0,S.jsx)(f.A,{children:(0,S.jsx)(_.A,{label:n.label,size:"small",color:n.color})})]},r)})})]})})]}),2===w&&(0,S.jsxs)(i.A,{children:[(0,S.jsx)(a.A,{variant:"h6",fontWeight:600,mb:2,children:"Low Stock Items"}),0===rt.length?(0,S.jsx)(a.A,{color:"text.secondary",children:"All products are well stocked!"}):(0,S.jsx)(y.A,{sx:{overflowX:"auto"},children:(0,S.jsxs)(p.A,{sx:{minWidth:600},children:[(0,S.jsx)(m.A,{children:(0,S.jsxs)(g.A,{children:[(0,S.jsx)(f.A,{children:(0,S.jsx)("strong",{children:"Product"})}),(0,S.jsx)(f.A,{children:(0,S.jsx)("strong",{children:"Category"})}),(0,S.jsx)(f.A,{children:(0,S.jsx)("strong",{children:"Current Stock"})}),(0,S.jsx)(f.A,{children:(0,S.jsx)("strong",{children:"Min Level"})}),(0,S.jsx)(f.A,{children:(0,S.jsx)("strong",{children:"Status"})})]})}),(0,S.jsx)(v.A,{children:rt.map((t,e)=>(0,S.jsxs)(g.A,{children:[(0,S.jsx)(f.A,{children:t.name}),(0,S.jsx)(f.A,{children:t.form||"\u2014"}),(0,S.jsx)(f.A,{children:(0,U.ZV)(t.stock)}),(0,S.jsx)(f.A,{children:t.min_stock_level}),(0,S.jsx)(f.A,{children:(0,S.jsx)(_.A,{label:0===t.stock?"Out of Stock":"Low Stock",size:"small",color:0===t.stock?"error":"warning"})})]},e))})]})})]})]})]})]})}},12807:(t,e,r)=>{function n(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"PKR";if(null===t||void 0===t||isNaN(t))return"".concat(e," 0.00");const r=Number(t);return"".concat(e," ").concat(r.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}))}function s(t){return null===t||void 0===t||isNaN(t)?"0":Number(t).toLocaleString("en-US")}function l(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return null===t||void 0===t||isNaN(t)?"0%":"".concat(Number(t).toFixed(e),"%")}r.d(e,{Ee:()=>l,ZV:()=>s,vv:()=>n})},43243:(t,e,r)=>{r.d(e,{V0:()=>a,Yq:()=>l,fU:()=>o,go:()=>i,t6:()=>c});var n=r(82125),s=r(98920);function l(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"MMM dd, yyyy";if(!t)return"\u2014";try{const r="string"===typeof t?(0,s.A)(t):t;return(0,n.A)(r,e)}catch(r){return console.error("Error formatting date:",r),String(t)}}function o(t){if(!t)return"\u2014";try{const e="string"===typeof t?(0,s.A)(t):t;return(0,n.A)(e,"h:mm a")}catch(e){return console.error("Error formatting time:",e),String(t)}}function i(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:7,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15;const n=function(t){if(!t)return null;try{const e="string"===typeof t?new Date(t):t,r=new Date;r.setHours(0,0,0,0),e.setHours(0,0,0,0);const n=e-r;return Math.ceil(n/864e5)}catch(e){return console.error("Error calculating days until expiry:",e),null}}(t);return null===n?{type:"unknown",color:"default",label:"No expiry date"}:n<0?{type:"expired",color:"error",label:"Expired",days:n}:n<=e?{type:"urgent",color:"error",label:"".concat(n," days left"),days:n}:n<=r?{type:"warning",color:"warning",label:"".concat(n," days left"),days:n}:{type:"ok",color:"success",label:"Good",days:n}}function a(t){return 0===t?{type:"out",color:"error",label:"Out of stock"}:t<=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:10)?{type:"low",color:"warning",label:"Low stock"}:{type:"ok",color:"success",label:"In stock"}}function c(t){const e=new Date;return e.setDate(e.getDate()-t),(0,n.A)(e,"yyyy-MM-dd")}},51639:(t,e,r)=>{r.d(e,{A:()=>l});r(65043);var n=r(59662),s=r(70579);const l=(0,n.A)((0,s.jsx)("path",{d:"M8.59 16.34l4.58-4.59-4.58-4.59L10 5.75l6 6-6 6z"}),"KeyboardArrowRight")}}]);
//# sourceMappingURL=95.4902e053.chunk.js.map